<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’Ž Diamond Case - Gagne des Cartes Cadeaux</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --primary: #38bdf8;
            --accent: #818cf8;
            --success: #4ade80;
            --danger: #f87171;
            --gold: #fbbf24;
            --common: #94a3b8;
            --rare: #4ade80;
            --epic: #a855f7;
            --legendary: #f59e0b;
            --mythic: #f43f5e;
            --ultrapremium: #00ffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }

        /* Navigation */
        header {
            background-color: rgba(15, 23, 42, 0.95);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        
        nav { display: flex; gap: 15px; }
        nav button {
            background: none;
            border: none;
            color: #cbd5e1;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        nav button:hover, nav button.active {
            background-color: rgba(56, 189, 248, 0.1);
            color: var(--primary);
        }

        .user-stats {
            background: rgba(0,0,0,0.3);
            padding: 8px 20px;
            border-radius: 20px;
            border: 1px solid var(--primary);
            font-weight: bold;
            color: var(--primary);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Layout */
        main { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }

        h2 { 
            border-left: 5px solid var(--primary); 
            padding-left: 15px; 
            margin-bottom: 25px; 
            font-size: 1.8rem;
        }

        /* Alertes */
        #alert-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: var(--bg-panel);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
            min-width: 280px;
        }

        /* AUTH SCREEN AMÃ‰LIORÃ‰ */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-box {
            max-width: 450px;
            width: 100%;
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 1px solid #334155;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 8px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .auth-tab.active {
            background: var(--primary);
            color: #0f172a;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid #334155;
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
        }

        .btn-main {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(56, 189, 248, 0.3);
        }

        .btn-main:active { transform: scale(0.98); }

        /* Caisses */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .case-card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .case-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.4); 
        }
        
        .c-common { border-color: var(--common); }
        .c-rare { border-color: var(--rare); }
        .c-epic { border-color: var(--epic); }
        .c-legendary { border-color: var(--legendary); box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
        .c-mythic { border-color: var(--mythic); box-shadow: 0 0 25px rgba(244, 63, 94, 0.4); }
        .c-ultrapremium { 
            border-color: #00ffff; 
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8), 0 0 60px rgba(255, 0, 255, 0.6), inset 0 0 20px rgba(0, 255, 255, 0.3), 0 0 20px rgba(0, 255, 255, 0.5);
            animation: neonGlow 1.5s ease-in-out infinite;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
        }

        @keyframes neonGlow {
            0%, 100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.8), 0 0 60px rgba(255, 0, 255, 0.6), inset 0 0 20px rgba(0, 255, 255, 0.3), 0 0 20px rgba(0, 255, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 1), 0 0 80px rgba(255, 0, 255, 0.8), inset 0 0 30px rgba(0, 255, 255, 0.5), 0 0 40px rgba(255, 0, 255, 0.6);
            }
        }

        .case-card.c-ultrapremium h3 {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(255, 0, 255, 0.6);
            animation: titleGlow 1.5s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(255, 0, 255, 0.6); }
            50% { text-shadow: 0 0 20px rgba(0, 255, 255, 1), 0 0 30px rgba(255, 0, 255, 0.8); }
        }

        .case-card.c-ultrapremium .price-tag {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
            color: #00ffff;
            border: 2px solid #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6), 0 0 10px rgba(255, 0, 255, 0.4);
        }

        .case-img { font-size: 4rem; margin-bottom: 15px; }
        .price-tag { 
            background: rgba(0,0,0,0.6); 
            padding: 8px 15px; 
            border-radius: 20px; 
            display: inline-block; 
            margin-top: 15px; 
            color: var(--gold);
            font-weight: bold;
        }

        /* Roulette */
        #roulette-wrapper {
            background: linear-gradient(to bottom, #000, #111);
            height: 140px;
            margin: 30px 0;
            position: relative;
            border-radius: 12px;
            border: 3px solid var(--gold);
            overflow: hidden;
            display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        #roulette-strip {
            display: flex;
            height: 100%;
            position: absolute;
            left: 0;
            transition: transform 5s cubic-bezier(0.1, 0.9, 0.3, 1);
        }

        .roulette-item {
            width: 130px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 2px solid #222;
            flex-shrink: 0;
            background: var(--bg-panel);
        }

        .indicator {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, transparent, white, transparent);
            z-index: 10;
            transform: translateX(-50%);
            box-shadow: 0 0 20px white, 0 0 40px white;
        }

        #win-message {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            font-size: 1.4rem;
            min-height: 30px;
        }

        /* Inventaire & Market */
        .item-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .item-card {
            background: var(--bg-panel);
            width: 180px;
            padding: 15px;
            border-radius: 10px;
            border-bottom: 4px solid grey;
            text-align: center;
            transition: transform 0.2s;
        }

        .item-card:hover {
            transform: translateY(-5px);
        }

        .item-card.common { border-color: var(--common); }
        .item-card.rare { border-color: var(--rare); }
        .item-card.epic { border-color: var(--epic); }
        .item-card.legendary { border-color: var(--legendary); }
        .item-card.mythic { border-color: var(--mythic); }

        .btn-action {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: white;
            font-weight: 600;
            transition: opacity 0.2s;
        }

        .btn-action:hover { opacity: 0.9; }
        .btn-sell { background-color: var(--success); color: #0f172a; }
        .btn-market { background-color: var(--accent); }
        .btn-buy { background-color: var(--gold); color: black; }

        /* SHOP DIAMANTS AMÃ‰LIORÃ‰ */
        .diamond-packages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .diamond-package {
            background: var(--bg-panel);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #334155;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .diamond-package.featured {
            border-color: var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.2);
        }

        .diamond-package.featured::before {
            content: "POPULAIRE";
            position: absolute;
            top: 15px;
            right: -30px;
            background: var(--gold);
            color: #0f172a;
            padding: 5px 40px;
            transform: rotate(45deg);
            font-size: 0.7rem;
            font-weight: bold;
        }

        .diamond-package:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .diamond-amount {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
        }

        .diamond-price {
            font-size: 2rem;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 20px;
        }

        .payment-methods {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }

        .payment-method {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #334155;
            background: rgba(15, 23, 42, 0.5);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .payment-method:hover {
            border-color: var(--primary);
            background: rgba(56, 189, 248, 0.1);
        }

        /* Payment Modal Overlay */
        .payment-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 300;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .payment-overlay.active {
            display: flex;
        }

        .payment-modal {
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            position: relative;
            animation: slideUp 0.4s ease;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .payment-header h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .payment-form {
            display: none;
        }

        .payment-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }

        .btn-close:hover {
            color: var(--danger);
        }

        /* Animation de validation */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 400;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }

        .success-animation.active {
            display: flex;
        }

        .success-checkmark {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--success);
            position: relative;
            animation: scaleIn 0.5s ease;
            margin-bottom: 30px;
        }

        .success-checkmark::after {
            content: "âœ“";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            color: var(--success);
            animation: checkmark 0.8s ease 0.3s both;
        }

        .success-message {
            text-align: center;
            animation: fadeIn 0.8s ease 0.5s both;
        }

        .success-message h2 {
            font-size: 2.5rem;
            color: var(--success);
            margin-bottom: 15px;
            border: none;
            padding: 0;
        }

        .success-message p {
            font-size: 1.2rem;
            color: #cbd5e1;
            margin-bottom: 30px;
        }

        .success-diamonds {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
            animation: pulse 1s ease infinite;
        }

        /* Shop Cadeaux */
        .shop-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
        }

        .shop-item {
            background: var(--bg-panel);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #334155;
            transition: all 0.3s;
        }

        .shop-item:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .gift-card {
            background: linear-gradient(135deg, #38bdf8, #818cf8);
            color: white;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.4rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Market Price Input Inline */
        .market-price-form {
            margin-top: 10px;
            display: none;
        }

        .market-price-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .market-price-form input {
            padding: 8px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .market-price-form button {
            width: 48%;
            padding: 8px;
            margin: 2px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-confirm {
            background: var(--success);
            color: #0f172a;
        }

        .btn-cancel {
            background: var(--danger);
            color: white;
        }

        /* Withdrawal (Retrait) */
        .withdraw-card {
            background: linear-gradient(135deg, rgba(34,197,94,0.06), rgba(56,189,248,0.03));
            border: 2px solid #334155;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .withdraw-row {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 20px;
        }

        .withdraw-right {
            background: var(--bg-panel);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #334155;
            text-align: center;
        }

        .withdraw-summary {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            color: #cbd5e1;
            font-size: 0.95rem;
        }

        /* Animations Keyframes */
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }

        @keyframes slideIn { 
            from { transform: translateX(100%); } 
            to { transform: translateX(0); } 
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        @keyframes checkmark {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .cases-grid, .diamond-packages, .shop-grid {
                grid-template-columns: 1fr;
            }

            nav {
                flex-wrap: wrap;
                gap: 8px;
            }

            nav button {
                font-size: 0.85rem;
                padding: 6px 10px;
            }
        }

        .mines-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .mines-game {
            flex: 1;
            min-width: 400px;
        }

        .mines-sidebar {
            width: 280px;
        }

        .mines-header {
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5), 0 0 60px rgba(255, 0, 255, 0.3);
            animation: minesGlow 2s ease-in-out infinite;
        }

        @keyframes minesGlow {
            0%, 100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.5), 0 0 60px rgba(255, 0, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 0.8), 0 0 100px rgba(255, 0, 255, 0.6);
            }
        }

        .mines-header h3 {
            color: #0f172a;
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .mine-cell {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #1e293b, #334155);
            border: 3px solid #38bdf8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3), inset 0 0 10px rgba(0,0,0,0.5);
        }

        .mine-cell:hover:not(.revealed):not(.disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.6), inset 0 0 10px rgba(0,0,0,0.5);
        }

        .mine-cell.revealed {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            cursor: default;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
        }

        .mine-cell.safe {
            border-color: #4ade80;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.6), inset 0 0 10px rgba(0,0,0,0.5);
            animation: safePulse 0.5s ease;
        }

        @keyframes safePulse {
            0% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }

        .mine-cell.bomb {
            border-color: #f87171;
            background: linear-gradient(135deg, #7f1d1d, #450a0a);
            box-shadow: 0 0 30px rgba(248, 113, 113, 0.8), inset 0 0 15px rgba(0,0,0,0.8);
            animation: bombShake 0.5s ease;
        }

        @keyframes bombShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .mine-cell.disabled {
            cursor: not-allowed;
        }

        .mines-stats {
            background: var(--bg-panel);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            margin-bottom: 20px;
            box-shadow: 0 0 15px rgba(129, 140, 248, 0.3);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #334155;
            font-size: 1.1rem;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #cbd5e1;
        }

        .stat-value {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .mines-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .bet-input {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--primary);
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
        }

        .bet-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.5);
        }

        .mines-settings {
            background: var(--bg-panel);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #334155;
        }

        .settings-title {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            color: #cbd5e1;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
            height: 6px;
            background: linear-gradient(to right, var(--danger), var(--success));
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }

        .mines-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-mines {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-play {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #0f172a;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.4);
        }

        .btn-play:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(74, 222, 128, 0.6);
        }

        .btn-play:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-cashout {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
        }

        .btn-cashout:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.6);
        }

        .btn-cashout:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .multiplier-display {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(56, 189, 248, 0.1));
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid var(--primary);
        }

        .multiplier-label {
            color: #cbd5e1;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .multiplier-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success);
            animation: multipPulse 0.5s ease;
        }

        @keyframes multipPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .game-message {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-message.success {
            background: rgba(74, 222, 128, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .game-message.danger {
            background: rgba(248, 113, 113, 0.1);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        /* TUTORIAL & WELCOME OVERLAYS */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 900;
            padding: 20px;
        }
        .overlay.active { display: flex; }
        .welcome-box, .tutorial-box {
            background: var(--bg-panel);
            padding: 28px;
            border-radius: 12px;
            max-width: 900px;
            width: 100%;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        .welcome-grid { display: grid; grid-template-columns: 1fr 360px; gap: 20px; align-items: center; }
        .welcome-title { color: var(--primary); font-size: 1.8rem; margin-bottom: 10px; }
        .welcome-copy { color: #cbd5e1; margin-bottom: 8px; }
        .tutorial-steps { min-height: 160px; }
        .tutorial-step { display: none; }
        .tutorial-step.active { display: block; animation: fadeIn 0.3s ease; }
        .tutorial-controls { display: flex; gap: 10px; justify-content: flex-end; margin-top: 14px; }
        .tutorial-indicators { display:flex; gap:6px; margin-top:10px; }
        .tutorial-dot { width:10px; height:10px; border-radius:50%; background:#334155; }
        .tutorial-dot.active { background:var(--primary); box-shadow: 0 0 8px rgba(56,189,248,0.6); }

        /* small helper */
        .muted { color: #94a3b8; font-size: 0.95rem; }

        /* ============ BLACKJACK STYLES ============ */
        .blackjack-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 30px;
            border: 2px solid var(--primary);
            box-shadow: 0 10px 40px rgba(56, 189, 248, 0.2);
        }

        .blackjack-table {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            border-radius: 12px;
            padding: 40px 30px;
            margin-bottom: 30px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.3), inset 0 0 30px rgba(0, 0, 0, 0.5);
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }

        .blackjack-player-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .player-label {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .blackjack-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            min-height: 120px;
            align-items: center;
        }

        .card-placeholder {
            color: #94a3b8;
            font-style: italic;
        }

        .playing-card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            animation: cardDeal 0.5s ease-out;
        }

        @keyframes cardDeal {
            from {
                opacity: 0;
                transform: translateX(-50px) rotateY(90deg);
            }
            to {
                opacity: 1;
                transform: translateX(0) rotateY(0);
            }
        }

        .player-value {
            font-size: 1.2rem;
            color: var(--gold);
            font-weight: bold;
            min-height: 30px;
        }

        .blackjack-status {
            text-align: center;
            margin: 20px 0;
            min-height: 60px;
        }

        .status-message {
            font-size: 1.1rem;
            color: #cbd5e1;
            margin-bottom: 10px;
            min-height: 20px;
        }

        .result-message {
            font-size: 1.5rem;
            font-weight: bold;
            animation: resultPop 0.5s ease;
            min-height: 30px;
        }

        @keyframes resultPop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .blackjack-controls {
            background: var(--bg-panel);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #334155;
        }

        .bet-section {
            margin-bottom: 20px;
        }

        .bet-section label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: bold;
        }

        .bet-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bet-input-group input {
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--primary);
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
        }

        .bet-input-group input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
        }

        .bet-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .bet-presets button {
            padding: 10px;
            background: linear-gradient(135deg, #334155, #475569);
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .bet-presets button:hover {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            transform: translateY(-2px);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .btn-bj {
            padding: 12px;
            border: 2px solid var(--primary);
            background: rgba(56, 189, 248, 0.1);
            color: var(--primary);
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .btn-bj:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 189, 248, 0.4);
        }

        .btn-bj:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-deal {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-size: 1rem;
            grid-column: 1 / 3;
        }

        .blackjack-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #334155;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #334155;
        }

        .stat-label {
            display: block;
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .stat-value {
            display: block;
            color: var(--gold);
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* ============ SLOTS STYLES ============ */
        .slots-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 30px;
            border: 2px solid var(--primary);
            box-shadow: 0 10px 40px rgba(56, 189, 248, 0.2);
        }

        .slots-machine {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #334155;
        }

        .slots-display {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .slots-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .slots-header h3 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .slots-grid {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .slot-reel {
            position: relative;
            width: 100px;
            height: 150px;
            background: rgba(0, 0, 0, 0.6);
            border: 3px solid var(--gold);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8), 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .reel-window {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 60px;
            transform: translateY(-50%);
            border-top: 3px solid var(--accent);
            border-bottom: 3px solid var(--accent);
            background: rgba(56, 189, 248, 0.1);
            z-index: 10;
            pointer-events: none;
            box-shadow: inset 0 0 10px rgba(56, 189, 248, 0.3);
        }

        .reel-container {
            display: flex;
            flex-direction: column;
            transition: transform 0.1s linear;
            animation: none;
        }

        .reel-item {
            width: 100px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            flex-shrink: 0;
            border-bottom: 2px solid #334155;
        }

        .winline {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 60px;
            transform: translateY(-50%);
            border-top: 2px solid var(--success);
            border-bottom: 2px solid var(--success);
            background: linear-gradient(to right, transparent, rgba(74, 222, 128, 0.2), transparent);
            display: none;
            z-index: 5;
            animation: winlinePulse 0.6s ease;
        }

        .winline.show {
            display: block;
        }

        @keyframes winlinePulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .slots-message {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            min-height: 40px;
            animation: messageSlide 0.4s ease;
        }

        .slots-message.win {
            background: rgba(74, 222, 128, 0.2);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .slots-message.loss {
            background: rgba(248, 113, 113, 0.2);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        .slots-controls {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.2), rgba(56, 189, 248, 0.05));
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #334155;
        }

        .btn-spin {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            color: #0f172a;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 20px 0;
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
        }

        .btn-spin:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.6);
        }

        .btn-spin:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-spin:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .slots-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .slots-stats .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #334155;
        }

        @media (max-width: 768px) {
            .bet-presets {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn-deal {
                grid-column: 1 / 3;
            }

            .blackjack-stats,
            .slots-stats {
                grid-template-columns: 1fr;
            }

            .slots-grid {
                gap: 10px;
            }

            .slot-reel {
                width: 80px;
                height: 120px;
            }

            .reel-item {
                width: 80px;
                height: 120px;
                font-size: 2rem;
            }
        }

        /* TOWER GAME STYLES */
        .tower-wrapper {
            display: flex;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tower-game-area {
            flex: 1;
        }

        .tower-mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .tower-mode-btn {
            flex: 1;
            padding: 18px 20px;
            border: 2px solid #334155;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(129, 140, 248, 0.1));
            color: #cbd5e1;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .tower-mode-btn:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .tower-mode-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.4);
        }

        .tower-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 40px 0;
            min-height: 600px;
        }

        .tower-column {
            display: flex;
            flex-direction: column-reverse;
            gap: 12px;
            min-width: 100px;
        }

        .tower-column.easy {
            min-width: 120px;
        }

        .tower-floor {
            background: linear-gradient(135deg, rgba(15, 172, 204, 0.2), rgba(0, 229, 255, 0.2));
            border: 2px solid rgba(56, 189, 248, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .tower-floor:hover:not(.completed):not(.lost) {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.3), rgba(0, 229, 255, 0.3));
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
        }

        .tower-floor.current {
            background: linear-gradient(135deg, var(--primary), rgba(0, 229, 255, 0.5));
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.6), inset 0 0 20px rgba(56, 189, 248, 0.2);
            animation: pulseFloor 1s ease-in-out infinite;
        }

        @keyframes pulseFloor {
            0%, 100% { box-shadow: 0 0 30px rgba(56, 189, 248, 0.6), inset 0 0 20px rgba(56, 189, 248, 0.2); }
            50% { box-shadow: 0 0 50px rgba(56, 189, 248, 0.8), inset 0 0 30px rgba(56, 189, 248, 0.3); }
        }

        .tower-floor.completed {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.3), rgba(34, 197, 94, 0.3));
            border-color: var(--success);
            color: var(--success);
        }

        .tower-floor.lost {
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.3), rgba(239, 68, 68, 0.3));
            border-color: var(--danger);
            color: var(--danger);
        }

        .tower-floor-level {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .tower-multiplier {
            font-size: 0.85rem;
            margin-top: 4px;
            opacity: 0.8;
        }

        .tower-sidebar {
            width: 320px;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.05), rgba(129, 140, 248, 0.05));
            border: 2px solid rgba(56, 189, 248, 0.2);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .tower-stats-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .tower-stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 6px;
        }

        .tower-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .tower-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tower-controls input {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid #334155;
            color: white;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
        }

        .tower-controls input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
        }

        .tower-btn-start {
            background: linear-gradient(135deg, var(--success), rgba(34, 197, 94, 0.8));
            color: white;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .tower-btn-start:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(74, 222, 128, 0.4);
        }

        .tower-btn-start:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tower-btn-cashout {
            background: linear-gradient(135deg, var(--gold), rgba(251, 191, 36, 0.8));
            color: #0f172a;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: none;
        }

        .tower-btn-cashout.show {
            display: block;
        }

        .tower-btn-cashout:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
        }

        .tower-history {
            margin-top: 30px;
            padding: 18px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(56, 189, 248, 0.2);
            max-height: 300px;
            overflow-y: auto;
        }

        .tower-history-item {
            font-size: 0.85rem;
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
        }

        .tower-history-item.win {
            border-left: 3px solid var(--success);
            color: var(--success);
        }

        .tower-history-item.loss {
            border-left: 3px solid var(--danger);
            color: var(--danger);
        }

        .tower-info {
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        .tower-result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            border: 2px solid var(--primary);
            z-index: 1000;
            text-align: center;
            display: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            animation: slideUp 0.3s ease;
        }

        .tower-result-popup.show {
            display: block;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, -40%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        .tower-result-popup.win {
            border-color: var(--success);
        }

        .tower-result-popup.lose {
            border-color: var(--danger);
        }

        .tower-result-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .tower-result-amount {
            font-size: 2rem;
            color: var(--gold);
            margin: 15px 0;
            font-weight: bold;
        }

        .tower-result-popup.win .tower-result-title {
            color: var(--success);
        }

        .tower-result-popup.lose .tower-result-title {
            color: var(--danger);
        }
    </style>
</head>
<body>

    <!-- Ã‰CRAN D'AUTHENTIFICATION -->
    <div id="auth-screen" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <h1>ðŸ’Ž The Royal Casino ðŸ’Ž</h1>
                <p style="color: #94a3b8;">Gagne des cartes cadeaux en ouvrant des caisses !</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="app.switchAuthTab('login')">Connexion</button>
                <button class="auth-tab" onclick="app.switchAuthTab('register')">Inscription</button>
            </div>

            <!-- Formulaire de Connexion -->
            <form id="login-form" class="auth-form active" onsubmit="app.login(event)">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="login-username" required placeholder="Entre ton pseudo">
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="login-password" required placeholder="Ton mot de passe">
                </div>
                <button type="submit" class="btn-main">Se Connecter</button>
            </form>

            <!-- Formulaire d'Inscription -->
            <form id="register-form" class="auth-form" onsubmit="app.register(event)">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="register-username" required placeholder="Choisis ton pseudo" minlength="3">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="register-email" required placeholder="ton@email.com">
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="register-password" required placeholder="Mot de passe sÃ©curisÃ©" minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirmer le mot de passe</label>
                    <input type="password" id="register-confirm" required placeholder="RÃ©pÃ¨te ton mot de passe">
                </div>
                <button type="submit" class="btn-main">CrÃ©er mon Compte</button>
            </form>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE -->
    <div id="app-container" class="hidden">
        
        <header>
            <div class="logo">ðŸ’Ž The Royal Casino ðŸ’Ž</div>
            <nav>
                <button onclick="app.nav('cases')" class="active">ðŸ§° Caisses</button>
                <button onclick="app.nav('mines')">âš¡ Mines</button>
                <button onclick="app.nav('tower')">ðŸ° Tower</button>
                <button onclick="app.nav('blackjack')">ðŸŽ´ Blackjack</button>
                <button onclick="app.nav('slots')">ðŸŽ° Slots</button>
                <button onclick="app.nav('inventory')">Inventaire</button>
                <button onclick="app.nav('market')">MarchÃ©</button>
                <button onclick="app.nav('shop')">ðŸ’Ž Shop</button>
                <button onclick="app.nav('redeem')" style="color:var(--gold)">ðŸŽ Cadeaux</button>
                <button onclick="app.showTutorial(true)" style="color:#94a3b8">ðŸ“˜ Tutoriel</button>
                <button onclick="app.logout()" style="color:var(--danger)">ðŸšª DÃ©connexion</button>
            </nav>
            <div class="user-stats">
                <span id="user-name" style="color: white; margin-right: 5px;"></span>
                ðŸ’Ž <span id="user-diamonds">0</span>
                <span style="color:#94a3b8;">â‰ˆ <span id="user-euros">0.00â‚¬</span></span>
            </div>
        </header>

        <div id="alert-container"></div>

        <main>
            
            <!-- SECTION CAISSES -->
            <div id="sec-cases" class="section active">
                
                <div id="roulette-wrapper">
                    <div class="indicator"></div>
                    <div id="roulette-strip"></div>
                </div>
                <div id="win-message"></div>

                <h2>Choisir une Caisse</h2>
                <div class="cases-grid">
                    <div class="case-card c-common" onclick="app.openCase('common')">
                        <div class="case-img">ðŸ“¦</div>
                        <h3>Caisse Commune</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Objets basiques pour dÃ©buter</p>
                        <div class="price-tag">ðŸ’Ž 10</div>
                    </div>
                    <div class="case-card c-rare" onclick="app.openCase('rare')">
                        <div class="case-img">ðŸ’¼</div>
                        <h3>Caisse Rare</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Meilleure chance de gains</p>
                        <div class="price-tag">ðŸ’Ž 50</div>
                    </div>
                    <div class="case-card c-epic" onclick="app.openCase('epic')">
                        <div class="case-img">ðŸ”®</div>
                        <h3>Caisse Ã‰pique</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Objets de grande valeur</p>
                        <div class="price-tag">ðŸ’Ž 150</div>
                    </div>
                    <div class="case-card c-legendary" onclick="app.openCase('legendary')">
                        <div class="case-img">ðŸ‘‘</div>
                        <h3>Caisse LÃ©gendaire</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Jackpot possible !</p>
                        <div class="price-tag">ðŸ’Ž 500</div>
                    </div>
                    <div class="case-card c-mythic" onclick="app.openCase('mythic')">
                        <div class="case-img">ðŸ²</div>
                        <h3>Caisse Mythique</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">L'Ã©lite absolue</p>
                        <div class="price-tag">ðŸ’Ž 1500</div>
                    </div>
                    <div class="case-card c-ultrapremium" onclick="app.openCase('ultrapremium')">
                        <div class="case-img" style="animation: spin 3s linear infinite;">âš¡</div>
                        <h3>CAISSE ULTRA PREMIUM</h3>
                        <p style="font-size:0.9rem; color:#00ffff; margin: 10px 0; text-shadow: 0 0 10px rgba(0,255,255,0.8);">ðŸ’Ž 100,000 OU RIEN ! ðŸ’Ž</p>
                        <p style="font-size:0.8rem; color:#ff00ff; margin: 5px 0;">1 chance sur 1000</p>
                        <div class="price-tag">ðŸ’Ž 25,000</div>
                    </div>
                    <button onclick="app.getFreeCase()" class="btn-main" 
	                   style="margin-bottom:25px; width:100%; background:var(--success); color:#0f172a;">
                      	ðŸŽ Ouvrir ma Caisse Gratuite
                    </button>
                </div>
            </div>

            <!-- SECTION MINES -->
            <div id="sec-mines" class="section">
                <h2>âš¡ MINES ðŸ’£</h2>
                
                <div class="mines-container">
                    <div class="mines-game">
                        <div class="mines-header">
                            <h3>ðŸŽ® JEUX DE MINES ðŸŽ®</h3>
                            <p style="color: #0f172a; margin: 0; font-size: 0.9rem;">RÃ©vÃ¨le les cases et empoche les diamants!</p>
                        </div>
                        
                        <div id="mines-message" class="game-message" style="display:none;"></div>
                        
                        <div class="multiplier-display" id="multiplier-container" style="display:none;">
                            <div class="multiplier-label">MULTIPLICATEUR ACTUEL</div>
                            <div class="multiplier-value" id="current-multiplier">1.00x</div>
                        </div>
                        
                        <div class="mines-grid" id="mines-grid"></div>
                    </div>
                    
                    <div class="mines-sidebar">
                        <div class="mines-stats">
                            <div class="stat-row">
                                <span class="stat-label">Balance ðŸ’Ž</span>
                                <span class="stat-value" id="mines-balance">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Mise ðŸ’Ž</span>
                                <span class="stat-value" id="mines-bet">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Gains Potentiels ðŸ’Ž</span>
                                <span class="stat-value" id="mines-potential">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Cases RÃ©vÃ©lÃ©es</span>
                                <span class="stat-value" id="mines-revealed">0/25</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Nombre de Mines</span>
                                <span class="stat-value" id="mines-count">0</span>
                            </div>
                        </div>
                        
                        <div class="mines-controls">
                            <div>
                                <label style="color: #cbd5e1; display: block; margin-bottom: 8px; font-weight: bold;">Miser des Diamants ðŸ’Ž</label>
                                <input type="number" id="mines-bet-input" class="bet-input" placeholder="Montant Ã  miser" min="1" value="10">
                            </div>
                        </div>
                        
                        <div class="mines-settings">
                            <div class="settings-title">âš™ï¸ PARAMÃˆTRES</div>
                            <div class="slider-container">
                                <label>Nombre de mines (1-24)</label>
                                <input type="range" id="mines-slider" min="1" max="24" value="3">
                                <div style="text-align: center; color: #4ade80; font-weight: bold; margin-top: 5px;">
                                    <span id="mines-slider-value">3</span> mines
                                </div>
                            </div>
                        </div>
                        
                        <div class="mines-actions">
                            <button class="btn-mines btn-play" id="btn-start-game" onclick="app.startMinesGame()">
                                ðŸŽ¬ LANCER LA PARTIE
                            </button>
                            <button class="btn-mines btn-cashout" id="btn-cashout" onclick="app.minesCashout()" disabled style="display:none;">
                                ðŸ’° ENCAISSER LES GAINS
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION BLACKJACK -->
            <div id="sec-blackjack" class="section">
                <h2>ðŸŽ´ Blackjack - Gagne des Diamants</h2>
                
                <div class="blackjack-container">
                    <div class="blackjack-table">
                        <!-- Dealer Section -->
                        <div class="blackjack-player-section">
                            <div class="player-label">ðŸŽ© Croupier</div>
                            <div class="blackjack-cards" id="dealer-cards">
                                <div class="card-placeholder">Cartes du croupier</div>
                            </div>
                            <div class="player-value">Valeur: <span id="dealer-value">0</span></div>
                        </div>

                        <!-- Game Status -->
                        <div class="blackjack-status">
                            <div id="game-status" class="status-message"></div>
                            <div id="game-result" class="result-message"></div>
                        </div>

                        <!-- Player Section -->
                        <div class="blackjack-player-section">
                            <div class="player-label">ðŸ‘¤ Votre Main</div>
                            <div class="blackjack-cards" id="player-cards">
                                <div class="card-placeholder">Vos cartes</div>
                            </div>
                            <div class="player-value">Valeur: <span id="player-value">0</span></div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="blackjack-controls">
                        <div class="bet-section">
                            <label>ðŸ’Ž Mise (Diamants)</label>
                            <div class="bet-input-group">
                                <input type="number" id="blackjack-bet" placeholder="Entrez votre mise" min="1" value="100">
                                <div class="bet-presets">
                                    <button onclick="app.setBJBet(50)">50ðŸ’Ž</button>
                                    <button onclick="app.setBJBet(100)">100ðŸ’Ž</button>
                                    <button onclick="app.setBJBet(500)">500ðŸ’Ž</button>
                                    <button onclick="app.setBJBet(1000)">1KðŸ’Ž</button>
                                </div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button id="bj-deal" class="btn-bj btn-deal" onclick="app.blackjackDeal()">ðŸŽ² DISTRIBUER</button>
                            <button id="bj-hit" class="btn-bj btn-action" onclick="app.blackjackHit()" disabled>Tirer</button>
                            <button id="bj-stand" class="btn-bj btn-action" onclick="app.blackjackStand()" disabled>Rester</button>
                            <button id="bj-double" class="btn-bj btn-action" onclick="app.blackjackDouble()" disabled>Doubler</button>
                        </div>

                        <div class="blackjack-stats">
                            <div class="stat-item">
                                <span class="stat-label">ðŸ’Ž Solde</span>
                                <span class="stat-value" id="bj-balance">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ðŸŽ¯ Mise</span>
                                <span class="stat-value" id="bj-current-bet">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ðŸ† Gain Potentiel</span>
                                <span class="stat-value" id="bj-potential-win">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION SLOTS -->
            <div id="sec-slots" class="section">
                <h2>ðŸŽ° Machines Ã  Sous</h2>
                
                <!-- MACHINE 1: FRUITS -->
                <div class="slots-container">
                    <div class="slots-machine">
                        <div class="slots-display">
                            <div class="slots-header">
                                <h3>ðŸŽ Machine Fruits ðŸ’</h3>
                            </div>
                            <div class="slots-grid" id="slots-grid-fruits">
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-fruits-0"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-fruits-1"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-fruits-2"></div>
                                    <div class="reel-window"></div>
                                </div>
                            </div>
                        </div>
                        <div class="winline"></div>
                        <div id="slots-message-fruits" class="slots-message"></div>
                        <div class="slots-controls">
                            <div class="bet-section">
                                <label>ðŸ’Ž Mise</label>
                                <div class="bet-input-group">
                                    <input type="number" id="slots-bet-fruits" placeholder="Mise" min="1" value="10">
                                    <div class="bet-presets">
                                        <button onclick="app.setSlotsBet('fruits', 10)">10ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('fruits', 25)">25ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('fruits', 50)">50ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('fruits', 100)">100ðŸ’Ž</button>
                                    </div>
                                </div>
                            </div>
                            <button id="slots-spin-fruits" class="btn-spin" onclick="app.slotsSpin('fruits')">SPIN ðŸŽ</button>
                            <div class="slots-stats">
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ’Ž Solde</span>
                                    <span class="stat-value" id="slots-balance-fruits">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ† Dernier Gain</span>
                                    <span class="stat-value" id="slots-last-win-fruits">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MACHINE 2: TRÃ‰SOR -->
                <div class="slots-container">
                    <div class="slots-machine">
                        <div class="slots-display">
                            <div class="slots-header">
                                <h3>ðŸ’° Machine TrÃ©sor ðŸ‘‘</h3>
                            </div>
                            <div class="slots-grid" id="slots-grid-treasure">
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-treasure-0"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-treasure-1"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-treasure-2"></div>
                                    <div class="reel-window"></div>
                                </div>
                            </div>
                        </div>
                        <div class="winline"></div>
                        <div id="slots-message-treasure" class="slots-message"></div>
                        <div class="slots-controls">
                            <div class="bet-section">
                                <label>ðŸ’Ž Mise</label>
                                <div class="bet-input-group">
                                    <input type="number" id="slots-bet-treasure" placeholder="Mise" min="1" value="10">
                                    <div class="bet-presets">
                                        <button onclick="app.setSlotsBet('treasure', 10)">10ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('treasure', 25)">25ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('treasure', 50)">50ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('treasure', 100)">100ðŸ’Ž</button>
                                    </div>
                                </div>
                            </div>
                            <button id="slots-spin-treasure" class="btn-spin" onclick="app.slotsSpin('treasure')">SPIN ðŸ’°</button>
                            <div class="slots-stats">
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ’Ž Solde</span>
                                    <span class="stat-value" id="slots-balance-treasure">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ† Dernier Gain</span>
                                    <span class="stat-value" id="slots-last-win-treasure">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MACHINE 3: CASINO -->
                <div class="slots-container">
                    <div class="slots-machine">
                        <div class="slots-display">
                            <div class="slots-header">
                                <h3>ðŸŽ² Machine Casino ðŸƒ</h3>
                            </div>
                            <div class="slots-grid" id="slots-grid-casino">
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-casino-0"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-casino-1"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-casino-2"></div>
                                    <div class="reel-window"></div>
                                </div>
                            </div>
                        </div>
                        <div class="winline"></div>
                        <div id="slots-message-casino" class="slots-message"></div>
                        <div class="slots-controls">
                            <div class="bet-section">
                                <label>ðŸ’Ž Mise</label>
                                <div class="bet-input-group">
                                    <input type="number" id="slots-bet-casino" placeholder="Mise" min="1" value="10">
                                    <div class="bet-presets">
                                        <button onclick="app.setSlotsBet('casino', 10)">10ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('casino', 25)">25ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('casino', 50)">50ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('casino', 100)">100ðŸ’Ž</button>
                                    </div>
                                </div>
                            </div>
                            <button id="slots-spin-casino" class="btn-spin" onclick="app.slotsSpin('casino')">SPIN ðŸŽ°</button>
                            <div class="slots-stats">
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ’Ž Solde</span>
                                    <span class="stat-value" id="slots-balance-casino">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ† Dernier Gain</span>
                                    <span class="stat-value" id="slots-last-win-casino">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MACHINE 4: ANIMAUX -->
                <div class="slots-container">
                    <div class="slots-machine">
                        <div class="slots-display">
                            <div class="slots-header">
                                <h3>ðŸ¶ Machine Animaux ðŸ¦</h3>
                            </div>
                            <div class="slots-grid" id="slots-grid-animals">
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-animals-0"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-animals-1"></div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-animals-2"></div>
                                    <div class="reel-window"></div>
                                </div>
                            </div>
                        </div>
                        <div class="winline"></div>
                        <div id="slots-message-animals" class="slots-message"></div>
                        <div class="slots-controls">
                            <div class="bet-section">
                                <label>ðŸ’Ž Mise</label>
                                <div class="bet-input-group">
                                    <input type="number" id="slots-bet-animals" placeholder="Mise" min="1" value="10">
                                    <div class="bet-presets">
                                        <button onclick="app.setSlotsBet('animals', 10)">10ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('animals', 25)">25ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('animals', 50)">50ðŸ’Ž</button>
                                        <button onclick="app.setSlotsBet('animals', 100)">100ðŸ’Ž</button>
                                    </div>
                                </div>
                            </div>
                            <button id="slots-spin-animals" class="btn-spin" onclick="app.slotsSpin('animals')">SPIN ðŸ¦</button>
                            <div class="slots-stats">
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ’Ž Solde</span>
                                    <span class="stat-value" id="slots-balance-animals">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">ðŸ† Dernier Gain</span>
                                    <span class="stat-value" id="slots-last-win-animals">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION INVENTAIRE -->
            <div id="sec-inventory" class="section">
                <h2>Mon Inventaire</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">Vends tes objets rapidement ou mets-les sur le marchÃ© pour plus de profit !</p>
                <div id="inventory-list" class="item-grid"></div>
            </div>

            <!-- SECTION MARCHÃ‰ -->
            <div id="sec-market" class="section">
                <h2>MarchÃ© des Joueurs</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">AchÃ¨te les objets des autres joueurs Ã  prix nÃ©gociÃ© !</p>
                <div id="market-list" class="item-grid"></div>
            </div>

            <!-- SECTION SHOP DIAMANTS -->
            <div id="sec-shop" class="section">
                <h2>ðŸ’Ž Boutique de Diamants</h2>
                <p style="color: #94a3b8; margin-bottom: 30px;">AchÃ¨te des diamants pour ouvrir plus de caisses !</p>
                
                <div class="diamond-packages" id="diamond-packages">
                    <!-- Existing packs (kept for compatibility) -->
                    <div class="diamond-package">
                        <h3>Starter Pack</h3>
                        <div class="diamond-amount">ðŸ’Ž 500</div>
                        <div class="diamond-price">2.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Parfait pour dÃ©buter</p>
                        <button class="btn-main" onclick="app.selectPackage(500, 2.99)">Acheter</button>
                    </div>

                    <div class="diamond-package featured">
                        <h3>Pack Populaire</h3>
                        <div class="diamond-amount">ðŸ’Ž 2,500</div>
                        <div class="diamond-price">9.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Meilleur rapport qualitÃ©/prix</p>
                        <button class="btn-main" onclick="app.selectPackage(2500, 9.99)">Acheter</button>
                    </div>

                    <div class="diamond-package">
                        <h3>Pack Premium</h3>
                        <div class="diamond-amount">ðŸ’Ž 10,000</div>
                        <div class="diamond-price">39.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Pour les joueurs sÃ©rieux</p>
                        <button class="btn-main" onclick="app.selectPackage(10000, 39.99)">Acheter</button>
                    </div>

                    <div class="diamond-package" style="border-color: var(--mythic);">
                        <h3>Pack LÃ©gende</h3>
                        <div class="diamond-amount">ðŸ’Ž 25,000</div>
                        <div class="diamond-price">99.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Maximum de diamants !</p>
                        <button class="btn-main" onclick="app.selectPackage(25000, 99.99)">Acheter</button>
                    </div>
                     
                    <div class="diamond-package">
                        <h3>Premium Luxury</h3>
                        <div class="diamond-amount">ðŸ’Ž 50,000</div>
                        <div class="diamond-price">199.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Riche a l'Ã©tat pure !!</p>
                        <button class="btn-main" onclick="app.selectPackage(50000, 199.99)">Acheter</button>
                    </div>

                    <!-- NEW: Enormous / Mega packs -->
                    <div class="diamond-package" style="border-color: var(--legendary);">
                        <h3>Pack Ã‰norme</h3>
                        <div class="diamond-amount">ðŸ’Ž 100,000</div>
                        <div class="diamond-price">299.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Pack Ã©norme avec bonus alÃ©atoire</p>
                        <button class="btn-main" onclick="app.selectPackage({ id:'enorme-100k', amount:100000, price:299.99, title:'Pack Ã‰norme', bonus:'+5% chance de lÃ©gendaire'})">Acheter</button>
                    </div>

                    <div class="diamond-package featured" style="border-color:var(--mythic);">
                        <h3>GIGA PACK</h3>
                        <div class="diamond-amount">ðŸ’Ž 250,000</div>
                        <div class="diamond-price">599.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">TrÃ¨s gros pack, bonus lÃ©gendaire garanti (petite chance)</p>
                        <button class="btn-main" onclick="app.selectPackage({ id:'giga-250k', amount:250000, price:599.99, title:'GIGA PACK', bonus:'Chances augmentÃ©es'})">Acheter</button>
                    </div>

                    <div class="diamond-package" style="border-color: #00ffff;">
                        <h3>PACK TITAN - MÃ‰GA</h3>
                        <div class="diamond-amount">ðŸ’Ž 1,000,000</div>
                        <div class="diamond-price">1999.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Pack TITAN â€” pour les vrais collectionneurs</p>
                        <button class="btn-main" onclick="app.selectPackage({ id:'titan-1m', amount:1000000, price:1999.99, title:'PACK TITAN', bonus:'Drops lÃ©gendaires garantis x1'})">Acheter</button>
                    </div>

                    <div class="diamond-package" style="border-color: #00ffff;">
                        <h3>MEGA ULTRA - Ã‰DITION LIMITÃ‰E</h3>
                        <div class="diamond-amount">ðŸ’Ž 5,000,000</div>
                        <div class="diamond-price">4999.99â‚¬</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Le pack ultime â€” trÃ¨s rare, Ã©norme bonus</p>
                        <button class="btn-main" onclick="app.selectPackage({ id:'mega-ultra', amount:5000000, price:4999.99, title:'MEGA ULTRA', bonus:'Bonus lÃ©gendaire + items uniques'})">Acheter</button>
                    </div>
                </div>
            </div>

            <!-- SECTION TOWER -->
            <div id="sec-tower" class="section">
                <h2>ðŸ° Ascension de la Tour Infinie</h2>
                
                <div class="tower-mode-selector">
                    <button class="tower-mode-btn active" onclick="app.selectTowerMode('easy')">ðŸŸ¢ Mode Facile (3 Colonnes, 2 Bonnes)</button>
                    <button class="tower-mode-btn" onclick="app.selectTowerMode('hard')">ðŸ”´ Mode Difficile (2 Colonnes)</button>
                </div>

                <div class="tower-wrapper">
                    <div class="tower-game-area">
                        <div class="tower-info" id="tower-mode-info">
                            ðŸ“Œ Mode Facile : 3 colonnes, 30 Ã©tages. Gagnez un multiplicateur Ã  chaque Ã©tage. Plus sÃ»r mais gains plus lents.
                        </div>

                        <div class="tower-container" id="tower-container"></div>

                        <div id="tower-result-popup" class="tower-result-popup">
                            <div class="tower-result-title" id="tower-result-title">GagnÃ©!</div>
                            <p id="tower-result-text" style="margin: 15px 0; font-size: 1.1rem;"></p>
                            <div class="tower-result-amount" id="tower-result-amount">+100 ðŸ’Ž</div>
                            <button class="btn-main" onclick="app.closeTowerPopup()" style="margin-top: 20px;">Continuer</button>
                        </div>
                    </div>

                    <div class="tower-sidebar">
                        <div class="tower-stats-box">
                            <div class="tower-stat-label">ðŸ’Ž Solde</div>
                            <div class="tower-stat-value" id="tower-balance">0</div>
                        </div>

                        <div class="tower-stats-box">
                            <div class="tower-stat-label">Mise</div>
                            <div class="tower-stat-value" id="tower-current-bet">0</div>
                        </div>

                        <div class="tower-stats-box">
                            <div class="tower-stat-label">Gains Potentiels</div>
                            <div class="tower-stat-value" id="tower-potential-win">0</div>
                        </div>

                        <div class="tower-stats-box">
                            <div class="tower-stat-label">Multiplicateur</div>
                            <div class="tower-stat-value" id="tower-multiplier">1.00x</div>
                        </div>

                        <div class="tower-controls">
                            <label style="color: #cbd5e1; font-weight: bold; margin-bottom: 8px;">Montant Ã  Miser ðŸ’Ž</label>
                            <input type="number" id="tower-bet-input" placeholder="Entrez votre mise" value="100" min="1">
                        </div>

                        <button class="tower-btn-start" id="tower-btn-start" onclick="app.startTowerGame()">ðŸŽ® DÃ‰MARRER LA PARTIE</button>
                        <button class="tower-btn-cashout" id="tower-btn-cashout" onclick="app.towerCashout()">ðŸ’° ENCAISSER</button>

                        <div class="tower-history" id="tower-history">
                            <div style="text-align: center; color: #94a3b8; padding: 20px;">L'historique des parties apparaÃ®tra ici</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION CADEAUX & RETRAIT -->
            <div id="sec-redeem" class="section">
                <h2>ðŸŽ Boutique Cadeaux</h2>
                <p style="color: #94a3b8; margin-bottom: 30px;">Ã‰change tes diamants contre de vraies cartes cadeaux !</p>

                <!-- NOUVEAU : RETRAIT / CONVERSION DIAMANTS -> EUROS -->
                <div class="withdraw-card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <h3 style="margin-bottom:5px; color:var(--primary);">Convertir des Diamants en Euros</h3>
                            <p style="color:#cbd5e1; margin:0;">Taux estimÃ© : <strong>500 ðŸ’Ž = 1â‚¬</strong>. Les fonds seront envoyÃ©s dans un dÃ©lai de <strong>7 jours</strong> aprÃ¨s validation. Fournis les informations nÃ©cessaires selon la mÃ©thode choisie.</p>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:#94a3b8; font-size:0.9rem;">Solde actuel</div>
                            <div style="font-weight:bold; font-size:1.1rem;">ðŸ’Ž <span id="withdraw-balance">0</span></div>
                            <div style="color:#cbd5e1;">â‰ˆ <span id="withdraw-balance-eur">0.00â‚¬</span></div>
                        </div>
                    </div>

                    <div style="margin-top:15px;" class="withdraw-row">
                        <div>
                            <form id="withdraw-form" onsubmit="app.requestWithdrawal(event)">
                                <div class="form-group">
                                    <label>Montant souhaitÃ© en â‚¬</label>
                                    <input type="number" id="withdraw-eur" min="1" step="0.01" placeholder="Ex : 10.00" />
                                </div>
                                <div class="form-group">
                                    <label>Ou Montant en ðŸ’Ž (sera converti)</label>
                                    <input type="number" id="withdraw-diamonds" min="1" step="1" placeholder="Ex : 5000" />
                                </div>

                                <div class="form-group">
                                    <label>MÃ©thode de paiement</label>
                                    <select id="withdraw-method" onchange="app.toggleWithdrawFields()">
                                        <option value="paypal">PayPal</option>
                                        <option value="crypto">Cryptomonnaie</option>
                                        <option value="bank">Carte / IBAN</option>
                                    </select>
                                </div>

                                <div id="withdraw-fields"></div>

                                <div style="display:flex; gap:10px; margin-top:10px;">
                                    <button class="btn-main" type="submit" style="flex:1;">Demander le retrait</button>
                                    <button type="button" class="btn-main" onclick="app.fillMaxWithdraw()" style="background:#333; width:140px;">Max</button>
                                </div>

                                <div class="withdraw-summary" id="withdraw-summary" style="display:none; margin-top:12px;"></div>
                            </form>
                        </div>

                        <div class="withdraw-right">
                            <h4 style="margin-bottom:8px;">Informations importantes</h4>
                            <p style="color:#cbd5e1; font-size:0.95rem;">- Les retraits sont traitÃ©s sous 7 jours ouvrÃ©s.<br>- Les informations fournies sont nÃ©cessaires pour vous payer (PayPal / Crypto / IBAN).<br>- Merci d'utiliser notre casino en ligne !</p>
                            <div style="margin-top:10px;">
                                <button class="btn-main" onclick="app.showMyWithdrawals()" style="background:var(--accent)">Mes demandes</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="shop-grid" style="margin-top:20px;"> 
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #ff9900, #ffcc00)">AMAZON<br>10â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 5,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Amazon 10â‚¬', 5000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #00439c, #0070d1)">PSN<br>20â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 10,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('PSN 20â‚¬', 10000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #171a21, #66c0f4)">STEAM<br>50â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 25,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Steam 50â‚¬', 25000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #1DB954, #191414)">SPOTIFY<br>3 mois</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 8,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Spotify 3 mois', 8000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #dd4b39, #c53727)">NETFLIX<br>1 mois</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 6,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Netflix 1 mois', 6000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #3bccff, #1fb0d1)">GOOGLE PLAY<br>15â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 7,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Google Play 15â‚¬', 7500)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #a335ee, #7b68ee)">V-BUCKS<br>2,800</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 12,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Fortnite V-Bucks 2800', 12000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #1b1b3f, #5c3aee)">FIFA POINTS<br>4,600</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 15,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('FIFA Points 4600', 15000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #00a8e1, #0055cc)">CLASH ROYALE<br>500 Gems</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 8,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Clash Royale 500 Gems', 8500)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #ff6b00, #ffb700)">PLAYSTORE<br>20â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 10,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Play Store 20â‚¬', 10000)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #f4b942, #d4802d)">XBOX<br>25â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 12,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Xbox 25â‚¬', 12500)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #2a2a2a, #ffd700)">APPLE ITUNES<br>15â‚¬</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 7,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Apple iTunes 15â‚¬', 7500)">Ã‰changer</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #ef4444, #1f2937)">YOUTUBE PREMIUM<br>3 mois</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">CoÃ»t: <strong style="color: var(--gold)">ðŸ’Ž 9,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('YouTube Premium 3 mois', 9000)">Ã‰changer</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- WELCOME OVERLAY (affiche explicative) -->
    <div id="welcome-overlay" class="overlay">
        <div class="welcome-box">
            <div class="welcome-grid">
                <div>
                    <div class="welcome-title">Bienvenue sur The Royal Casino</div>
                    <p class="welcome-copy">Ici tu peux ouvrir des caisses, jouer Ã  des mini-jeux (Mines, Blackjack, Slots) et Ã©changer tes diamants contre de vraies cartes cadeaux. Les diamants sont la monnaie du site : gagne-les en jouant ou achÃ¨te-les dans la boutique.</p>
                    <ul class="muted">
                        <li><strong>Diamants (ðŸ’Ž)</strong> : monnaie pour ouvrir des caisses et acheter des cadeaux.</li>
                        <li><strong>Caisses</strong> : achÃ¨te et ouvre pour gagner des objets, certains trÃ¨s rares.</li>
                        <li><strong>MarchÃ©</strong> : vends ou achÃ¨te des objets entre joueurs.</li>
                        <li><strong>Retraits</strong> : convertis tes diamants en euros (processus manuel, dÃ©lai ~7 jours).</li>
                    </ul>

                    <div style="margin-top:18px; display:flex; gap:10px;">
                        <button class="btn-main" onclick="app.showTutorial(true)">DÃ©marrer le tutoriel</button>
                        <button class="btn-main" style="background:#333" onclick="app.closeWelcome()">Commencer Ã  jouer</button>
                    </div>
                </div>

                <div style="text-align:center;">
                    <div style="font-size: 4rem; margin-bottom: 12px;">ðŸ’Ž</div>
                    <div class="muted" style="margin-bottom:10px;">Conseil rapide</div>
                    <div style="background: rgba(0,0,0,0.2); padding:12px; border-radius:8px;">
                        <p style="margin-bottom:8px;"><strong>Astuce :</strong> Ouvre d'abord des caisses communes pour te faire une rÃ©serve d'objets Ã  vendre puis investis dans des packs lorsque tu veux monter en gamme.</p>
                    </div>
                    <div style="margin-top:12px;">
                        <label style="display:flex; align-items:center; gap:8px; justify-content:center;">
                            <input type="checkbox" id="welcome-dontshow" /> <span class="muted">Ne plus afficher cette affiche</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TUTORIAL OVERLAY -->
    <div id="tutorial-overlay" class="overlay">
        <div class="tutorial-box">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="color:var(--primary)">Tutoriel rapide</h2>
                <button class="btn-close" onclick="app.closeTutorial()">Ã—</button>
            </div>

            <div class="tutorial-steps">
                <div class="tutorial-step" data-step="1">
                    <h3>1 â€” Ã€ quoi servent les diamants ?</h3>
                    <p class="muted">Les diamants (ðŸ’Ž) sont la monnaie principale. Tu peux :</p>
                    <ul class="muted">
                        <li>Acheter des caisses et des packs dans la boutique.</li>
                        <li>Placer des mises dans les jeux (Mines, Blackjack, Slots).</li>
                        <li>Ã‰changer contre des cartes cadeaux via la boutique Cadeaux.</li>
                    </ul>
                </div>

                <div class="tutorial-step" data-step="2">
                    <h3>2 â€” Comment miser</h3>
                    <p class="muted">Choisis ta mise dans le jeu voulu, confirme la partie.</p>
                    <ul class="muted">
                        <li>Si tu gagnes, tes diamants augmentent (gain calculÃ© selon le jeu).</li>
                        <li>Si tu perds, la mise est perdue.</li>
                        <li>Utilise le bouton "Encaisser" dans Mines pour rÃ©cupÃ©rer tes gains avant de risquer une nouvelle case.</li>
                    </ul>
                </div>

                <div class="tutorial-step" data-step="3">
                    <h3>3 â€” La boutique et les packs</h3>
                    <p class="muted">La boutique contient des packs standards et des packs Ã©normes :</p>
                    <ul class="muted">
                        <li>Les packs Ã©normes (ex : Pack Ã‰norme, Giga Pack, Pack Titan) donnent beaucoup de diamants et parfois des bonus rares.</li>
                        <li>Les packs limitÃ©s peuvent contenir des drops lÃ©gendaires ou des items exclusifs.</li>
                        <li>AchÃ¨te en fonction de ton budget et de ce que tu veux dÃ©bloquer.</li>
                    </ul>
                </div>

                <div class="tutorial-step" data-step="4">
                    <h3>4 â€” Inventaire & MarchÃ©</h3>
                    <p class="muted">Les objets gagnÃ©s dans les caisses vont dans ton inventaire :</p>
                    <ul class="muted">
                        <li>Vends immÃ©diatement un objet pour obtenir des diamants.</li>
                        <li>Ou mets-le sur le marchÃ© pour peut-Ãªtre obtenir plus (les bots achÃ¨tent aussi).</li>
                    </ul>
                </div>

                <div class="tutorial-step" data-step="5">
                    <h3>5 â€” Retraits & sÃ©curitÃ©</h3>
                    <p class="muted">Tu peux demander un retrait : 500 ðŸ’Ž = 1â‚¬. Les retraits prennent du temps et doivent Ãªtre traitÃ©s.</p>
                    <ul class="muted">
                        <li>Ne partage jamais ton mot de passe.</li>
                        <li>En production, les paiements doivent Ãªtre sÃ©curisÃ©s (Stripe/PayPal, hashing des mots de passe).</li>
                    </ul>
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:14px;">
                <div class="tutorial-indicators" id="tutorial-indicators"></div>
                <div class="tutorial-controls">
                    <button class="btn-main" id="tutorial-prev" style="background:#333" onclick="app.tutorialPrev()">PrÃ©cÃ©dent</button>
                    <button class="btn-main" id="tutorial-next" onclick="app.tutorialNext()">Suivant</button>
                    <button class="btn-main" id="tutorial-done" style="display:none;" onclick="app.closeTutorial()">TerminÃ©</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE PAIEMENT -->
    <div id="payment-overlay" class="payment-overlay">
        <div class="payment-modal">
            <button class="btn-close" onclick="app.closePayment()">Ã—</button>
            
            <div class="payment-header">
                <h3>Acheter des Diamants</h3>
                <div class="diamond-amount" id="payment-amount">ðŸ’Ž 0</div>
                <div class="diamond-price" id="payment-price">0.00â‚¬</div>
            </div>

            <div style="margin-bottom: 20px;">
                <p style="text-align: center; color: #94a3b8; margin-bottom: 15px;">Choisis ton mode de paiement :</p>
                <button class="payment-method" onclick="app.showPaymentForm('card')">
                    ðŸ’³ Carte Bancaire
                </button>
                <button class="payment-method" onclick="app.showPaymentForm('paypal')">
                    <span style="color: #0070BA;">P</span><span style="color: #003087;">P</span> PayPal
                </button>
                <button class="payment-method" onclick="app.showPaymentForm('crypto')">
                    â‚¿ Cryptomonnaie
                </button>
            </div>

            <!-- Formulaire Carte Bancaire -->
            <form id="card-form" class="payment-form" onsubmit="app.processPayment(event, 'card')">
                <div class="form-group">
                    <label>NumÃ©ro de carte</label>
                    <input type="text" placeholder="1234 5678 9012 3456" maxlength="19" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date d'expiration</label>
                        <input type="text" placeholder="MM/AA" maxlength="5" required>
                    </div>
                    <div class="form-group">
                        <label>CVV</label>
                        <input type="text" placeholder="123" maxlength="3" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Nom sur la carte</label>
                    <input type="text" placeholder="JEAN DUPONT" required>
                </div>
                <button type="submit" class="btn-main">Payer <span id="card-price">0.00â‚¬</span></button>
            </form>

            <!-- Formulaire PayPal -->
            <form id="paypal-form" class="payment-form" onsubmit="app.processPayment(event, 'paypal')">
                <div class="form-group">
                    <label>Email PayPal</label>
                    <input type="email" placeholder="ton@email.com" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe PayPal</label>
                    <input type="password" placeholder="Ton mot de passe" required>
                </div>
                <button type="submit" class="btn-main">Continuer avec PayPal</button>
                <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 10px; text-align: center;">
                    Tu seras redirigÃ© vers PayPal pour finaliser
                </p>
            </form>

            <!-- Formulaire Crypto -->
            <form id="crypto-form" class="payment-form" onsubmit="app.processPayment(event, 'crypto')">
                <div class="form-group">
                    <label>Cryptomonnaie</label>
                    <select style="width: 100%; padding: 14px; background: rgba(15, 23, 42, 0.8); border: 2px solid #334155; color: white; border-radius: 8px;" required>
                        <option value="btc">Bitcoin (BTC)</option>
                        <option value="eth">Ethereum (ETH)</option>
                        <option value="usdt">Tether (USDT)</option>
                        <option value="bnb">Binance Coin (BNB)</option>
                    </select>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <p style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 10px;">Adresse de paiement :</p>
                    <p style="font-family: monospace; color: var(--primary); word-break: break-all; font-size: 0.9rem;">
                        1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa
                    </p>
                </div>
                <button type="submit" class="btn-main">J'ai effectuÃ© le paiement</button>
                <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 10px; text-align: center;">
                    Les diamants seront crÃ©ditÃ©s aprÃ¨s confirmation
                </p>
            </form>
        </div>
    </div>

    <!-- ANIMATION DE SUCCÃˆS -->
    <div id="success-animation" class="success-animation">
        <div class="success-checkmark"></div>
        <div class="success-message">
            <h2>Paiement RÃ©ussi !</h2>
            <p>Tes diamants ont Ã©tÃ© ajoutÃ©s Ã  ton compte</p>
            <div class="success-diamonds" id="success-diamonds-amount">ðŸ’Ž 0</div>
            <button class="btn-main" onclick="app.closeSuccess()" style="max-width: 300px;">Continuer</button>
        </div>
    </div>

    <script>
        // Taux de conversion pour les retraits
        const DIAMONDS_PER_EURO = 500; // 500 diamants = 1â‚¬

        const ITEMS_DB = {
            common: [
                { id: 'c1', name: 'Vieux Caillou', val: 2 },
                { id: 'c2', name: 'Bout de Bois', val: 3 },
                { id: 'c3', name: 'PiÃ¨ce RouillÃ©e', val: 5 },
                { id: 'c4', name: 'Plume UsÃ©e', val: 4 },
                { id: 'z1', name: 'PoussiÃ¨re Inutile', val: 0 },
                { id: 'z2', name: 'Truc CassÃ©', val: 0 }
            ],
            rare: [
                { id: 'r1', name: 'Dague en Fer', val: 20 },
                { id: 'r2', name: 'Potion Bleue', val: 25 },
                { id: 'r3', name: 'Cape Verte', val: 30 },
                { id: 'r4', name: 'Grimoire Ancien', val: 35 },
                { id: 'z1', name: 'PoussiÃ¨re Inutile', val: 0 },
                { id: 'z2', name: 'Truc CassÃ©', val: 0 },
                { id: 'z3', name: 'DÃ©bris Sans Valeur', val: 0 }
            ],
            epic: [
                { id: 'e1', name: 'Ã‰pÃ©e de Cristal', val: 80 },
                { id: 'e2', name: 'Anneau Magique', val: 100 },
                { id: 'e3', name: 'Casque Dragon', val: 120 },
                { id: 'e4', name: 'Armure EnchantÃ©e', val: 140 },
                { id: 'z1', name: 'PoussiÃ¨re Inutile', val: 0 },
                { id: 'z2', name: 'Truc CassÃ©', val: 0 },
                { id: 'z3', name: 'DÃ©bris Sans Valeur', val: 0 }

            ],
            legendary: [
                { id: 'l1', name: 'TrÃ´ne d\'Or', val: 300 },
                { id: 'l2', name: 'Sceptre Royal', val: 400 },
                { id: 'l3', name: 'Orbe de Pouvoir', val: 450 },
                { id: 'z1', name: 'PoussiÃ¨re Inutile', val: 0 },
                { id: 'z2', name: 'Truc CassÃ©', val: 0 },
                { id: 'z3', name: 'DÃ©bris Sans Valeur', val: 0 }

            ],
            mythic: [
                { id: 'm1', name: 'ðŸ’Ž DIAMANT PUR', val: 2500 },
                { id: 'm2', name: 'ðŸ‘‘ COURONNE DIVINE', val: 7500 },
                { id: 'm3', name: 'ðŸŒŸ Ã‰TOILE Ã‰TERNELLE', val: 1500 },
                { id: 'z1', name: 'PoussiÃ¨re Inutile', val: 0 },
                { id: 'z2', name: 'Truc CassÃ©', val: 0 },
                { id: 'z3', name: 'DÃ©bris Sans Valeur', val: 0 }

            ],
            ultrapremium: [
                { id: 'ultra1', name: 'ðŸŽ° JACKPOT ULTRA ðŸ’°', val: 100000 },
                { id: 'ultra_nothing1', name: 'ðŸ’€ VOUS AVEZ PERDU TOUT ! ðŸ’€', val: 0 }
            ]
        };

        const CASE_PRICES = { common: 10, rare: 50, epic: 150, legendary: 500, mythic: 1500, ultrapremium: 25000 };
        let nextFreeCase = parseInt(localStorage.getItem('dc_freecase_time')) || 0;

        const app = {
            user: null,
            marketData: [],
            isSpinning: false,
            currentPackage: null,
            usersDB: {}, // Base de donnÃ©es locale des utilisateurs
            withdrawals: [],

            init: function() {
                // Charger les utilisateurs
                const savedUsers = localStorage.getItem('dc_users');
                this.usersDB = savedUsers ? JSON.parse(savedUsers) : {};

                // Charger le marchÃ©
                const savedMarket = localStorage.getItem('dc_market');
                this.marketData = savedMarket ? JSON.parse(savedMarket) : [
                    { id: Date.now(), seller: 'Bot_Alpha', item: ITEMS_DB.rare[0], price: 30, rarity: 'rare' },
                    { id: Date.now()+1, seller: 'Bot_Beta', item: ITEMS_DB.epic[0], price: 90, rarity: 'epic' }
                ];

                // Charger les retraits existants
                const savedWithdrawals = localStorage.getItem('dc_withdrawals');
                this.withdrawals = savedWithdrawals ? JSON.parse(savedWithdrawals) : [];

                // === BOTS MARKET AUTO ===
                setInterval(() => {
                    const botNames = ["Ares", "Nyx", "Kappa", "Zero"];

                    const randomBot = botNames[Math.floor(Math.random() * botNames.length)];
                    const rarityList = ["common", "rare", "epic", "legendary"];
                    const rarity = rarityList[Math.floor(Math.random() * rarityList.length)];

                    const pool = ITEMS_DB[rarity];
                    const item = pool[Math.floor(Math.random() * pool.length)];

                    app.marketData.push({
                        id: Date.now(),
                        seller: randomBot,
                        item: item,
                        price: Math.floor(item.val * (1 + Math.random() * 1.5)),
                        rarity: rarity
                    });

                    app.saveUser();
                }, 20000); // un bot ajoute une offre toutes les 20 sec
                // === BOTS QUI ACHÃˆTENT DES ITEMS ===
                setInterval(() => {
                    if (app.marketData.length === 0) return;

                    const chance = Math.random();
                    if (chance < 0.4) return; // 40% de chance quâ€™un bot achÃ¨te

                    const offers = app.marketData.filter(o => o.seller !== "BOT");
                    if (offers.length === 0) return;

                    const pick = offers[Math.floor(Math.random() * offers.length)];

                    // Trouver propriÃ©taire
                    const seller = app.usersDB[pick.seller];
                    if (seller) {
                        seller.diamonds += pick.price;
                        app.usersDB[pick.seller] = seller;
                        localStorage.setItem('dc_users', JSON.stringify(app.usersDB));
                    }

                    // Notif si c'est toi
                    if (pick.seller === app.user?.name) {
                        app.notify(`ðŸ¤– Un bot a achetÃ© ton item : +${pick.price}ðŸ’Ž`, "success");
                        app.user.diamonds += pick.price;
                        app.saveUser();
                    }

                    // Retirer l'offre
                    app.marketData = app.marketData.filter(o => o.id !== pick.id);
                    app.saveUser();
                }, 15000); // tentative d'achat bot toutes les 15 sec

                // VÃ©rifier si connectÃ©
                const currentUser = localStorage.getItem('dc_current_user');
                if (currentUser) {
                    this.user = JSON.parse(currentUser);
                    this.showApp();
                }
                this.updateWithdrawBalanceUI();
            },

            switchAuthTab: function(tab) {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                
                event.target.classList.add('active');
                document.getElementById(tab + '-form').classList.add('active');
            },

            register: function(e) {
                e.preventDefault();
                
                const username = document.getElementById('register-username').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;

                if (password !== confirm) {
                    this.notify('Les mots de passe ne correspondent pas !', 'error');
                    return;
                }

                if (this.usersDB[username]) {
                    this.notify('Ce nom d\'utilisateur existe dÃ©jÃ  !', 'error');
                    return;
                }

                // CrÃ©er le compte
                this.usersDB[username] = {
                    username: username,
                    email: email,
                    password: password, // En production, il faudrait hasher le mot de passe
                    diamonds: 200, // Bonus d'inscription
                    inventory: [],
                    createdAt: Date.now(),
                    seenWelcome: false,
                    seenTutorial: false
                };

                localStorage.setItem('dc_users', JSON.stringify(this.usersDB));
                
                this.notify('Compte crÃ©Ã© avec succÃ¨s ! ðŸŽ‰', 'success');
                
                // Auto-connexion
                this.user = {
                    name: username,
                    email: email,
                    diamonds: 200,
                    inventory: [],
                    seenWelcome: false,
                    seenTutorial: false
                };
                
                this.saveUser();
                this.showApp();
                this.notify(`Bienvenue ${username} ! +200 ðŸ’Ž de bonus !`, 'success');

                // Forcer l'affiche de bienvenue & tutoriel pour nouveaux comptes
                this.showWelcome(true);
            },

            login: function(e) {
                e.preventDefault();
                
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;

                const userAccount = this.usersDB[username];
                
                if (!userAccount) {
                    this.notify('Utilisateur introuvable !', 'error');
                    return;
                }

                if (userAccount.password !== password) {
                    this.notify('Mot de passe incorrect !', 'error');
                    return;
                }

                // Connexion rÃ©ussie
                this.user = {
                    name: username,
                    email: userAccount.email,
                    diamonds: userAccount.diamonds,
                    inventory: userAccount.inventory || [],
                    seenWelcome: !!userAccount.seenWelcome,
                    seenTutorial: !!userAccount.seenTutorial
                };

                this.saveUser();
                this.showApp();
                this.notify(`Content de te revoir ${username} !`, 'success');

                // Show welcome if user never saw it
                if (!this.user.seenWelcome) {
                    this.showWelcome();
                }
            },

            logout: function() {
                localStorage.removeItem('dc_current_user');
                location.reload();
            },

            saveUser: function() {
                if (!this.user) return;
                localStorage.setItem('dc_current_user', JSON.stringify(this.user));
                
                // Mettre Ã  jour la base de donnÃ©es
                if (this.usersDB[this.user.name]) {
                    this.usersDB[this.user.name].diamonds = this.user.diamonds;
                    this.usersDB[this.user.name].inventory = this.user.inventory;
                    this.usersDB[this.user.name].seenWelcome = !!this.user.seenWelcome;
                    this.usersDB[this.user.name].seenTutorial = !!this.user.seenTutorial;
                    localStorage.setItem('dc_users', JSON.stringify(this.usersDB));
                }
                
                localStorage.setItem('dc_market', JSON.stringify(this.marketData));
                localStorage.setItem('dc_withdrawals', JSON.stringify(this.withdrawals));
                this.updateUI();
            },

            showApp: function() {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                this.updateUI();
                this.renderMarket();

                // If user hasn't seen welcome, show it
                if (this.user && !this.user.seenWelcome) {
                    this.showWelcome();
                }
            },

            updateUI: function() {
                if (!this.user) return;
                document.getElementById('user-name').innerText = this.user.name;
                document.getElementById('user-diamonds').innerText = this.user.diamonds.toLocaleString();
                this.updateEuroDisplay();
                this.renderInventory();
                this.updateWithdrawBalanceUI();
            },

            updateEuroDisplay: function() {
                const euros = (this.user.diamonds / DIAMONDS_PER_EURO);
                document.getElementById('user-euros').innerText = `${euros.toFixed(2)}â‚¬`;
            },

            updateWithdrawBalanceUI: function() {
                const bal = this.user ? this.user.diamonds : 0;
                const wb = document.getElementById('withdraw-balance');
                if (wb) wb.innerText = bal.toLocaleString();
                const we = document.getElementById('withdraw-balance-eur');
                if (we) we.innerText = `${(bal / DIAMONDS_PER_EURO).toFixed(2)}â‚¬`;
            },

            nav: function(screen) {
                document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
                const target = document.getElementById('sec-' + screen);
                if (target) target.classList.add('active');
                
                document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
                event.target.classList.add('active');

                if (screen === 'market') {
                    this.renderMarket();
                }
                
                if (screen === 'mines') {
                    this.updateMinesUI();
                }
                
                if (screen === 'blackjack') {
                    this.updateBJUI();
                }
                
                if (screen === 'slots') {
                    this.initAllSlots();
                    ['fruits', 'treasure', 'casino', 'animals'].forEach(machine => {
                        this.updateSlotsUI(machine);
                    });
                }
            },

            // -----------------------
            // WELCOME & TUTORIAL
            // -----------------------
            showWelcome: function(force = false) {
                if (!this.user) {
                    // For non-logged visitors, still show welcome once per browser session
                    const globalSeen = localStorage.getItem('dc_seen_welcome_global');
                    if (!force && globalSeen) return;
                    document.getElementById('welcome-overlay').classList.add('active');
                    return;
                }
                if (!force && this.user.seenWelcome) return;
                document.getElementById('welcome-overlay').classList.add('active');
            },

            closeWelcome: function() {
                // Save checkbox preference
                const dontShow = document.getElementById('welcome-dontshow')?.checked;
                if (this.user) {
                    this.user.seenWelcome = !!dontShow || true; // mark as seen when closed
                    this.saveUser();
                } else {
                    if (dontShow) localStorage.setItem('dc_seen_welcome_global', '1');
                }
                document.getElementById('welcome-overlay').classList.remove('active');
            },

            showTutorial: function(force = false) {
                if (!this.user && !force) {
                    // Allow non-logged users to view tutorial but do not persist
                }
                if (!force && this.user && this.user.seenTutorial) return;
                const overlay = document.getElementById('tutorial-overlay');
                overlay.classList.add('active');

                // Setup steps UI
                const steps = Array.from(document.querySelectorAll('.tutorial-step'));
                steps.forEach((s, i) => s.classList.toggle('active', i === 0));
                this._tutorialIndex = 0;
                this._tutorialSteps = steps;
                this._updateTutorialControls();
                // indicators
                const indicators = document.getElementById('tutorial-indicators');
                indicators.innerHTML = '';
                steps.forEach((s, idx) => {
                    const d = document.createElement('div');
                    d.className = 'tutorial-dot' + (idx === 0 ? ' active' : '');
                    indicators.appendChild(d);
                });
            },

            tutorialNext: function() {
                if (!this._tutorialSteps) return;
                if (this._tutorialIndex < this._tutorialSteps.length - 1) {
                    this._tutorialSteps[this._tutorialIndex].classList.remove('active');
                    this._tutorialIndex++;
                    this._tutorialSteps[this._tutorialIndex].classList.add('active');
                    this._updateTutorialControls();
                }
            },

            tutorialPrev: function() {
                if (!this._tutorialSteps) return;
                if (this._tutorialIndex > 0) {
                    this._tutorialSteps[this._tutorialIndex].classList.remove('active');
                    this._tutorialIndex--;
                    this._tutorialSteps[this._tutorialIndex].classList.add('active');
                    this._updateTutorialControls();
                }
            },

            _updateTutorialControls: function() {
                const prev = document.getElementById('tutorial-prev');
                const next = document.getElementById('tutorial-next');
                const done = document.getElementById('tutorial-done');
                prev.style.display = this._tutorialIndex === 0 ? 'none' : 'inline-block';
                if (this._tutorialIndex === this._tutorialSteps.length - 1) {
                    next.style.display = 'none';
                    done.style.display = 'inline-block';
                } else {
                    next.style.display = 'inline-block';
                    done.style.display = 'none';
                }
                // indicators
                const dots = document.querySelectorAll('.tutorial-dot');
                dots.forEach((d, i) => d.classList.toggle('active', i === this._tutorialIndex));
            },

            closeTutorial: function() {
                document.getElementById('tutorial-overlay').classList.remove('active');
                if (this.user) {
                    this.user.seenTutorial = true;
                    this.saveUser();
                }
            },

            // -----------------------
            // Packs & boutique
            // -----------------------
            selectPackage: function(a, price) {
                // Accept object or (amount, price)
                let pkg;
                if (typeof a === 'object') {
                    pkg = a;
                } else {
                    pkg = { amount: a, price: price };
                }
                this.currentPackage = pkg;
                document.getElementById('payment-amount').innerText = `ðŸ’Ž ${pkg.amount.toLocaleString()}`;
                document.getElementById('payment-price').innerText = `${(pkg.price || 0).toFixed(2)}â‚¬`;
                document.getElementById('card-price').innerText = `${(pkg.price || 0).toFixed(2)}â‚¬`;
                document.getElementById('payment-overlay').classList.add('active');
            },

            closePayment: function() {
                document.getElementById('payment-overlay').classList.remove('active');
                document.querySelectorAll('.payment-form').forEach(f => f.classList.remove('active'));
            },

            showPaymentForm: function(type) {
                document.querySelectorAll('.payment-form').forEach(f => f.classList.remove('active'));
                document.getElementById(type + '-form').classList.add('active');
            },

            processPayment: function(e, method) {
                e.preventDefault();
                
                this.closePayment();
                
                // Simulation de traitement
                setTimeout(() => {
                    // If package contains special bonuses (object) we can grant them here
                    let amount = 0;
                    if (this.currentPackage) amount = this.currentPackage.amount || 0;
                    this.user.diamonds += amount;

                    // simulate bonus: if package has bonus string, give small chance extra
                    if (this.currentPackage && this.currentPackage.bonus) {
                        // apply simple extra for enormous packs
                        if (this.currentPackage.amount >= 100000) {
                            // grant a rare item occasionally
                            if (Math.random() > 0.5) {
                                const item = ITEMS_DB.mythic[Math.floor(Math.random() * ITEMS_DB.mythic.length)];
                                this.user.inventory.push({ ...item, rarity: 'mythic', uid: Date.now() });
                                this.notify('ðŸŽ Bonus : un item mythic a Ã©tÃ© ajoutÃ© Ã  ton inventaire !', 'success');
                            }
                        }
                    }

                    this.saveUser();
                    
                    document.getElementById('success-diamonds-amount').innerText = `ðŸ’Ž +${amount.toLocaleString()}`;
                    document.getElementById('success-animation').classList.add('active');
                    
                    this.notify(`ðŸ’Ž ${amount.toLocaleString()} diamants ajoutÃ©s !`, 'success');
                }, 500);
            },

            closeSuccess: function() {
                document.getElementById('success-animation').classList.remove('active');
            },

            generateCardCode: function(cardType) {
                const getRandomHex = (length) => {
                    let result = '';
                    for (let i = 0; i < length; i++) {
                        result += Math.floor(Math.random() * 16).toString(16).toUpperCase();
                    }
                    return result;
                };
                
                const getRandomNum = (length) => {
                    let result = '';
                    for (let i = 0; i < length; i++) {
                        result += Math.floor(Math.random() * 10);
                    }
                    return result;
                };
                
                const codes = {
                    'Amazon': `AMZN-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}`,
                    'PSN': `${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Steam': `STEAM-${getRandomHex(8)}-${getRandomHex(8)}`,
                    'Spotify': `SPT${getRandomNum(5)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Netflix': `NF-${getRandomNum(3)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Google Play': `GPT-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Fortnite': `VB-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}`,
                    'FIFA': `FUT${getRandomNum(4)}${getRandomNum(4)}${getRandomNum(4)}${getRandomNum(4)}`,
                    'Clash Royale': `CR-${getRandomNum(5)}-${getRandomNum(5)}-${getRandomNum(5)}`,
                    'Play Store': `PS-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Xbox': `${getRandomNum(3)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Apple': `APP-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'YouTube': `YT${getRandomNum(3)}-${getRandomNum(5)}-${getRandomNum(5)}-${getRandomNum(5)}`
                };
                
                for (let key in codes) {
                    if (cardType.includes(key)) {
                        return codes[key];
                    }
                }
                
                return `GC-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}`;
            },

            redeemCode: function(name, cost) {
                if (this.user.diamonds < cost) {
                    return this.notify(`Il te faut ${cost.toLocaleString()} diamants !`, "error");
                }

                this.user.diamonds -= cost;
                this.saveUser();
                
                const code = this.generateCardCode(name);
                
                // Afficher dans un message stylÃ©
                const codeDisplay = document.createElement('div');
                codeDisplay.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--bg-panel);
                    padding: 40px;
                    border-radius: 16px;
                    border: 2px solid var(--gold);
                    z-index: 500;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.9);
                    animation: slideUp 0.4s ease;
                `;
                codeDisplay.innerHTML = `
                    <h2 style="color: var(--gold); margin-bottom: 20px;">ðŸŽ‰ FÃ‰LICITATIONS !</h2>
                    <p style="margin-bottom: 15px; color: #cbd5e1;">Voici ta carte cadeau <strong>${name}</strong></p>
                    <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <p style="font-size: 1.3rem; font-family: monospace; color: var(--primary); letter-spacing: 3px; font-weight: bold;">${code}</p>
                    </div>
                    <p style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 20px;">ðŸ“‹ Note bien ce code, il ne sera plus affichÃ© !</p>
                    <button class="btn-main" onclick="this.parentElement.remove()" style="max-width: 200px;">Fermer</button>
                `;
                document.body.appendChild(codeDisplay);
                
                this.notify("ðŸŽ Carte cadeau rÃ©cupÃ©rÃ©e !", "success");
            },

            notify: function(msg, type='info') {
                const box = document.createElement('div');
                box.className = 'toast';
                box.innerText = msg;
                if(type === 'error') box.style.borderLeftColor = 'var(--danger)';
                if(type === 'success') box.style.borderLeftColor = 'var(--success)';
                
                document.getElementById('alert-container').appendChild(box);
                setTimeout(() => box.remove(), 3500);
            },

            // -----------------------
            // SystÃ¨me de retrait
            // -----------------------
            toggleWithdrawFields: function() {
                const method = document.getElementById('withdraw-method').value;
                const container = document.getElementById('withdraw-fields');
                container.innerHTML = '';

                if (method === 'paypal') {
                    container.innerHTML = `
                        <div class="form-group">
                            <label>Email PayPal</label>
                            <input type="email" id="withdraw-paypal-email" placeholder="ton@email.com" required>
                        </div>
                        <div class="form-group">
                            <label>Nom complet (pour PayPal)</label>
                            <input type="text" id="withdraw-paypal-name" placeholder="Jean Dupont" required>
                        </div>
                    `;
                } else if (method === 'crypto') {
                    container.innerHTML = `
                        <div class="form-group">
                            <label>Cryptomonnaie</label>
                            <select id="withdraw-crypto-currency" style="width:100%; padding:12px; background:rgba(15,23,42,0.8); border:2px solid #334155; color:white; border-radius:8px;">
                                <option value="btc">Bitcoin (BTC)</option>
                                <option value="eth">Ethereum (ETH)</option>
                                <option value="usdt">Tether (USDT)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Adresse de rÃ©ception</label>
                            <input type="text" id="withdraw-crypto-address" placeholder="Adresse crypto" required>
                        </div>
                    `;
                } else if (method === 'bank') {
                    container.innerHTML = `
                        <div class="form-group">
                            <label>Nom complet</label>
                            <input type="text" id="withdraw-bank-name" placeholder="Jean Dupont" required>
                        </div>
                        <div class="form-group">
                            <label>IBAN / RIB</label>
                            <input type="text" id="withdraw-bank-iban" placeholder="FR76 3000 6000 0112 3456 7890 189" required>
                        </div>
                        <div class="form-group">
                            <label>Note (optionnel)</label>
                            <input type="text" id="withdraw-bank-note" placeholder="Informations supplÃ©mentaires (ex: BIC)">
                        </div>
                    `;
                }
            },

            fillMaxWithdraw: function() {
                if (!this.user) return;
                const maxEur = (this.user.diamonds / DIAMONDS_PER_EURO);
                document.getElementById('withdraw-eur').value = maxEur.toFixed(2);
                document.getElementById('withdraw-diamonds').value = this.user.diamonds;
            },

            requestWithdrawal: function(e) {
                e.preventDefault();
                if (!this.user) {
                    return this.notify('Connecte-toi pour demander un retrait.', 'error');
                }

                const eurInput = parseFloat(document.getElementById('withdraw-eur').value || 0);
                const diamondsInput = parseInt(document.getElementById('withdraw-diamonds').value || 0);

                let euros = 0;
                if (eurInput > 0) euros = parseFloat(eurInput.toFixed(2));
                else if (diamondsInput > 0) euros = parseFloat((diamondsInput / DIAMONDS_PER_EURO).toFixed(2));
                else return this.notify('Indique un montant en â‚¬ ou en diamants.', 'error');

                if (euros < 1) return this.notify('Montant minimum : 1â‚¬', 'error');

                const requiredDiamonds = Math.ceil(euros * DIAMONDS_PER_EURO);

                if (this.user.diamonds < requiredDiamonds) {
                    return this.notify(`Pas assez de diamants. Il faut ${requiredDiamonds.toLocaleString()} ðŸ’Ž`, 'error');
                }

                const method = document.getElementById('withdraw-method').value;
                const details = {};

                if (method === 'paypal') {
                    const email = document.getElementById('withdraw-paypal-email')?.value?.trim();
                    const name = document.getElementById('withdraw-paypal-name')?.value?.trim();
                    if (!email || !name) return this.notify('Remplis les informations PayPal.', 'error');
                    details.paypalEmail = email;
                    details.name = name;
                } else if (method === 'crypto') {
                    const curr = document.getElementById('withdraw-crypto-currency')?.value;
                    const addr = document.getElementById('withdraw-crypto-address')?.value?.trim();
                    if (!curr || !addr) return this.notify('Remplis les informations Crypto.', 'error');
                    details.currency = curr;
                    details.address = addr;
                } else if (method === 'bank') {
                    const name = document.getElementById('withdraw-bank-name')?.value?.trim();
                    const iban = document.getElementById('withdraw-bank-iban')?.value?.trim();
                    const note = document.getElementById('withdraw-bank-note')?.value?.trim();
                    if (!name || !iban) return this.notify('Remplis le nom et l\'IBAN.', 'error');
                    details.name = name;
                    details.iban = iban;
                    details.note = note;
                }

                // DÃ©duire immÃ©diatement les diamants
                this.user.diamonds -= requiredDiamonds;

                // CrÃ©er la demande
                const requestedAt = Date.now();
                const processDate = requestedAt + (7 * 24 * 60 * 60 * 1000); // +7 jours
                const req = {
                    id: 'W' + Date.now(),
                    user: this.user.name,
                    euros: euros,
                    diamondsDeducted: requiredDiamonds,
                    method: method,
                    details: details,
                    requestedAt: requestedAt,
                    processDate: processDate,
                    status: 'pending' // pending / processed
                };

                this.withdrawals.push(req);
                this.saveUser();

                // Afficher rÃ©sumÃ© modal simple
                const summary = document.getElementById('withdraw-summary');
                const date = new Date(processDate);
                summary.style.display = 'block';
                summary.innerHTML = `âœ… Demande enregistrÃ©e : <strong>${euros.toFixed(2)}â‚¬</strong> (dÃ©duit ${requiredDiamonds.toLocaleString()} ðŸ’Ž). Traitement estimÃ© le <strong>${date.toLocaleDateString()}</strong>. ID: ${req.id}`;
                
                this.notify(`Demande de retrait de ${euros.toFixed(2)}â‚¬ crÃ©Ã©e. ID: ${req.id}`, 'success');
                document.getElementById('withdraw-form').reset();
                this.toggleWithdrawFields(); // rÃ©initialise les champs dynamiques
                this.updateWithdrawBalanceUI();
            },

            showMyWithdrawals: function() {
                const userRequests = this.withdrawals.filter(w => w.user === (this.user?.name || ''));
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; inset: 0; display:flex; align-items:center; justify-content:center;
                    background: rgba(0,0,0,0.8); z-index:800; padding: 20px;
                `;
                const box = document.createElement('div');
                box.style.cssText = 'background:var(--bg-panel); padding:20px; border-radius:12px; width:100%; max-width:700px; max-height:80vh; overflow:auto; border:2px solid var(--primary);';
                box.innerHTML = `<h3 style="color:var(--primary)">Mes demandes de retrait</h3>`;
                if (userRequests.length === 0) {
                    box.innerHTML += `<p style="color:#cbd5e1">Aucune demande pour le moment.</p>`;
                } else {
                    userRequests.slice().reverse().forEach(r => {
                        const d = new Date(r.requestedAt);
                        const pd = new Date(r.processDate);
                        box.innerHTML += `
                            <div style="background:rgba(0,0,0,0.25); padding:10px; margin:8px 0; border-radius:8px;">
                                <div style="display:flex; justify-content:space-between;">
                                    <div><strong>${r.euros.toFixed(2)}â‚¬</strong> â€” ${r.method.toUpperCase()}</div>
                                    <div style="color:#94a3b8">${r.status.toUpperCase()}</div>
                                </div>
                                <div style="color:#cbd5e1; font-size:0.9rem;">
                                    ID: ${r.id} â€¢ demandÃ©: ${d.toLocaleString()} â€¢ estimÃ©: ${pd.toLocaleDateString()}
                                </div>
                            </div>
                        `;
                    });
                }
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn-main';
                closeBtn.style.marginTop = '10px';
                closeBtn.innerText = 'Fermer';
                closeBtn.onclick = () => modal.remove();
                box.appendChild(closeBtn);
                modal.appendChild(box);
                document.body.appendChild(modal);
            },

            // -----------------------
            // Mines / autres fonctions (inchangÃ©es)
            // -----------------------
            minesState: {
                grid: [],
                mines: [],
                revealed: [],
                gameActive: false,
                bet: 0,
                minesCount: 3,
                revealedCount: 0,
                multiplier: 1
            },

            startMinesGame: function() {
                const betInput = document.getElementById('mines-bet-input');
                const bet = parseInt(betInput.value);
                
                if (!bet || bet < 1) {
                    this.notify('Veuillez entrer un montant valide !', 'error');
                    return;
                }
                
                if (this.user.diamonds < bet) {
                    this.notify('Pas assez de diamants pour cette mise !', 'error');
                    return;
                }
                
                this.minesState.minesCount = parseInt(document.getElementById('mines-slider').value);
                
                if (this.minesState.gameActive) {
                    this.notify('Partie en cours ! Encaissez ou perdez d\'abord.', 'error');
                    return;
                }
                
                this.user.diamonds -= bet;
                this.minesState.bet = bet;
                this.minesState.gameActive = true;
                this.minesState.revealedCount = 0;
                this.minesState.multiplier = 1;
                
                this.initMinesGame();
                this.updateMinesUI();
                
                document.getElementById('btn-start-game').disabled = true;
                document.getElementById('mines-bet-input').disabled = true;
                document.getElementById('mines-slider').disabled = true;
            },

            initMinesGame: function() {
                this.minesState.grid = Array(25).fill(false);
                this.minesState.revealed = Array(25).fill(false);
                
                const minesPositions = [];
                while (minesPositions.length < this.minesState.minesCount) {
                    const pos = Math.floor(Math.random() * 25);
                    if (!minesPositions.includes(pos)) {
                        minesPositions.push(pos);
                    }
                }
                
                this.minesState.mines = minesPositions;
                
                const container = document.getElementById('mines-grid');
                container.innerHTML = '';
                
                for (let i = 0; i < 25; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'mine-cell';
                    cell.id = `mine-cell-${i}`;
                    cell.innerText = '?';
                    cell.onclick = () => this.revealCell(i);
                    container.appendChild(cell);
                }
                
                const msgDiv = document.getElementById('mines-message');
                msgDiv.style.display = 'none';
                
                const multiplierDiv = document.getElementById('multiplier-container');
                multiplierDiv.style.display = 'block';
                
                const cashoutBtn = document.getElementById('btn-cashout');
                cashoutBtn.disabled = false;
                cashoutBtn.style.display = 'block';
            },

            revealCell: function(index) {
                if (!this.minesState.gameActive) return;
                if (this.minesState.revealed[index]) return;
                
                this.minesState.revealed[index] = true;
                const cell = document.getElementById(`mine-cell-${index}`);
                
                const isMine = this.minesState.mines.includes(index);
                
                if (isMine) {
                    cell.classList.add('revealed', 'bomb');
                    cell.innerText = 'ðŸ’£';
                    this.minesGameOver(false);
                } else {
                    cell.classList.add('revealed', 'safe');
                    this.minesState.revealedCount++;
                    
                    this.minesState.multiplier = this.calculateMultiplier();
                    
                    const safe = 25 - this.minesState.minesCount;
                    if (this.minesState.revealedCount === safe) {
                        this.minesGameOver(true);
                    } else {
                        cell.innerText = 'âœ“';
                        this.updateMinesUI();
                    }
                }
            },

            calculateMultiplier: function() {
                const minesCount = this.minesState.minesCount;
                const safeCount = 25 - minesCount;
                const revealedSafe = this.minesState.revealedCount;
                
                const baseMultiplier = 1 + (revealedSafe * (minesCount / 10));
                
                return Math.max(1, baseMultiplier.toFixed(2));
            },

            updateMinesUI: function() {
                document.getElementById('mines-balance').innerText = this.user.diamonds.toLocaleString();
                document.getElementById('mines-bet').innerText = this.minesState.bet;
                document.getElementById('mines-count').innerText = this.minesState.minesCount;
                document.getElementById('mines-revealed').innerText = `${this.minesState.revealedCount}/${25 - this.minesState.minesCount}`;
                
                const potential = Math.floor(this.minesState.bet * this.minesState.multiplier);
                document.getElementById('mines-potential').innerText = potential.toLocaleString();
                
                document.getElementById('current-multiplier').innerText = `${parseFloat(this.minesState.multiplier).toFixed(2)}x`;
            },

            minesCashout: function() {
                if (!this.minesState.gameActive) return;
                
                const winnings = Math.floor(this.minesState.bet * this.minesState.multiplier);
                
                this.user.diamonds += winnings;
                
                const msgDiv = document.getElementById('mines-message');
                msgDiv.className = 'game-message success';
                msgDiv.innerHTML = `ðŸŽ‰ <strong>GAGNÃ‰!</strong> ${winnings}ðŸ’Ž | Multiplicateur: ${parseFloat(this.minesState.multiplier).toFixed(2)}x`;
                msgDiv.style.display = 'flex';
                
                this.minesGameReset();
                this.notify(`âœ¨ Vous avez encaissÃ© ${winnings}ðŸ’Ž !`, 'success');
                this.saveUser();
            },

            minesGameOver: function(win) {
                if (win) {
                    this.minesCashout();
                } else {
                    const msgDiv = document.getElementById('mines-message');
                    msgDiv.className = 'game-message danger';
                    msgDiv.innerHTML = `ðŸ’¥ <strong>PERDU!</strong> Vous avez marchÃ© sur une bombe...`;
                    msgDiv.style.display = 'flex';
                    
                    this.minesGameReset();
                    this.notify(`ðŸ’¥ Vous avez perdu votre mise de ${this.minesState.bet}ðŸ’Ž`, 'error');
                    this.saveUser();
                }
            },

            minesGameReset: function() {
                this.minesState.gameActive = false;
                this.minesState.bet = 0;
                this.minesState.revealedCount = 0;
                this.minesState.multiplier = 1;
                
                document.getElementById('btn-start-game').disabled = false;
                document.getElementById('mines-bet-input').disabled = false;
                document.getElementById('mines-slider').disabled = false;
                document.getElementById('btn-cashout').disabled = true;
                document.getElementById('btn-cashout').style.display = 'none';
                
                document.getElementById('multiplier-container').style.display = 'none';
                
                document.querySelectorAll('.mine-cell').forEach(cell => {
                    cell.disabled = true;
                });
            },

            blackjackState: {
                deck: [],
                playerHand: [],
                dealerHand: [],
                bet: 0,
                gameActive: false,
                canDouble: false
            },

            initBlackjack: function() {
                this.blackjackState = {
                    deck: [],
                    playerHand: [],
                    dealerHand: [],
                    bet: 0,
                    gameActive: false,
                    canDouble: false
                };
            },

            createDeck: function() {
                const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
                const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                const deck = [];
                for (let i = 0; i < 6; i++) {
                    for (let suit of suits) {
                        for (let value of values) {
                            deck.push({ suit, value });
                        }
                    }
                }
                return deck.sort(() => Math.random() - 0.5);
            },

            dealCard: function(hand) {
                if (this.blackjackState.deck.length === 0) {
                    this.blackjackState.deck = this.createDeck();
                }
                hand.push(this.blackjackState.deck.pop());
            },

            calcHandValue: function(hand) {
                let value = 0;
                let aces = 0;
                for (let card of hand) {
                    if (card.value === 'A') {
                        aces++;
                        value += 11;
                    } else if (['J', 'Q', 'K'].includes(card.value)) {
                        value += 10;
                    } else {
                        value += parseInt(card.value);
                    }
                }
                while (value > 21 && aces > 0) {
                    value -= 10;
                    aces--;
                }
                return value;
            },

            renderBlackjackCards: function() {
                const playerCardsDiv = document.getElementById('player-cards');
                const dealerCardsDiv = document.getElementById('dealer-cards');
                
                playerCardsDiv.innerHTML = this.blackjackState.playerHand.map(card => 
                    `<div class="card">${card.value}${card.suit}</div>`
                ).join('');
                
                dealerCardsDiv.innerHTML = this.blackjackState.dealerHand.map(card => 
                    `<div class="card">${card.value}${card.suit}</div>`
                ).join('');
                
                document.getElementById('player-value').innerText = this.calcHandValue(this.blackjackState.playerHand);
                document.getElementById('dealer-value').innerText = this.calcHandValue(this.blackjackState.dealerHand);
            },

            setBJBet: function(amount) {
                document.getElementById('blackjack-bet').value = amount;
                this.updateBJUI();
            },

            updateBJUI: function() {
                document.getElementById('bj-balance').innerText = this.user.diamonds;
                const bet = parseInt(document.getElementById('blackjack-bet').value) || 0;
                document.getElementById('bj-current-bet').innerText = bet;
                document.getElementById('bj-potential-win').innerText = Math.floor(bet * 1.5);
            },

            blackjackDeal: function() {
                const betInput = document.getElementById('blackjack-bet');
                const bet = parseInt(betInput.value);
                
                if (!bet || bet <= 0) {
                    this.notify('Entrez une mise valide !', 'error');
                    return;
                }
                
                if (this.user.diamonds < bet) {
                    this.notify('Pas assez de diamants !', 'error');
                    return;
                }
                
                this.user.diamonds -= bet;
                this.blackjackState.bet = bet;
                this.blackjackState.gameActive = true;
                
                this.initBlackjack();
                this.blackjackState.deck = this.createDeck();
                this.blackjackState.bet = bet;
                
                this.dealCard(this.blackjackState.playerHand);
                this.dealCard(this.blackjackState.dealerHand);
                this.dealCard(this.blackjackState.playerHand);
                this.dealCard(this.blackjackState.dealerHand);
                
                this.renderBlackjackCards();
                
                document.getElementById('bj-deal').disabled = true;
                document.getElementById('bj-hit').disabled = false;
                document.getElementById('bj-stand').disabled = false;
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                if (playerValue === 21) {
                    this.blackjackStand();
                } else {
                    document.getElementById('bj-double').disabled = false;
                    this.blackjackState.canDouble = true;
                }
                
                document.getElementById('game-status').innerText = 'ðŸŽ® Ã€ votre tour de jouer...';
                document.getElementById('game-result').innerText = '';
                this.saveUser();
                this.updateBJUI();
            },

            blackjackHit: function() {
                this.dealCard(this.blackjackState.playerHand);
                this.renderBlackjackCards();
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                if (playerValue > 21) {
                    this.blackjackEnd(false);
                }
            },

            blackjackStand: function() {
                // DÃ©sactiver les boutons
                document.getElementById('bj-hit').disabled = true;
                document.getElementById('bj-stand').disabled = true;
                document.getElementById('bj-double').disabled = true;
                
                // Le croupier tire tant qu'il a moins de 17
                while (this.calcHandValue(this.blackjackState.dealerHand) < 17) {
                    this.dealCard(this.blackjackState.dealerHand);
                }
                
                this.renderBlackjackCards();
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                const dealerValue = this.calcHandValue(this.blackjackState.dealerHand);

                // Comparaison des scores
                if (dealerValue > 21) {
                    this.blackjackEnd(true, 'VICTOIRE ! Le croupier a dÃ©passÃ© 21 !');
                } else if (playerValue > dealerValue) {
                    this.blackjackEnd(true, 'VICTOIRE ! Vous battez le croupier !');
                } else if (playerValue === dealerValue) {
                    this.blackjackEnd(null, 'Ã‰GALITÃ‰ ! Pari remboursÃ©.');
                } else {
                    this.blackjackEnd(false, 'DÃ‰FAITE ! Le croupier gagne.');
                }
            },

            blackjackDouble: function() {
                const currentBet = this.blackjackState.bet;
                if (this.user.diamonds < currentBet) {
                    this.notify('Pas assez de diamants pour doubler !', 'error');
                    return;
                }
                
                this.user.diamonds -= currentBet;
                this.blackjackState.bet *= 2;
                this.blackjackState.canDouble = false;
                document.getElementById('bj-double').disabled = true;
                
                this.dealCard(this.blackjackState.playerHand);
                this.renderBlackjackCards();
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                if (playerValue > 21) {
                    this.blackjackEnd(false);
                } else {
                    this.blackjackStand();
                }
                this.saveUser();
                this.updateBJUI();
            },

            blackjackEnd: function(win, message = '') {
                this.blackjackState.gameActive = false;
                document.getElementById('bj-hit').disabled = true;
                document.getElementById('bj-stand').disabled = true;
                document.getElementById('bj-double').disabled = true;
                document.getElementById('bj-deal').disabled = false;
                
                const betInput = document.getElementById('blackjack-bet');
                betInput.disabled = false;
                
                if (win === true) {
                    const winnings = Math.floor(this.blackjackState.bet * 1.5);
                    this.user.diamonds += winnings + this.blackjackState.bet;
                    document.getElementById('game-result').innerText = `âœ¨ ${message} +${winnings} ðŸ’Ž`;
                    this.notify(`GagnÃ© ${winnings} ðŸ’Ž !`, 'success');
                } else if (win === false) {
                    document.getElementById('game-result').innerText = `ðŸ’¥ ${message || 'Vous avez perdu votre mise.'}`;
                    this.notify(`Perdu ${this.blackjackState.bet} ðŸ’Ž...`, 'error');
                } else {
                    this.user.diamonds += this.blackjackState.bet;
                    document.getElementById('game-result').innerText = `ðŸ¤ ${message}`;
                    this.notify(`Pari remboursÃ©.`, 'success');
                }
                
                this.saveUser();
                this.updateBJUI();
            },

            initAllSlots: function() {
                const machines = ['fruits', 'treasure', 'casino', 'animals'];
                machines.forEach(machine => {
                    const symbols = this.slotsMachines[machine].symbols;
                    for (let i = 0; i < 3; i++) {
                        const reel = document.getElementById(`reel-${machine}-${i}`);
                        if (reel && reel.children.length === 0) {
                            symbols.forEach(symbol => {
                                const item = document.createElement('div');
                                item.className = 'reel-item';
                                item.textContent = symbol;
                                reel.appendChild(item);
                            });
                        }
                    }
                });
            },

            slotsMachines: {
                fruits: {
                    isSpinning: false,
                    lastWin: 0,
                    symbols: ['ðŸŽ', 'ðŸŠ', 'ðŸ‹', 'ðŸ’', 'ðŸ’Ž', 'ðŸ‘‘', 'ðŸŽ°'],
                    multipliers: { 'ðŸŽ': 2, 'ðŸŠ': 2, 'ðŸ‹': 3, 'ðŸ’': 3, 'ðŸ’Ž': 5, 'ðŸ‘‘': 10, 'ðŸŽ°': 50 }
                },
                treasure: {
                    isSpinning: false,
                    lastWin: 0,
                    symbols: ['ðŸ’°', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’Ž', 'ðŸ‘‘', 'ðŸ†'],
                    multipliers: { 'ðŸ’°': 2, 'ðŸ’µ': 2, 'ðŸ’´': 3, 'ðŸ’¶': 3, 'ðŸ’Ž': 5, 'ðŸ‘‘': 10, 'ðŸ†': 50 }
                },
                casino: {
                    isSpinning: false,
                    lastWin: 0,
                    symbols: ['ðŸŽ°', 'ðŸŽ²', 'ðŸƒ', 'â™ ï¸', 'â™¥ï¸', 'ðŸ‘‘', 'â­'],
                    multipliers: { 'ðŸŽ°': 2, 'ðŸŽ²': 2, 'ðŸƒ': 3, 'â™ ï¸': 3, 'â™¥ï¸': 5, 'ðŸ‘‘': 10, 'â­': 50 }
                },
                animals: {
                    isSpinning: false,
                    lastWin: 0,
                    symbols: ['ðŸ¶', 'ðŸ±', 'ðŸ¦', 'ðŸ¯', 'ðŸ¦…', 'ðŸ‰', 'ðŸ¦„'],
                    multipliers: { 'ðŸ¶': 2, 'ðŸ±': 2, 'ðŸ¦': 3, 'ðŸ¯': 3, 'ðŸ¦…': 5, 'ðŸ‰': 10, 'ðŸ¦„': 50 }
                }
            },

            setSlotsBet: function(machine, amount) {
                document.getElementById(`slots-bet-${machine}`).value = amount;
                this.updateSlotsUI(machine);
            },

            updateSlotsUI: function(machine) {
                document.getElementById(`slots-balance-${machine}`).innerText = this.user.diamonds;
                document.getElementById(`slots-last-win-${machine}`).innerText = this.slotsMachines[machine].lastWin;
            },

            slotsSpin: function(machine) {
                if (this.slotsMachines[machine].isSpinning) return;
                
                const betInput = document.getElementById(`slots-bet-${machine}`);
                const bet = parseInt(betInput.value);
                
                if (!bet || bet <= 0) {
                    this.notify('Entrez une mise valide !', 'error');
                    return;
                }
                
                const totalBet = bet * 3;
                if (this.user.diamonds < totalBet) {
                    this.notify('Pas assez de diamants !', 'error');
                    return;
                }
                
                this.user.diamonds -= totalBet;
                this.slotsMachines[machine].isSpinning = true;
                
                document.getElementById(`slots-spin-${machine}`).disabled = true;
                document.getElementById(`slots-message-${machine}`).innerHTML = '';
                
                const reels = [0, 1, 2];
                const symbols = this.slotsMachines[machine].symbols;
                const results = reels.map(() => symbols[Math.floor(Math.random() * symbols.length)]);
                
                reels.forEach((reel, index) => {
                    const duration = 2000 + (index * 200);
                    setTimeout(() => {
                        this.spinReel(machine, reel, results[index], duration);
                    }, index * 150);
                });
                
                setTimeout(() => {
                    this.checkSlotsWin(machine, results, bet);
                    document.getElementById(`slots-spin-${machine}`).disabled = false;
                    this.slotsMachines[machine].isSpinning = false;
                }, 3000);
            },

            spinReel: function(machine, reelIndex, targetSymbol, duration) {
                const reel = document.getElementById(`reel-${machine}-${reelIndex}`);
                const symbols = this.slotsMachines[machine].symbols;
                const targetIndex = symbols.indexOf(targetSymbol);
                
                let currentIndex = 0;
                let spins = 0;
                const spinsPerSecond = 10;
                const totalSpins = Math.floor((duration / 1000) * spinsPerSecond);
                
                for (let i = 0; i < symbols.length; i++) {
                    const item = document.createElement('div');
                    item.className = 'reel-item';
                    item.textContent = symbols[i];
                    reel.appendChild(item);
                }
                
                const spinInterval = setInterval(() => {
                    spins++;
                    currentIndex = (currentIndex + 1) % symbols.length;
                    reel.style.transform = `translateY(-${currentIndex * 150}px)`;
                    
                    if (spins >= totalSpins) {
                        clearInterval(spinInterval);
                        reel.style.transform = `translateY(-${targetIndex * 150}px)`;
                    }
                }, 1000 / spinsPerSecond);
            },

            checkSlotsWin: function(machine, results, bet) {
                const [r1, r2, r3] = results;
                let winAmount = 0;
                const machineData = this.slotsMachines[machine];
                const multipliers = machineData.multipliers;
                const totalBet = bet * 3;
                
                if (r1 === r2 && r2 === r3) {
                    winAmount = totalBet * multipliers[r1];
                    document.getElementById(`slots-message-${machine}`).innerHTML = `ðŸŽ‰ <strong>JACKPOT!</strong> ${r1}${r1}${r1} +${winAmount} ðŸ’Ž`;
                    this.notify(`JACKPOT! +${winAmount} ðŸ’Ž !`, 'success');
                } else if (r1 === r2 || r2 === r3 || r1 === r3) {
                    const pair = (r1 === r2) ? r1 : (r2 === r3) ? r2 : r1;
                    winAmount = totalBet * Math.floor(multipliers[pair] / 2);
                    document.getElementById(`slots-message-${machine}`).innerHTML = `ðŸŽŠ Vous avez une paire! +${winAmount} ðŸ’Ž`;
                    this.notify(`Paire gagnante! +${winAmount} ðŸ’Ž`, 'success');
                } else {
                    document.getElementById(`slots-message-${machine}`).innerHTML = `ðŸ˜¢ Pas gagnant cette fois... RÃ©essayez!`;
                    this.notify('Pas gagnant...', 'error');
                }
                
                this.user.diamonds += winAmount;
                this.slotsMachines[machine].lastWin = winAmount;
                this.saveUser();
                this.updateSlotsUI(machine);
            },
// --- LOGIQUE DES CAISSES ---
            
            getFreeCase: function() {
                const now = Date.now();
                // 24 heures en millisecondes
                const cooldown = 24 * 60 * 60 * 1000; 
                
                if (now < nextFreeCase) {
                    const remaining = Math.ceil((nextFreeCase - now) / (1000 * 60 * 60));
                    return this.notify(`Reviens dans ${remaining} heures !`, 'error');
                }
                
                nextFreeCase = now + cooldown;
                localStorage.setItem('dc_freecase_time', nextFreeCase);
                
                // Ouvre une caisse commune gratuitement
                this.openCase('common', true);
            },

            openCase: function(type, isFree = false) {
                if (!isFree) {
                    const price = CASE_PRICES[type];
                    if (this.user.diamonds < price) {
                        return this.notify(`Pas assez de diamants ! (${price} requis)`, 'error');
                    }
                    this.user.diamonds -= price;
                }

                // Afficher la roulette
                const wrapper = document.getElementById('roulette-wrapper');
                wrapper.style.display = 'block';
                const strip = document.getElementById('roulette-strip');
                strip.innerHTML = '';
                strip.style.transition = 'none';
                strip.style.transform = 'translateX(0)';

                // DÃ©terminer l'objet gagnÃ© (Logique de poids)
                const pool = ITEMS_DB[type] || ITEMS_DB.common;
                const winItem = pool[Math.floor(Math.random() * pool.length)];

                // GÃ©nÃ©rer les items de la roulette (visuel)
                // On gÃ©nÃ¨re 50 items, le gagnant sera vers la fin (index 35 environ)
                const cardWidth = 130; 
                let winnerIndex = 35;
                
                for(let i=0; i<50; i++) {
                    let item;
                    if(i === winnerIndex) {
                        item = winItem;
                    } else {
                        // Items alÃ©atoires pour le dÃ©cor
                        const randomType = Object.keys(ITEMS_DB)[Math.floor(Math.random() * 4)]; // common Ã  legendary
                        const randomPool = ITEMS_DB[randomType];
                        item = randomPool[Math.floor(Math.random() * randomPool.length)];
                    }

                    const el = document.createElement('div');
                    el.className = 'roulette-item';
                    el.innerHTML = `
                        <div style="font-size:2rem;">ðŸ“¦</div>
                        <div style="font-size:0.8rem; font-weight:bold; text-align:center;">${item.name}</div>
                        <div style="font-size:0.7rem; color:#aaa;">${item.val} ðŸ’Ž</div>
                    `;
                    // Bordure selon raretÃ© (simplifiÃ©)
                    if(item.val > 1000) el.style.borderBottom = "4px solid var(--mythic)";
                    else if(item.val > 100) el.style.borderBottom = "4px solid var(--legendary)";
                    else el.style.borderBottom = "4px solid var(--common)";
                    
                    strip.appendChild(el);
                }

                // Lancer l'animation
                setTimeout(() => {
                    const randomOffset = Math.floor(Math.random() * 100) - 50; // Pour ne pas tomber pile au milieu
                    // Calcul position : (Index * Largeur) - (MoitiÃ© Ã©cran) + (MoitiÃ© item)
                    const position = (winnerIndex * cardWidth) - (wrapper.offsetWidth / 2) + (cardWidth / 2) + randomOffset;
                    
                    strip.style.transition = 'transform 4s cubic-bezier(0.1, 0.9, 0.3, 1)';
                    strip.style.transform = `translateX(-${position}px)`;
                }, 100);

                // RÃ©sultat aprÃ¨s animation
                setTimeout(() => {
                    this.notify(`Tu as gagnÃ© : ${winItem.name}`, 'success');
                    // Ajouter Ã  l'inventaire avec un ID unique
                    this.user.inventory.push({ ...winItem, uid: Date.now(), rarity: type });
                    this.saveUser();
                    document.getElementById('win-message').innerText = `GagnÃ© : ${winItem.name} (+${winItem.val}ðŸ’Ž)`;
                }, 4100);
            },
            // --- GESTION INVENTAIRE & MARCHÃ‰ ---

            renderInventory: function() {
                const container = document.getElementById('inventory-list');
                container.innerHTML = '';

                if (this.user.inventory.length === 0) {
                    container.innerHTML = '<p style="width:100%; text-align:center; color:#94a3b8">Inventaire vide.</p>';
                    return;
                }

                this.user.inventory.forEach(item => {
                    const div = document.createElement('div');
                    div.className = `item-card ${item.rarity || 'common'}`;
                    div.innerHTML = `
                        <div style="font-size:2rem; margin-bottom:10px;">ðŸŽ’</div>
                        <div style="font-weight:bold; margin-bottom:5px;">${item.name}</div>
                        <div style="font-size:0.9rem; color:#cbd5e1;">Valeur: ${item.val} ðŸ’Ž</div>
                        <button class="btn-action btn-sell" onclick="app.quickSell(${item.uid}, ${item.val})">Vendre (${item.val})</button>
                        <button class="btn-action btn-market" onclick="app.showSellForm(${item.uid})">MarchÃ©</button>
                        <div id="market-form-${item.uid}" class="market-price-form">
                            <input type="number" id="price-${item.uid}" placeholder="Prix" value="${Math.floor(item.val * 1.2)}">
                            <div style="display:flex;">
                                <button class="btn-confirm" onclick="app.listOnMarket(${item.uid})">OK</button>
                                <button class="btn-cancel" onclick="app.hideSellForm(${item.uid})">X</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            },

            quickSell: function(uid, val) {
                // Vente instantanÃ©e Ã  la banque (valeur de base)
                this.user.inventory = this.user.inventory.filter(i => i.uid !== uid);
                this.user.diamonds += val;
                this.notify(`Objet vendu pour ${val} ðŸ’Ž`, 'success');
                this.saveUser();
            },

            showSellForm: function(uid) {
                document.querySelectorAll('.market-price-form').forEach(e => e.classList.remove('active'));
                const form = document.getElementById(`market-form-${uid}`);
                if(form) form.classList.add('active');
            },
            
            hideSellForm: function(uid) {
                const form = document.getElementById(`market-form-${uid}`);
                if(form) form.classList.remove('active');
            },

            listOnMarket: function(uid) {
                const item = this.user.inventory.find(i => i.uid === uid);
                const priceInput = document.getElementById(`price-${uid}`);
                const price = parseInt(priceInput.value);

                if (!item) return;
                if (price < 1) return this.notify("Prix invalide", "error");

                // Retirer de l'inventaire
                this.user.inventory = this.user.inventory.filter(i => i.uid !== uid);
                
                // Ajouter au marchÃ©
                this.marketData.push({
                    id: Date.now(),
                    seller: this.user.name,
                    item: item,
                    price: price,
                    rarity: item.rarity
                });
                
                this.notify("Objet mis en vente sur le marchÃ© !", "success");
                this.saveUser(); // Sauvegarde user + market
            },

            renderMarket: function() {
                const container = document.getElementById('market-list');
                container.innerHTML = '';
                
                if (this.marketData.length === 0) {
                    container.innerHTML = '<p style="width:100%; text-align:center; color:#94a3b8">Le marchÃ© est vide.</p>';
                    return;
                }

                // Trier par plus rÃ©cent
                const sortedMarket = [...this.marketData].sort((a, b) => b.id - a.id);

                sortedMarket.forEach(offer => {
                    const isMyItem = offer.seller === this.user.name;
                    const div = document.createElement('div');
                    div.className = `item-card ${offer.rarity || 'common'}`;
                    div.innerHTML = `
                        <div style="font-size:0.8rem; color:#aaa; margin-bottom:5px;">Vendeur: ${offer.seller}</div>
                        <div style="font-size:2rem; margin-bottom:5px;">âš–ï¸</div>
                        <div style="font-weight:bold; margin-bottom:5px;">${offer.item.name}</div>
                        <div style="font-size:1.1rem; color:var(--gold); font-weight:bold;">${offer.price} ðŸ’Ž</div>
                        ${isMyItem 
                            ? `<button class="btn-action btn-cancel" onclick="app.removeFromMarket(${offer.id})">Retirer</button>`
                            : `<button class="btn-action btn-buy" onclick="app.buyFromMarket(${offer.id})">Acheter</button>`
                        }
                    `;
                    container.appendChild(div);
                });
            },

            buyFromMarket: function(offerId) {
                const offerIndex = this.marketData.findIndex(o => o.id === offerId);
                if (offerIndex === -1) return this.notify("Cet offre n'existe plus.", "error");
                
                const offer = this.marketData[offerIndex];
                
                if (this.user.diamonds < offer.price) {
                    return this.notify(`Pas assez de diamants (${offer.price} requis)`, "error");
                }

                // Transaction
                this.user.diamonds -= offer.price;
                this.user.inventory.push({ ...offer.item, uid: Date.now() }); // Nouvel ID pour l'acheteur
                
                // Payer le vendeur (si c'est un vrai user)
                if (this.usersDB[offer.seller]) {
                    this.usersDB[offer.seller].diamonds += offer.price;
                }
                
                // Retirer du marchÃ©
                this.marketData.splice(offerIndex, 1);
                
                this.notify(`AchetÃ© ${offer.item.name} pour ${offer.price}ðŸ’Ž`, "success");
                this.saveUser();
                this.renderMarket();
            },

            removeFromMarket: function(offerId) {
                const offerIndex = this.marketData.findIndex(o => o.id === offerId);
                if (offerIndex === -1) return;
                
                const offer = this.marketData[offerIndex];
                
                // Remettre dans l'inventaire
                this.user.inventory.push(offer.item);
                
                // Retirer du marchÃ©
                this.marketData.splice(offerIndex, 1);
                
                this.notify("Objet retirÃ© du marchÃ©.", "info");
                this.saveUser();
                this.renderMarket();
            },

            // ========== TOWER GAME ==========
            towerState: {
                mode: 'easy',
                columns: 3,
                floors: 8,
                currentFloor: 0,
                bet: 0,
                multiplier: 1,
                gameActive: false,
                correctPath: [],
                history: []
            },

            selectTowerMode: function(mode) {
                if (this.towerState.gameActive) {
                    return this.notify('Termine ta partie avant de changer de mode !', 'error');
                }
                
                this.towerState.mode = mode;
                this.towerState.columns = mode === 'easy' ? 3 : 2;
                this.towerState.floors = 8;
                
                // Update UI
                document.querySelectorAll('.tower-mode-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                const infoText = mode === 'easy' 
                    ? 'ðŸŸ¢ Mode Facile : 3 colonnes (2 bonnes!), 30 Ã©tages. Gagnez un multiplicateur Ã  chaque Ã©tage. Plus sÃ»r mais gains plus lents.'
                    : 'ðŸ”´ Mode Difficile : 2 colonnes, 30 Ã©tages. Gains BEAUCOUP plus rapides mais plus risquÃ© !';
                
                document.getElementById('tower-mode-info').innerText = infoText;
                
                this.renderTowerGame();
                this.updateTowerUI();
            },

            renderTowerGame: function() {
                const container = document.getElementById('tower-container');
                container.innerHTML = '';
                
                const cols = this.towerState.columns;
                
                for (let col = 0; col < cols; col++) {
                    const column = document.createElement('div');
                    column.className = 'tower-column' + (cols === 3 ? ' easy' : '');
                    
                    for (let floor = 0; floor < this.towerState.floors; floor++) {
                        const floorDiv = document.createElement('div');
                        floorDiv.className = 'tower-floor';
                        floorDiv.dataset.floor = floor;
                        floorDiv.dataset.col = col;
                        
                        const mult = this.calculateTowerMultiplier(floor + 1);
                        floorDiv.innerHTML = `
                            <div class="tower-floor-level">Ã‰tage ${floor + 1}</div>
                            <div class="tower-multiplier">${mult.toFixed(2)}x</div>
                        `;
                        
                        floorDiv.onclick = () => this.selectTowerFloor(floor, col);
                        column.appendChild(floorDiv);
                    }
                    
                    container.appendChild(column);
                }
            },

            calculateTowerMultiplier: function(floor) {
                const mode = this.towerState.mode;
                const base = mode === 'easy' ? 1.15 : 1.50;
                return Math.pow(base, floor);
            },

            startTowerGame: function() {
                const betInput = document.getElementById('tower-bet-input');
                const bet = parseInt(betInput.value);
                
                if (!bet || bet < 1) {
                    return this.notify('Entre une mise valide !', 'error');
                }
                
                if (this.user.diamonds < bet) {
                    return this.notify('Pas assez de diamants !', 'error');
                }
                
                if (this.towerState.gameActive) {
                    return this.notify('Partie dÃ©jÃ  en cours !', 'error');
                }
                
                this.user.diamonds -= bet;
                
                this.towerState.bet = bet;
                this.towerState.currentFloor = 0;
                this.towerState.multiplier = 1;
                this.towerState.gameActive = true;
                this.towerState.correctPath = [];
                
                for (let i = 0; i < this.towerState.floors; i++) {
                    if (this.towerState.mode === 'easy') {
                        const correctCols = [];
                        const wrongCol = Math.floor(Math.random() * this.towerState.columns);
                        for (let j = 0; j < this.towerState.columns; j++) {
                            if (j !== wrongCol) {
                                correctCols.push(j);
                            }
                        }
                        this.towerState.correctPath.push(correctCols);
                    } else {
                        const correctCol = Math.floor(Math.random() * this.towerState.columns);
                        this.towerState.correctPath.push([correctCol]);
                    }
                }
                
                this.renderTowerGame();
                this.updateTowerUI();
                
                document.querySelectorAll('.tower-floor[data-floor="0"]').forEach(f => {
                    f.classList.add('current');
                });
                
                document.getElementById('tower-btn-start').style.display = 'none';
                document.getElementById('tower-btn-cashout').classList.add('show');
                document.getElementById('tower-bet-input').disabled = true;
                
                this.notify('Partie lancÃ©e ! Choisis une case au niveau 1', 'success');
                this.saveUser();
            },

            selectTowerFloor: function(floor, col) {
                if (!this.towerState.gameActive) return;
                if (floor !== this.towerState.currentFloor) return;
                
                const correctCols = this.towerState.correctPath[floor];
                const isCorrect = correctCols.includes(col);
                
                const floorDiv = document.querySelector(`.tower-floor[data-floor="${floor}"][data-col="${col}"]`);
                
                if (isCorrect) {
                    floorDiv.classList.add('completed');
                    floorDiv.classList.remove('current');
                    
                    this.towerState.currentFloor++;
                    this.towerState.multiplier = this.calculateTowerMultiplier(this.towerState.currentFloor);
                    
                    document.querySelectorAll(`.tower-floor[data-floor="${floor}"]`).forEach(f => {
                        f.classList.remove('current');
                    });
                    
                    if (this.towerState.currentFloor >= this.towerState.floors) {
                        this.towerGameEnd(true, 'win');
                    } else {
                        document.querySelectorAll(`.tower-floor[data-floor="${this.towerState.currentFloor}"]`).forEach(f => {
                            f.classList.add('current');
                        });
                        
                        this.updateTowerUI();
                        this.notify(`âœ… Correct ! Ã‰tage ${this.towerState.currentFloor + 1}`, 'success');
                    }
                } else {
                    floorDiv.classList.add('lost');
                    
                    correctCols.forEach(correctCol => {
                        const correctFloor = document.querySelector(`.tower-floor[data-floor="${floor}"][data-col="${correctCol}"]`);
                        if (correctFloor) {
                            correctFloor.classList.add('completed');
                            correctFloor.innerHTML += '<div style="position:absolute; top:5px; right:5px; font-size:1.5rem;">âœ“</div>';
                        }
                    });
                    
                    this.towerGameEnd(false, 'lose');
                }
            },

            towerCashout: function() {
                if (!this.towerState.gameActive) return;
                if (this.towerState.currentFloor === 0) {
                    return this.notify('Monte au moins 1 Ã©tage avant d\'encaisser !', 'error');
                }
                
                this.towerGameEnd(true, 'cashout');
            },

            towerGameEnd: function(won, reason) {
                this.towerState.gameActive = false;
                
                const winnings = won ? Math.floor(this.towerState.bet * this.towerState.multiplier) : 0;
                
                if (won) {
                    this.user.diamonds += winnings;
                    
                    const popup = document.getElementById('tower-result-popup');
                    popup.className = 'tower-result-popup show win';
                    
                    if (reason === 'win') {
                        document.getElementById('tower-result-title').innerText = 'ðŸŽ‰ VICTOIRE TOTALE !';
                        document.getElementById('tower-result-text').innerText = `Tu as grimpÃ© les ${this.towerState.floors} Ã©tages !`;
                    } else {
                        document.getElementById('tower-result-title').innerText = 'ðŸ’° ENCAISSÃ‰ !';
                        document.getElementById('tower-result-text').innerText = `Ã‰tage ${this.towerState.currentFloor} atteint !`;
                    }
                    
                    document.getElementById('tower-result-amount').innerText = `+${winnings} ðŸ’Ž`;
                    
                    this.notify(`GagnÃ© ${winnings} ðŸ’Ž !`, 'success');
                    
                    this.towerState.history.unshift({
                        won: true,
                        floor: this.towerState.currentFloor,
                        mult: this.towerState.multiplier.toFixed(2),
                        winnings: winnings,
                        time: Date.now()
                    });
                } else {
                    const popup = document.getElementById('tower-result-popup');
                    popup.className = 'tower-result-popup show lose';
                    
                    document.getElementById('tower-result-title').innerText = 'ðŸ’¥ PERDU !';
                    document.getElementById('tower-result-text').innerText = `Tu es tombÃ© Ã  l'Ã©tage ${this.towerState.currentFloor + 1}`;
                    document.getElementById('tower-result-amount').innerText = `-${this.towerState.bet} ðŸ’Ž`;
                    
                    this.notify(`Perdu ${this.towerState.bet} ðŸ’Ž`, 'error');
                    
                    this.towerState.history.unshift({
                        won: false,
                        floor: this.towerState.currentFloor,
                        mult: this.towerState.multiplier.toFixed(2),
                        winnings: 0,
                        time: Date.now()
                    });
                }
                
                if (this.towerState.history.length > 10) {
                    this.towerState.history = this.towerState.history.slice(0, 10);
                }
                
                this.updateTowerHistory();
                this.saveUser();
                this.resetTowerUI();
            },

            closeTowerPopup: function() {
                document.getElementById('tower-result-popup').classList.remove('show');
            },

            resetTowerUI: function() {
                document.getElementById('tower-btn-start').style.display = 'block';
                document.getElementById('tower-btn-cashout').classList.remove('show');
                document.getElementById('tower-bet-input').disabled = false;
                
                this.towerState.currentFloor = 0;
                this.towerState.multiplier = 1;
                this.towerState.bet = 0;
                
                this.updateTowerUI();
            },

            updateTowerUI: function() {
                if (!this.user) return;
                
                document.getElementById('tower-balance').innerText = this.user.diamonds.toLocaleString();
                document.getElementById('tower-current-bet').innerText = this.towerState.bet;
                document.getElementById('tower-multiplier').innerText = this.towerState.multiplier.toFixed(2) + 'x';
                
                const potentialWin = Math.floor(this.towerState.bet * this.towerState.multiplier);
                document.getElementById('tower-potential-win').innerText = potentialWin;
            },

            updateTowerHistory: function() {
                const container = document.getElementById('tower-history');
                
                if (this.towerState.history.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">L\'historique des parties apparaÃ®tra ici</div>';
                    return;
                }
                
                container.innerHTML = '<h4 style="color: var(--primary); margin-bottom: 10px;">ðŸ“œ Historique</h4>';
                
                this.towerState.history.forEach(entry => {
                    const date = new Date(entry.time);
                    const timeStr = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                    
                    const div = document.createElement('div');
                    div.className = `tower-history-item ${entry.won ? 'win' : 'loss'}`;
                    
                    if (entry.won) {
                        div.innerHTML = `
                            <div>âœ… Ã‰tage ${entry.floor} â€¢ ${entry.mult}x</div>
                            <div>+${entry.winnings} ðŸ’Ž â€¢ ${timeStr}</div>
                        `;
                    } else {
                        div.innerHTML = `
                            <div>âŒ Ã‰tage ${entry.floor} â€¢ ${entry.mult}x</div>
                            <div>Perdu â€¢ ${timeStr}</div>
                        `;
                    }
                    
                    container.appendChild(div);
                });
            }
        };
        
        app.init();
        
        document.getElementById('mines-slider').addEventListener('input', function() {
            document.getElementById('mines-slider-value').innerText = this.value;
        });

        // Init dynamic fields for withdraw on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('withdraw-method')) {
                app.toggleWithdrawFields();
            }
        });
    </script>
</body>
</html>
