<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíé Diamond Case - Gagne des Cartes Cadeaux</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --primary: #38bdf8;
            --accent: #818cf8;
            --success: #4ade80;
            --danger: #f87171;
            --gold: #fbbf24;
            --common: #94a3b8;
            --rare: #4ade80;
            --epic: #a855f7;
            --legendary: #f59e0b;
            --mythic: #f43f5e;
            --ultrapremium: #00ffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }

        /* Navigation */
        header {
            background-color: rgba(15, 23, 42, 0.95);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        
        nav { display: flex; gap: 15px; }
        nav button {
            background: none;
            border: none;
            color: #cbd5e1;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        nav button:hover, nav button.active {
            background-color: rgba(56, 189, 248, 0.1);
            color: var(--primary);
        }

        .user-stats {
            background: rgba(0,0,0,0.3);
            padding: 8px 20px;
            border-radius: 20px;
            border: 1px solid var(--primary);
            font-weight: bold;
            color: var(--primary);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Layout */
        main { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }

        h2 { 
            border-left: 5px solid var(--primary); 
            padding-left: 15px; 
            margin-bottom: 25px; 
            font-size: 1.8rem;
        }

        /* Alertes */
        #alert-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: var(--bg-panel);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
            min-width: 280px;
        }

        /* AUTH SCREEN AM√âLIOR√â */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-box {
            max-width: 450px;
            width: 100%;
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 1px solid #334155;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 8px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .auth-tab.active {
            background: var(--primary);
            color: #0f172a;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid #334155;
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
        }

        .btn-main {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(56, 189, 248, 0.3);
        }

        .btn-main:active { transform: scale(0.98); }

        /* Caisses */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .case-card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .case-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.4); 
        }
        
        .c-common { border-color: var(--common); }
        .c-rare { border-color: var(--rare); }
        .c-epic { border-color: var(--epic); }
        .c-legendary { border-color: var(--legendary); box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
        .c-mythic { border-color: var(--mythic); box-shadow: 0 0 25px rgba(244, 63, 94, 0.4); }
        .c-ultrapremium { 
            border-color: #00ffff; 
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8), 0 0 60px rgba(255, 0, 255, 0.6), inset 0 0 20px rgba(0, 255, 255, 0.3), 0 0 20px rgba(0, 255, 255, 0.5);
            animation: neonGlow 1.5s ease-in-out infinite;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
        }

        @keyframes neonGlow {
            0%, 100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.8), 0 0 60px rgba(255, 0, 255, 0.6), inset 0 0 20px rgba(0, 255, 255, 0.3), 0 0 20px rgba(0, 255, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 1), 0 0 80px rgba(255, 0, 255, 0.8), inset 0 0 30px rgba(0, 255, 255, 0.5), 0 0 40px rgba(255, 0, 255, 0.6);
            }
        }

        .case-card.c-ultrapremium h3 {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(255, 0, 255, 0.6);
            animation: titleGlow 1.5s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(255, 0, 255, 0.6); }
            50% { text-shadow: 0 0 20px rgba(0, 255, 255, 1), 0 0 30px rgba(255, 0, 255, 0.8); }
        }

        .case-card.c-ultrapremium .price-tag {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
            color: #00ffff;
            border: 2px solid #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6), 0 0 10px rgba(255, 0, 255, 0.4);
        }

        .case-img { font-size: 4rem; margin-bottom: 15px; }
        .price-tag { 
            background: rgba(0,0,0,0.6); 
            padding: 8px 15px; 
            border-radius: 20px; 
            display: inline-block; 
            margin-top: 15px; 
            color: var(--gold);
            font-weight: bold;
        }

        /* Roulette */
        #roulette-wrapper {
            background: linear-gradient(to bottom, #000, #111);
            height: 140px;
            margin: 30px 0;
            position: relative;
            border-radius: 12px;
            border: 3px solid var(--gold);
            overflow: hidden;
            display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        #roulette-strip {
            display: flex;
            height: 100%;
            position: absolute;
            left: 0;
            transition: transform 5s cubic-bezier(0.1, 0.9, 0.3, 1);
        }

        .roulette-item {
            width: 130px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 2px solid #222;
            flex-shrink: 0;
            background: var(--bg-panel);
        }

        .indicator {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, transparent, white, transparent);
            z-index: 10;
            transform: translateX(-50%);
            box-shadow: 0 0 20px white, 0 0 40px white;
        }

        #win-message {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            font-size: 1.4rem;
            min-height: 30px;
        }

        /* Inventaire & Market */
        .item-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .item-card {
            background: var(--bg-panel);
            width: 180px;
            padding: 15px;
            border-radius: 10px;
            border-bottom: 4px solid grey;
            text-align: center;
            transition: transform 0.2s;
        }

        .item-card:hover {
            transform: translateY(-5px);
        }

        .item-card.common { border-color: var(--common); }
        .item-card.rare { border-color: var(--rare); }
        .item-card.epic { border-color: var(--epic); }
        .item-card.legendary { border-color: var(--legendary); }
        .item-card.mythic { border-color: var(--mythic); }

        .btn-action {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: white;
            font-weight: 600;
            transition: opacity 0.2s;
        }

        .btn-action:hover { opacity: 0.9; }
        .btn-sell { background-color: var(--success); color: #0f172a; }
        .btn-market { background-color: var(--accent); }
        .btn-buy { background-color: var(--gold); color: black; }

        /* SHOP DIAMANTS AM√âLIOR√â */
        .diamond-packages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .diamond-package {
            background: var(--bg-panel);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #334155;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .diamond-package.featured {
            border-color: var(--gold);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.2);
        }

        .diamond-package.featured::before {
            content: "POPULAIRE";
            position: absolute;
            top: 15px;
            right: -30px;
            background: var(--gold);
            color: #0f172a;
            padding: 5px 40px;
            transform: rotate(45deg);
            font-size: 0.7rem;
            font-weight: bold;
        }

        .diamond-package:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .diamond-amount {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
        }

        .diamond-price {
            font-size: 2rem;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 20px;
        }

        .payment-methods {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #334155;
        }

        .payment-method {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #334155;
            background: rgba(15, 23, 42, 0.5);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .payment-method:hover {
            border-color: var(--primary);
            background: rgba(56, 189, 248, 0.1);
        }

        /* Payment Modal Overlay */
        .payment-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 300;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .payment-overlay.active {
            display: flex;
        }

        .payment-modal {
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            position: relative;
            animation: slideUp 0.4s ease;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .payment-header h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .payment-form {
            display: none;
        }

        .payment-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }

        .btn-close:hover {
            color: var(--danger);
        }

        /* Animation de validation */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 400;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }

        .success-animation.active {
            display: flex;
        }

        .success-checkmark {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--success);
            position: relative;
            animation: scaleIn 0.5s ease;
            margin-bottom: 30px;
        }

        .success-checkmark::after {
            content: "‚úì";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            color: var(--success);
            animation: checkmark 0.8s ease 0.3s both;
        }

        .success-message {
            text-align: center;
            animation: fadeIn 0.8s ease 0.5s both;
        }

        .success-message h2 {
            font-size: 2.5rem;
            color: var(--success);
            margin-bottom: 15px;
            border: none;
            padding: 0;
        }

        .success-message p {
            font-size: 1.2rem;
            color: #cbd5e1;
            margin-bottom: 30px;
        }

        .success-diamonds {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
            animation: pulse 1s ease infinite;
        }

        /* Shop Cadeaux */
        .shop-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
        }

        .shop-item {
            background: var(--bg-panel);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #334155;
            transition: all 0.3s;
        }

        .shop-item:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .gift-card {
            background: linear-gradient(135deg, #38bdf8, #818cf8);
            color: white;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.4rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Market Price Input Inline */
        .market-price-form {
            margin-top: 10px;
            display: none;
        }

        .market-price-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .market-price-form input {
            padding: 8px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .market-price-form button {
            width: 48%;
            padding: 8px;
            margin: 2px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-confirm {
            background: var(--success);
            color: #0f172a;
        }

        .btn-cancel {
            background: var(--danger);
            color: white;
        }

        /* Withdrawal (Retrait) */
        .withdraw-card {
            background: linear-gradient(135deg, rgba(34,197,94,0.06), rgba(56,189,248,0.03));
            border: 2px solid #334155;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .withdraw-row {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 20px;
        }

        .withdraw-right {
            background: var(--bg-panel);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #334155;
            text-align: center;
        }

        .withdraw-summary {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            color: #cbd5e1;
            font-size: 0.95rem;
        }

        /* Animations Keyframes */
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }

        @keyframes slideIn { 
            from { transform: translateX(100%); } 
            to { transform: translateX(0); } 
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        @keyframes checkmark {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .cases-grid, .diamond-packages, .shop-grid {
                grid-template-columns: 1fr;
            }

            nav {
                flex-wrap: wrap;
                gap: 8px;
            }

            nav button {
                font-size: 0.85rem;
                padding: 6px 10px;
            }
        }

        .mines-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .mines-game {
            flex: 1;
            min-width: 400px;
        }

        .mines-sidebar {
            width: 280px;
        }

        .mines-header {
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5), 0 0 60px rgba(255, 0, 255, 0.3);
            animation: minesGlow 2s ease-in-out infinite;
        }

        @keyframes minesGlow {
            0%, 100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.5), 0 0 60px rgba(255, 0, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 0.8), 0 0 100px rgba(255, 0, 255, 0.6);
            }
        }

        .mines-header h3 {
            color: #0f172a;
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .mine-cell {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #1e293b, #334155);
            border: 3px solid #38bdf8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3), inset 0 0 10px rgba(0,0,0,0.5);
        }

        .mine-cell:hover:not(.revealed):not(.disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.6), inset 0 0 10px rgba(0,0,0,0.5);
        }

        .mine-cell.revealed {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            cursor: default;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
        }

        .mine-cell.safe {
            border-color: #4ade80;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.6), inset 0 0 10px rgba(0,0,0,0.5);
            animation: safePulse 0.5s ease;
        }

        @keyframes safePulse {
            0% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }

        .mine-cell.bomb {
            border-color: #f87171;
            background: linear-gradient(135deg, #7f1d1d, #450a0a);
            box-shadow: 0 0 30px rgba(248, 113, 113, 0.8), inset 0 0 15px rgba(0,0,0,0.8);
            animation: bombShake 0.5s ease;
        }

        @keyframes bombShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .mine-cell.disabled {
            cursor: not-allowed;
        }

        .mines-stats {
            background: var(--bg-panel);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            margin-bottom: 20px;
            box-shadow: 0 0 15px rgba(129, 140, 248, 0.3);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #334155;
            font-size: 1.1rem;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #cbd5e1;
        }

        .stat-value {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .mines-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .bet-input {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid var(--primary);
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
        }

        .bet-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.5);
        }

        .mines-settings {
            background: var(--bg-panel);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #334155;
        }

        .settings-title {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            color: #cbd5e1;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
            height: 6px;
            background: linear-gradient(to right, var(--danger), var(--success));
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }

        .mines-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-mines {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-play {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #0f172a;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.4);
        }

        .btn-play:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(74, 222, 128, 0.6);
        }

        .btn-play:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-cashout {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
        }

        .btn-cashout:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.6);
        }

        .btn-cashout:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .multiplier-display {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(56, 189, 248, 0.1));
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid var(--primary);
        }

        .multiplier-label {
            color: #cbd5e1;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .multiplier-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--success);
            animation: multipPulse 0.5s ease;
        }

        @keyframes multipPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .game-message {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-message.success {
            background: rgba(74, 222, 128, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .game-message.danger {
            background: rgba(248, 113, 113, 0.1);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        /* BLACKJACK STYLES */
        .blackjack-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .blackjack-table {
            flex: 1;
            min-width: 400px;
            background: linear-gradient(135deg, #0a3622, #0f6b3d);
            border: 3px solid var(--gold);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(251, 191, 36, 0.2);
        }

        .blackjack-player-section {
            margin-bottom: 30px;
            text-align: center;
        }

        .player-label {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .blackjack-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            min-height: 140px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-content: center;
        }

        .card {
            background: white;
            border: 3px solid var(--primary);
            border-radius: 8px;
            width: 70px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            color: #000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: cardFlip 0.5s ease;
        }

        @keyframes cardFlip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }

        .card-placeholder {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .player-value {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .blackjack-status {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            margin: 20px 0;
        }

        .status-message {
            color: #cbd5e1;
            font-size: 1rem;
            margin-bottom: 10px;
            min-height: 24px;
        }

        .result-message {
            color: var(--success);
            font-weight: bold;
            font-size: 1.3rem;
            min-height: 30px;
        }

        .blackjack-controls {
            flex: 0 1 350px;
            background: var(--bg-panel);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(56, 189, 248, 0.2);
        }

        .bet-section {
            margin-bottom: 25px;
        }

        .bet-section label {
            display: block;
            color: #cbd5e1;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .bet-input-group {
            margin-bottom: 15px;
        }

        .bet-input-group input {
            width: 100%;
            margin-bottom: 10px;
        }

        .bet-presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .bet-presets button {
            padding: 10px;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(129, 140, 248, 0.2));
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .bet-presets button:hover {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            transform: translateY(-2px);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }

        .btn-bj {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .btn-deal {
            background: linear-gradient(135deg, var(--gold), var(--legendary));
            color: #0f172a;
            grid-column: 1 / -1;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .btn-deal:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
        }

        .btn-action {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
        }

        .btn-action:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.6);
        }

        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .blackjack-stats {
            display: grid;
            gap: 12px;
        }

        .stat-item {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary);
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .stat-value {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* SLOTS STYLES */
        .slots-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            flex-wrap: wrap;
        }

        .slots-machine {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 4px solid var(--gold);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(251, 191, 36, 0.25), inset 0 0 20px rgba(251, 191, 36, 0.1);
        }

        .slots-display {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            border: 3px solid var(--primary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.8);
        }

        .slots-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .slots-header h3 {
            color: var(--gold);
            font-size: 1.3rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .slots-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            perspective: 1000px;
        }

        .slot-reel {
            position: relative;
            width: 100px;
            height: 150px;
            background: #000;
            border: 3px solid var(--primary);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.5), inset 0 0 10px rgba(0,0,0,0.8);
        }

        .reel-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            transition: transform 0.5s ease;
            position: absolute;
            top: 0;
            left: 0;
        }

        .reel-item {
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: linear-gradient(135deg, #1e293b, #334155);
            border-bottom: 1px solid rgba(56, 189, 248, 0.2);
            flex-shrink: 0;
        }

        .reel-window {
            position: absolute;
            top: 50px;
            left: 0;
            right: 0;
            height: 50px;
            border: 3px solid var(--success);
            border-top: 3px solid rgba(56, 189, 248, 0.3);
            border-bottom: 3px solid rgba(56, 189, 248, 0.3);
            box-shadow: inset 0 0 10px rgba(74, 222, 128, 0.2);
            pointer-events: none;
        }

        .winline {
            height: 3px;
            background: linear-gradient(to right, transparent, var(--gold), transparent);
            margin: 15px 0;
            box-shadow: 0 0 20px var(--gold);
        }

        .slots-message {
            text-align: center;
            min-height: 40px;
            margin-bottom: 20px;
            color: var(--success);
            font-weight: bold;
            font-size: 1.2rem;
            animation: messageFloat 0.5s ease;
        }

        @keyframes messageFloat {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .slots-controls {
            background: var(--bg-panel);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            min-width: 280px;
            box-shadow: 0 10px 30px rgba(56, 189, 248, 0.2);
        }

        .btn-spin {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--gold), var(--legendary));
            color: #0f172a;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.4);
        }

        .btn-spin:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 0 50px rgba(251, 191, 36, 0.8);
        }

        .btn-spin:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-spin:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .slots-stats {
            display: grid;
            gap: 12px;
        }

        @media (max-width: 768px) {
            .mines-container {
                flex-direction: column;
            }

            .mines-sidebar {
                width: 100%;
            }

            .mines-game {
                min-width: 100%;
            }

            .mine-cell {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- √âCRAN D'AUTHENTIFICATION -->
    <div id="auth-screen" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <h1>üíé The Royal Casino üíé</h1>
                <p style="color: #94a3b8;">Gagne des cartes cadeaux en ouvrant des caisses !</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="app.switchAuthTab('login')">Connexion</button>
                <button class="auth-tab" onclick="app.switchAuthTab('register')">Inscription</button>
            </div>

            <!-- Formulaire de Connexion -->
            <form id="login-form" class="auth-form active" onsubmit="app.login(event)">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="login-username" required placeholder="Entre ton pseudo">
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="login-password" required placeholder="Ton mot de passe">
                </div>
                <button type="submit" class="btn-main">Se Connecter</button>
            </form>

            <!-- Formulaire d'Inscription -->
            <form id="register-form" class="auth-form" onsubmit="app.register(event)">
                <div class="form-group">
                    <label>Nom d'utilisateur</label>
                    <input type="text" id="register-username" required placeholder="Choisis ton pseudo" minlength="3">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="register-email" required placeholder="ton@email.com">
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="register-password" required placeholder="Mot de passe s√©curis√©" minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirmer le mot de passe</label>
                    <input type="password" id="register-confirm" required placeholder="R√©p√®te ton mot de passe">
                </div>
                <button type="submit" class="btn-main">Cr√©er mon Compte</button>
            </form>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE -->
    <div id="app-container" class="hidden">
        
        <header>
            <div class="logo">üíé The Royal Casino üíé</div>
            <nav>
                <button onclick="app.nav('cases')" class="active">Caisses</button>
                <button onclick="app.nav('mines')">‚ö° Mines</button>
                <button onclick="app.nav('blackjack')">üé¥ Blackjack</button>
                <button onclick="app.nav('slots')">üé∞ Slots</button>
                <button onclick="app.nav('inventory')">Inventaire</button>
                <button onclick="app.nav('market')">March√©</button>
                <button onclick="app.nav('shop')">üíé Shop</button>
                <button onclick="app.nav('redeem')" style="color:var(--gold)">üéÅ Cadeaux</button>
                <button onclick="app.logout()" style="color:var(--danger)">D√©connexion</button>
            </nav>
            <div class="user-stats">
                <span id="user-name" style="color: white; margin-right: 5px;"></span>
                üíé <span id="user-diamonds">0</span>
                <span style="color:#94a3b8;">‚âà <span id="user-euros">0.00‚Ç¨</span></span>
            </div>
        </header>

        <div id="alert-container"></div>

        <main>
            
            <!-- SECTION CAISSES -->
            <div id="sec-cases" class="section active">
                
                <div id="roulette-wrapper">
                    <div class="indicator"></div>
                    <div id="roulette-strip"></div>
                </div>
                <div id="win-message"></div>

                <h2>Choisir une Caisse</h2>
                <div class="cases-grid">
                    <div class="case-card c-common" onclick="app.openCase('common')">
                        <div class="case-img">üì¶</div>
                        <h3>Caisse Commune</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Objets basiques pour d√©buter</p>
                        <div class="price-tag">üíé 10</div>
                    </div>
                    <div class="case-card c-rare" onclick="app.openCase('rare')">
                        <div class="case-img">üíº</div>
                        <h3>Caisse Rare</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Meilleure chance de gains</p>
                        <div class="price-tag">üíé 50</div>
                    </div>
                    <div class="case-card c-epic" onclick="app.openCase('epic')">
                        <div class="case-img">üîÆ</div>
                        <h3>Caisse √âpique</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Objets de grande valeur</p>
                        <div class="price-tag">üíé 150</div>
                    </div>
                    <div class="case-card c-legendary" onclick="app.openCase('legendary')">
                        <div class="case-img">üëë</div>
                        <h3>Caisse L√©gendaire</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">Jackpot possible !</p>
                        <div class="price-tag">üíé 500</div>
                    </div>
                    <div class="case-card c-mythic" onclick="app.openCase('mythic')">
                        <div class="case-img">üê≤</div>
                        <h3>Caisse Mythique</h3>
                        <p style="font-size:0.9rem; color:#94a3b8; margin: 10px 0;">L'√©lite absolue</p>
                        <div class="price-tag">üíé 1500</div>
                    </div>
                    <div class="case-card c-ultrapremium" onclick="app.openCase('ultrapremium')">
                        <div class="case-img" style="animation: spin 3s linear infinite;">‚ö°</div>
                        <h3>CAISSE ULTRA PREMIUM</h3>
                        <p style="font-size:0.9rem; color:#00ffff; margin: 10px 0; text-shadow: 0 0 10px rgba(0,255,255,0.8);">üíé 100,000 OU RIEN ! üíé</p>
                        <p style="font-size:0.8rem; color:#ff00ff; margin: 5px 0;">1 chance sur 1000</p>
                        <div class="price-tag">üíé 25,000</div>
                    </div>
                    <button onclick="app.getFreeCase()" class="btn-main" 
	                   style="margin-bottom:25px; width:100%; background:var(--success); color:#0f172a;">
                      	üéÅ Ouvrir ma Caisse Gratuite
                    </button>
                </div>
            </div>

            <!-- SECTION MINES -->
            <div id="sec-mines" class="section">
                <h2>‚ö° MINES üí£</h2>
                
                <div class="mines-container">
                    <div class="mines-game">
                        <div class="mines-header">
                            <h3>üéÆ JEUX DE MINES üéÆ</h3>
                            <p style="color: #0f172a; margin: 0; font-size: 0.9rem;">R√©v√®le les cases et empoche les diamants!</p>
                        </div>
                        
                        <div id="mines-message" class="game-message" style="display:none;"></div>
                        
                        <div class="multiplier-display" id="multiplier-container" style="display:none;">
                            <div class="multiplier-label">MULTIPLICATEUR ACTUEL</div>
                            <div class="multiplier-value" id="current-multiplier">1.00x</div>
                        </div>
                        
                        <div class="mines-grid" id="mines-grid"></div>
                    </div>
                    
                    <div class="mines-sidebar">
                        <div class="mines-stats">
                            <div class="stat-row">
                                <span class="stat-label">Balance üíé</span>
                                <span class="stat-value" id="mines-balance">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Mise üíé</span>
                                <span class="stat-value" id="mines-bet">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Gains Potentiels üíé</span>
                                <span class="stat-value" id="mines-potential">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Cases R√©v√©l√©es</span>
                                <span class="stat-value" id="mines-revealed">0/25</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Nombre de Mines</span>
                                <span class="stat-value" id="mines-count">0</span>
                            </div>
                        </div>
                        
                        <div class="mines-controls">
                            <div>
                                <label style="color: #cbd5e1; display: block; margin-bottom: 8px; font-weight: bold;">Miser des Diamants üíé</label>
                                <input type="number" id="mines-bet-input" class="bet-input" placeholder="Montant √† miser" min="1" value="10">
                            </div>
                        </div>
                        
                        <div class="mines-settings">
                            <div class="settings-title">‚öôÔ∏è PARAM√àTRES</div>
                            <div class="slider-container">
                                <label>Nombre de mines (1-24)</label>
                                <input type="range" id="mines-slider" min="1" max="24" value="3">
                                <div style="text-align: center; color: #4ade80; font-weight: bold; margin-top: 5px;">
                                    <span id="mines-slider-value">3</span> mines
                                </div>
                            </div>
                        </div>
                        
                        <div class="mines-actions">
                            <button class="btn-mines btn-play" id="btn-start-game" onclick="app.startMinesGame()">
                                üé¨ LANCER LA PARTIE
                            </button>
                            <button class="btn-mines btn-cashout" id="btn-cashout" onclick="app.minesCashout()" disabled style="display:none;">
                                üí∞ ENCAISSER LES GAINS
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION BLACKJACK -->
            <div id="sec-blackjack" class="section">
                <h2>üé¥ Blackjack</h2>
                
                <div class="blackjack-container">
                    <div class="blackjack-table">
                        <!-- Dealer Section -->
                        <div class="blackjack-player-section">
                            <div class="player-label">Croupier (Dealer)</div>
                            <div class="blackjack-cards" id="dealer-cards">
                                <div class="card-placeholder">Cartes du croupier</div>
                            </div>
                            <div class="player-value">Valeur: <span id="dealer-value">0</span></div>
                        </div>

                        <!-- Game Status -->
                        <div class="blackjack-status">
                            <div id="game-status" class="status-message"></div>
                            <div id="game-result" class="result-message"></div>
                        </div>

                        <!-- Player Section -->
                        <div class="blackjack-player-section">
                            <div class="player-label">Votre Main</div>
                            <div class="blackjack-cards" id="player-cards">
                                <div class="card-placeholder">Vos cartes</div>
                            </div>
                            <div class="player-value">Valeur: <span id="player-value">0</span></div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="blackjack-controls">
                        <div class="bet-section">
                            <label>Mise (Diamants) üíé</label>
                            <div class="bet-input-group">
                                <input type="number" id="blackjack-bet" placeholder="Entrez votre mise" min="1" value="100">
                                <div class="bet-presets">
                                    <button onclick="app.setBJBet(50)">50üíé</button>
                                    <button onclick="app.setBJBet(100)">100üíé</button>
                                    <button onclick="app.setBJBet(500)">500üíé</button>
                                    <button onclick="app.setBJBet(1000)">1Küíé</button>
                                </div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button id="bj-deal" class="btn-bj btn-deal" onclick="app.blackjackDeal()">üé≤ Distribuer</button>
                            <button id="bj-hit" class="btn-bj btn-action" onclick="app.blackjackHit()" disabled>Tirer</button>
                            <button id="bj-stand" class="btn-bj btn-action" onclick="app.blackjackStand()" disabled>Rester</button>
                            <button id="bj-double" class="btn-bj btn-action" onclick="app.blackjackDouble()" disabled>Doubler</button>
                        </div>

                        <div class="blackjack-stats">
                            <div class="stat-item">
                                <span class="stat-label">Balance:</span>
                                <span class="stat-value" id="bj-balance">0</span> üíé
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Mise Actuelle:</span>
                                <span class="stat-value" id="bj-current-bet">0</span> üíé
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Gain Potentiel:</span>
                                <span class="stat-value" id="bj-potential-win">0</span> üíé
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION SLOTS -->
            <div id="sec-slots" class="section">
                <h2>üé∞ Machine √† Sous</h2>
                
                <div class="slots-container">
                    <div class="slots-machine">
                        <!-- Slots Display -->
                        <div class="slots-display">
                            <div class="slots-header">
                                <h3>Slots Gagnante</h3>
                            </div>
                            <div class="slots-grid" id="slots-grid">
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-0">
                                        <div class="reel-item">üçé</div>
                                        <div class="reel-item">üçä</div>
                                        <div class="reel-item">üçã</div>
                                        <div class="reel-item">üçí</div>
                                        <div class="reel-item">üíé</div>
                                        <div class="reel-item">üëë</div>
                                        <div class="reel-item">üé∞</div>
                                        <div class="reel-item">üçé</div>
                                    </div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-1">
                                        <div class="reel-item">üçé</div>
                                        <div class="reel-item">üçä</div>
                                        <div class="reel-item">üçã</div>
                                        <div class="reel-item">üçí</div>
                                        <div class="reel-item">üíé</div>
                                        <div class="reel-item">üëë</div>
                                        <div class="reel-item">üé∞</div>
                                        <div class="reel-item">üçé</div>
                                    </div>
                                    <div class="reel-window"></div>
                                </div>
                                <div class="slot-reel">
                                    <div class="reel-container" id="reel-2">
                                        <div class="reel-item">üçé</div>
                                        <div class="reel-item">üçä</div>
                                        <div class="reel-item">üçã</div>
                                        <div class="reel-item">üçí</div>
                                        <div class="reel-item">üíé</div>
                                        <div class="reel-item">üëë</div>
                                        <div class="reel-item">üé∞</div>
                                        <div class="reel-item">üçé</div>
                                    </div>
                                    <div class="reel-window"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Winline -->
                        <div class="winline"></div>

                        <!-- Win Message -->
                        <div id="slots-message" class="slots-message"></div>

                        <!-- Controls -->
                        <div class="slots-controls">
                            <div class="bet-section">
                                <label>Mise par Ligne üíé</label>
                                <div class="bet-input-group">
                                    <input type="number" id="slots-bet" placeholder="Mise" min="1" value="10">
                                    <div class="bet-presets">
                                        <button onclick="app.setSlotsBet(10)">10üíé</button>
                                        <button onclick="app.setSlotsBet(25)">25üíé</button>
                                        <button onclick="app.setSlotsBet(50)">50üíé</button>
                                        <button onclick="app.setSlotsBet(100)">100üíé</button>
                                    </div>
                                </div>
                            </div>

                            <button id="slots-spin" class="btn-spin" onclick="app.slotsSpin()">üé∞ SPIN</button>

                            <div class="slots-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Balance:</span>
                                    <span class="stat-value" id="slots-balance">0</span> üíé
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Mise Totale:</span>
                                    <span class="stat-value" id="slots-total-bet">0</span> üíé
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Dernier Gain:</span>
                                    <span class="stat-value" id="slots-last-win">0</span> üíé
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION INVENTAIRE -->
            <div id="sec-inventory" class="section">
                <h2>Mon Inventaire</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">Vends tes objets rapidement ou mets-les sur le march√© pour plus de profit !</p>
                <div id="inventory-list" class="item-grid"></div>
            </div>

            <!-- SECTION MARCH√â -->
            <div id="sec-market" class="section">
                <h2>March√© des Joueurs</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">Ach√®te les objets des autres joueurs √† prix n√©goci√© !</p>
                <div id="market-list" class="item-grid"></div>
            </div>

            <!-- SECTION SHOP DIAMANTS -->
            <div id="sec-shop" class="section">
                <h2>üíé Boutique de Diamants</h2>
                <p style="color: #94a3b8; margin-bottom: 30px;">Ach√®te des diamants pour ouvrir plus de caisses !</p>
                
                <div class="diamond-packages">
                    <div class="diamond-package">
                        <h3>Starter Pack</h3>
                        <div class="diamond-amount">üíé 500</div>
                        <div class="diamond-price">2.99‚Ç¨</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Parfait pour d√©buter</p>
                        <button class="btn-main" onclick="app.selectPackage(500, 2.99)">Acheter</button>
                    </div>

                    <div class="diamond-package featured">
                        <h3>Pack Populaire</h3>
                        <div class="diamond-amount">üíé 2,500</div>
                        <div class="diamond-price">9.99‚Ç¨</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Meilleur rapport qualit√©/prix</p>
                        <button class="btn-main" onclick="app.selectPackage(2500, 9.99)">Acheter</button>
                    </div>

                    <div class="diamond-package">
                        <h3>Pack Premium</h3>
                        <div class="diamond-amount">üíé 10,000</div>
                        <div class="diamond-price">39.99‚Ç¨</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Pour les joueurs s√©rieux</p>
                        <button class="btn-main" onclick="app.selectPackage(10000, 39.99)">Acheter</button>
                    </div>

                    <div class="diamond-package" style="border-color: var(--mythic);">
                        <h3>Pack L√©gende</h3>
                        <div class="diamond-amount">üíé 25,000</div>
                        <div class="diamond-price">99.99‚Ç¨</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Maximum de diamants !</p>
                        <button class="btn-main" onclick="app.selectPackage(25000, 99.99)">Acheter</button>
                    </div>
                     
                    <div class="diamond-package">
                        <h3>Premium Luxury</h3>
                        <div class="diamond-amount">üíé 50,000</div>
                        <div class="diamond-price">199.99‚Ç¨</div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Riche a l'√©tat pure !!</p>
                        <button class="btn-main" onclick="app.selectPackage(50000, 199.99)">Acheter</button>
                    </div>
                </div>
            </div>

            <!-- SECTION CADEAUX & RETRAIT -->
            <div id="sec-redeem" class="section">
                <h2>üéÅ Boutique Cadeaux</h2>
                <p style="color: #94a3b8; margin-bottom: 30px;">√âchange tes diamants contre de vraies cartes cadeaux !</p>

                <!-- NOUVEAU : RETRAIT / CONVERSION DIAMANTS -> EUROS -->
                <div class="withdraw-card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <h3 style="margin-bottom:5px; color:var(--primary);">Convertir des Diamants en Euros</h3>
                            <p style="color:#cbd5e1; margin:0;">Taux estim√© : <strong>500 üíé = 1‚Ç¨</strong>. Les fonds seront envoy√©s dans un d√©lai de <strong>7 jours</strong> apr√®s validation. Fournis les informations n√©cessaires selon la m√©thode choisie.</p>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:#94a3b8; font-size:0.9rem;">Solde actuel</div>
                            <div style="font-weight:bold; font-size:1.1rem;">üíé <span id="withdraw-balance">0</span></div>
                            <div style="color:#cbd5e1;">‚âà <span id="withdraw-balance-eur">0.00‚Ç¨</span></div>
                        </div>
                    </div>

                    <div style="margin-top:15px;" class="withdraw-row">
                        <div>
                            <form id="withdraw-form" onsubmit="app.requestWithdrawal(event)">
                                <div class="form-group">
                                    <label>Montant souhait√© en ‚Ç¨</label>
                                    <input type="number" id="withdraw-eur" min="1" step="0.01" placeholder="Ex : 10.00" />
                                </div>
                                <div class="form-group">
                                    <label>Ou Montant en üíé (sera converti)</label>
                                    <input type="number" id="withdraw-diamonds" min="1" step="1" placeholder="Ex : 5000" />
                                </div>

                                <div class="form-group">
                                    <label>M√©thode de paiement</label>
                                    <select id="withdraw-method" onchange="app.toggleWithdrawFields()">
                                        <option value="paypal">PayPal</option>
                                        <option value="crypto">Cryptomonnaie</option>
                                        <option value="bank">Carte / IBAN</option>
                                    </select>
                                </div>

                                <div id="withdraw-fields"></div>

                                <div style="display:flex; gap:10px; margin-top:10px;">
                                    <button class="btn-main" type="submit" style="flex:1;">Demander le retrait</button>
                                    <button type="button" class="btn-main" onclick="app.fillMaxWithdraw()" style="background:#333; width:140px;">Max</button>
                                </div>

                                <div class="withdraw-summary" id="withdraw-summary" style="display:none; margin-top:12px;"></div>
                            </form>
                        </div>

                        <div class="withdraw-right">
                            <h4 style="margin-bottom:8px;">Informations importantes</h4>
                            <p style="color:#cbd5e1; font-size:0.95rem;">- Les retraits sont trait√©s sous 7 jours ouvr√©s.<br>- Les informations fournies sont n√©cessaires pour vous payer (PayPal / Crypto / IBAN).<br>- Merci d'utiliser notre casino en ligne !</p>
                            <div style="margin-top:10px;">
                                <button class="btn-main" onclick="app.showMyWithdrawals()" style="background:var(--accent)">Mes demandes</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="shop-grid" style="margin-top:20px;"> 
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #ff9900, #ffcc00)">AMAZON<br>10‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 5,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Amazon 10‚Ç¨', 5000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #00439c, #0070d1)">PSN<br>20‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 10,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('PSN 20‚Ç¨', 10000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #171a21, #66c0f4)">STEAM<br>50‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 25,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Steam 50‚Ç¨', 25000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #1DB954, #191414)">SPOTIFY<br>3 mois</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 8,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Spotify 3 mois', 8000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #dd4b39, #c53727)">NETFLIX<br>1 mois</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 6,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Netflix 1 mois', 6000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #3bccff, #1fb0d1)">GOOGLE PLAY<br>15‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 7,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Google Play 15‚Ç¨', 7500)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #a335ee, #7b68ee)">V-BUCKS<br>2,800</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 12,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Fortnite V-Bucks 2800', 12000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #1b1b3f, #5c3aee)">FIFA POINTS<br>4,600</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 15,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('FIFA Points 4600', 15000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #00a8e1, #0055cc)">CLASH ROYALE<br>500 Gems</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 8,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Clash Royale 500 Gems', 8500)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #ff6b00, #ffb700)">PLAYSTORE<br>20‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 10,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Play Store 20‚Ç¨', 10000)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #f4b942, #d4802d)">XBOX<br>25‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 12,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Xbox 25‚Ç¨', 12500)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #2a2a2a, #ffd700)">APPLE ITUNES<br>15‚Ç¨</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 7,500</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('Apple iTunes 15‚Ç¨', 7500)">√âchanger</button>
                    </div>
                    <div class="shop-item">
                        <div class="gift-card" style="background:linear-gradient(45deg, #ef4444, #1f2937)">YOUTUBE PREMIUM<br>3 mois</div>
                        <p style="margin: 10px 0; font-size: 1.1rem;">Co√ªt: <strong style="color: var(--gold)">üíé 9,000</strong></p>
                        <button class="btn-main" onclick="app.redeemCode('YouTube Premium 3 mois', 9000)">√âchanger</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- MODAL DE PAIEMENT -->
    <div id="payment-overlay" class="payment-overlay">
        <div class="payment-modal">
            <button class="btn-close" onclick="app.closePayment()">√ó</button>
            
            <div class="payment-header">
                <h3>Acheter des Diamants</h3>
                <div class="diamond-amount" id="payment-amount">üíé 0</div>
                <div class="diamond-price" id="payment-price">0.00‚Ç¨</div>
            </div>

            <div style="margin-bottom: 20px;">
                <p style="text-align: center; color: #94a3b8; margin-bottom: 15px;">Choisis ton mode de paiement :</p>
                <button class="payment-method" onclick="app.showPaymentForm('card')">
                    üí≥ Carte Bancaire
                </button>
                <button class="payment-method" onclick="app.showPaymentForm('paypal')">
                    <span style="color: #0070BA;">P</span><span style="color: #003087;">P</span> PayPal
                </button>
                <button class="payment-method" onclick="app.showPaymentForm('crypto')">
                    ‚Çø Cryptomonnaie
                </button>
            </div>

            <!-- Formulaire Carte Bancaire -->
            <form id="card-form" class="payment-form" onsubmit="app.processPayment(event, 'card')">
                <div class="form-group">
                    <label>Num√©ro de carte</label>
                    <input type="text" placeholder="1234 5678 9012 3456" maxlength="19" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date d'expiration</label>
                        <input type="text" placeholder="MM/AA" maxlength="5" required>
                    </div>
                    <div class="form-group">
                        <label>CVV</label>
                        <input type="text" placeholder="123" maxlength="3" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Nom sur la carte</label>
                    <input type="text" placeholder="JEAN DUPONT" required>
                </div>
                <button type="submit" class="btn-main">Payer <span id="card-price">0.00‚Ç¨</span></button>
            </form>

            <!-- Formulaire PayPal -->
            <form id="paypal-form" class="payment-form" onsubmit="app.processPayment(event, 'paypal')">
                <div class="form-group">
                    <label>Email PayPal</label>
                    <input type="email" placeholder="ton@email.com" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe PayPal</label>
                    <input type="password" placeholder="Ton mot de passe" required>
                </div>
                <button type="submit" class="btn-main">Continuer avec PayPal</button>
                <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 10px; text-align: center;">
                    Tu seras redirig√© vers PayPal pour finaliser
                </p>
            </form>

            <!-- Formulaire Crypto -->
            <form id="crypto-form" class="payment-form" onsubmit="app.processPayment(event, 'crypto')">
                <div class="form-group">
                    <label>Cryptomonnaie</label>
                    <select style="width: 100%; padding: 14px; background: rgba(15, 23, 42, 0.8); border: 2px solid #334155; color: white; border-radius: 8px;" required>
                        <option value="btc">Bitcoin (BTC)</option>
                        <option value="eth">Ethereum (ETH)</option>
                        <option value="usdt">Tether (USDT)</option>
                        <option value="bnb">Binance Coin (BNB)</option>
                    </select>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <p style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 10px;">Adresse de paiement :</p>
                    <p style="font-family: monospace; color: var(--primary); word-break: break-all; font-size: 0.9rem;">
                        1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa
                    </p>
                </div>
                <button type="submit" class="btn-main">J'ai effectu√© le paiement</button>
                <p style="font-size: 0.8rem; color: #94a3b8; margin-top: 10px; text-align: center;">
                    Les diamants seront cr√©dit√©s apr√®s confirmation
                </p>
            </form>
        </div>
    </div>

    <!-- ANIMATION DE SUCC√àS -->
    <div id="success-animation" class="success-animation">
        <div class="success-checkmark"></div>
        <div class="success-message">
            <h2>Paiement R√©ussi !</h2>
            <p>Tes diamants ont √©t√© ajout√©s √† ton compte</p>
            <div class="success-diamonds" id="success-diamonds-amount">üíé 0</div>
            <button class="btn-main" onclick="app.closeSuccess()" style="max-width: 300px;">Continuer</button>
        </div>
    </div>

    <script>
        // Taux de conversion pour les retraits
        const DIAMONDS_PER_EURO = 500; // 500 diamants = 1‚Ç¨

        const ITEMS_DB = {
            common: [
                { id: 'c1', name: 'Vieux Caillou', val: 2 },
                { id: 'c2', name: 'Bout de Bois', val: 3 },
                { id: 'c3', name: 'Pi√®ce Rouill√©e', val: 5 },
                { id: 'c4', name: 'Plume Us√©e', val: 4 },
                { id: 'z1', name: 'Poussi√®re Inutile', val: 0 },
                { id: 'z2', name: 'Truc Cass√©', val: 0 }
            ],
            rare: [
                { id: 'r1', name: 'Dague en Fer', val: 20 },
                { id: 'r2', name: 'Potion Bleue', val: 25 },
                { id: 'r3', name: 'Cape Verte', val: 30 },
                { id: 'r4', name: 'Grimoire Ancien', val: 35 },
                { id: 'z1', name: 'Poussi√®re Inutile', val: 0 },
                { id: 'z2', name: 'Truc Cass√©', val: 0 },
                { id: 'z3', name: 'D√©bris Sans Valeur', val: 0 }
            ],
            epic: [
                { id: 'e1', name: '√âp√©e de Cristal', val: 80 },
                { id: 'e2', name: 'Anneau Magique', val: 100 },
                { id: 'e3', name: 'Casque Dragon', val: 120 },
                { id: 'e4', name: 'Armure Enchant√©e', val: 140 },
                { id: 'z1', name: 'Poussi√®re Inutile', val: 0 },
                { id: 'z2', name: 'Truc Cass√©', val: 0 },
                { id: 'z3', name: 'D√©bris Sans Valeur', val: 0 }

            ],
            legendary: [
                { id: 'l1', name: 'Tr√¥ne d\'Or', val: 300 },
                { id: 'l2', name: 'Sceptre Royal', val: 400 },
                { id: 'l3', name: 'Orbe de Pouvoir', val: 450 },
                { id: 'z1', name: 'Poussi√®re Inutile', val: 0 },
                { id: 'z2', name: 'Truc Cass√©', val: 0 },
                { id: 'z3', name: 'D√©bris Sans Valeur', val: 0 }

            ],
            mythic: [
                { id: 'm1', name: 'üíé DIAMANT PUR', val: 2500 },
                { id: 'm2', name: 'üëë COURONNE DIVINE', val: 7500 },
                { id: 'm3', name: 'üåü √âTOILE √âTERNELLE', val: 1500 },
                { id: 'z1', name: 'Poussi√®re Inutile', val: 0 },
                { id: 'z2', name: 'Truc Cass√©', val: 0 },
                { id: 'z3', name: 'D√©bris Sans Valeur', val: 0 }

            ],
            ultrapremium: [
                { id: 'ultra1', name: 'üé∞ JACKPOT ULTRA üí∞', val: 100000 },
                { id: 'ultra_nothing1', name: 'üíÄ VOUS AVEZ PERDU TOUT ! üíÄ', val: 0 }
            ]
        };

        const CASE_PRICES = { common: 10, rare: 50, epic: 150, legendary: 500, mythic: 1500, ultrapremium: 25000 };
        let nextFreeCase = parseInt(localStorage.getItem('dc_freecase_time')) || 0;

        const app = {
            user: null,
            marketData: [],
            isSpinning: false,
            currentPackage: null,
            usersDB: {}, // Base de donn√©es locale des utilisateurs
            withdrawals: [],

            init: function() {
                // Charger les utilisateurs
                const savedUsers = localStorage.getItem('dc_users');
                this.usersDB = savedUsers ? JSON.parse(savedUsers) : {};

                // Charger le march√©
                const savedMarket = localStorage.getItem('dc_market');
                this.marketData = savedMarket ? JSON.parse(savedMarket) : [
                    { id: Date.now(), seller: 'Bot_Alpha', item: ITEMS_DB.rare[0], price: 30, rarity: 'rare' },
                    { id: Date.now()+1, seller: 'Bot_Beta', item: ITEMS_DB.epic[0], price: 90, rarity: 'epic' }
                ];

                // Charger les retraits existants
                const savedWithdrawals = localStorage.getItem('dc_withdrawals');
                this.withdrawals = savedWithdrawals ? JSON.parse(savedWithdrawals) : [];

                // === BOTS MARKET AUTO ===
                setInterval(() => {
                    const botNames = ["Ares", "Nyx", "Kappa", "Zero"];

                    const randomBot = botNames[Math.floor(Math.random() * botNames.length)];
                    const rarityList = ["common", "rare", "epic", "legendary"];
                    const rarity = rarityList[Math.floor(Math.random() * rarityList.length)];

                    const pool = ITEMS_DB[rarity];
                    const item = pool[Math.floor(Math.random() * pool.length)];

                    app.marketData.push({
                        id: Date.now(),
                        seller: randomBot,
                        item: item,
                        price: Math.floor(item.val * (1 + Math.random() * 1.5)),
                        rarity: rarity
                    });

                    app.saveUser();
                }, 20000); // un bot ajoute une offre toutes les 20 sec
                // === BOTS QUI ACH√àTENT DES ITEMS ===
                setInterval(() => {
                    if (app.marketData.length === 0) return;

                    const chance = Math.random();
                    if (chance < 0.4) return; // 40% de chance qu‚Äôun bot ach√®te

                    const offers = app.marketData.filter(o => o.seller !== "BOT");
                    if (offers.length === 0) return;

                    const pick = offers[Math.floor(Math.random() * offers.length)];

                    // Trouver propri√©taire
                    const seller = app.usersDB[pick.seller];
                    if (seller) {
                        seller.diamonds += pick.price;
                        app.usersDB[pick.seller] = seller;
                        localStorage.setItem('dc_users', JSON.stringify(app.usersDB));
                    }

                    // Notif si c'est toi
                    if (pick.seller === app.user?.name) {
                        app.notify(`ü§ñ Un bot a achet√© ton item : +${pick.price}üíé`, "success");
                        app.user.diamonds += pick.price;
                        app.saveUser();
                    }

                    // Retirer l'offre
                    app.marketData = app.marketData.filter(o => o.id !== pick.id);
                    app.saveUser();
                }, 15000); // tentative d'achat bot toutes les 15 sec

                // V√©rifier si connect√©
                const currentUser = localStorage.getItem('dc_current_user');
                if (currentUser) {
                    this.user = JSON.parse(currentUser);
                    this.showApp();
                }
                this.updateWithdrawBalanceUI();
            },

            switchAuthTab: function(tab) {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                
                event.target.classList.add('active');
                document.getElementById(tab + '-form').classList.add('active');
            },

            register: function(e) {
                e.preventDefault();
                
                const username = document.getElementById('register-username').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;

                if (password !== confirm) {
                    this.notify('Les mots de passe ne correspondent pas !', 'error');
                    return;
                }

                if (this.usersDB[username]) {
                    this.notify('Ce nom d\'utilisateur existe d√©j√† !', 'error');
                    return;
                }

                // Cr√©er le compte
                this.usersDB[username] = {
                    username: username,
                    email: email,
                    password: password, // En production, il faudrait hasher le mot de passe
                    diamonds: 200, // Bonus d'inscription
                    inventory: [],
                    createdAt: Date.now()
                };

                localStorage.setItem('dc_users', JSON.stringify(this.usersDB));
                
                this.notify('Compte cr√©√© avec succ√®s ! üéâ', 'success');
                
                // Auto-connexion
                this.user = {
                    name: username,
                    email: email,
                    diamonds: 200,
                    inventory: []
                };
                
                this.saveUser();
                this.showApp();
                this.notify(`Bienvenue ${username} ! +200 üíé de bonus !`, 'success');
            },

            login: function(e) {
                e.preventDefault();
                
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;

                const userAccount = this.usersDB[username];
                
                if (!userAccount) {
                    this.notify('Utilisateur introuvable !', 'error');
                    return;
                }

                if (userAccount.password !== password) {
                    this.notify('Mot de passe incorrect !', 'error');
                    return;
                }

                // Connexion r√©ussie
                this.user = {
                    name: username,
                    email: userAccount.email,
                    diamonds: userAccount.diamonds,
                    inventory: userAccount.inventory || []
                };

                this.saveUser();
                this.showApp();
                this.notify(`Content de te revoir ${username} !`, 'success');
            },

            logout: function() {
                localStorage.removeItem('dc_current_user');
                location.reload();
            },

            saveUser: function() {
                localStorage.setItem('dc_current_user', JSON.stringify(this.user));
                
                // Mettre √† jour la base de donn√©es
                if (this.usersDB[this.user.name]) {
                    this.usersDB[this.user.name].diamonds = this.user.diamonds;
                    this.usersDB[this.user.name].inventory = this.user.inventory;
                    localStorage.setItem('dc_users', JSON.stringify(this.usersDB));
                }
                
                localStorage.setItem('dc_market', JSON.stringify(this.marketData));
                localStorage.setItem('dc_withdrawals', JSON.stringify(this.withdrawals));
                this.updateUI();
            },

            showApp: function() {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                this.updateUI();
                this.renderMarket();
            },

            updateUI: function() {
                document.getElementById('user-name').innerText = this.user.name;
                document.getElementById('user-diamonds').innerText = this.user.diamonds.toLocaleString();
                this.updateEuroDisplay();
                this.renderInventory();
                this.updateWithdrawBalanceUI();
            },

            updateEuroDisplay: function() {
                const euros = (this.user.diamonds / DIAMONDS_PER_EURO);
                document.getElementById('user-euros').innerText = `${euros.toFixed(2)}‚Ç¨`;
            },

            updateWithdrawBalanceUI: function() {
                const bal = this.user ? this.user.diamonds : 0;
                document.getElementById('withdraw-balance').innerText = bal.toLocaleString();
                document.getElementById('withdraw-balance-eur').innerText = `${(bal / DIAMONDS_PER_EURO).toFixed(2)}‚Ç¨`;
            },

            nav: function(screen) {
                document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
                document.getElementById('sec-' + screen).classList.add('active');
                
                document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
                event.target.classList.add('active');

                if (screen === 'market') {
                    this.renderMarket();
                }
                
                if (screen === 'mines') {
                    this.updateMinesUI();
                }
                
                if (screen === 'blackjack') {
                    this.updateBJUI();
                }
                
                if (screen === 'slots') {
                    this.updateSlotsUI();
                }
            },

            openCase: function(type) {
                if (this.isSpinning) return;
                const cost = CASE_PRICES[type];
                
                if (this.user.diamonds < cost) {
                    return this.notify("Pas assez de diamants ! Visite la boutique üíé", "error");
                }

                this.user.diamonds -= cost;
                this.saveUser();

                let pool = [];
                if (type === 'common') pool = [...ITEMS_DB.common, ...ITEMS_DB.common, ...ITEMS_DB.rare];
                if (type === 'rare') pool = [...ITEMS_DB.common, ...ITEMS_DB.rare, ...ITEMS_DB.rare, ...ITEMS_DB.epic];
                if (type === 'epic') pool = [...ITEMS_DB.rare, ...ITEMS_DB.epic, ...ITEMS_DB.epic, ...ITEMS_DB.legendary];
                if (type === 'legendary') pool = [...ITEMS_DB.epic, ...ITEMS_DB.legendary, ...ITEMS_DB.legendary, ...ITEMS_DB.mythic];
                if (type === 'mythic') pool = [...ITEMS_DB.legendary, ...ITEMS_DB.mythic, ...ITEMS_DB.mythic];
                if (type === 'ultrapremium') {
                    const chanceDeLaVie = Math.random() * 100;
                    if (chanceDeLaVie < 1) {
                        pool = [ITEMS_DB.ultrapremium[0]];
                    } else {
                        pool = [ITEMS_DB.ultrapremium[1]];
                    }
                }

                const winner = pool[Math.floor(Math.random() * pool.length)];
                
                let rarity = 'common';
                if (ITEMS_DB.rare.includes(winner)) rarity = 'rare';
                if (ITEMS_DB.epic.includes(winner)) rarity = 'epic';
                if (ITEMS_DB.legendary.includes(winner)) rarity = 'legendary';
                if (ITEMS_DB.mythic.includes(winner)) rarity = 'mythic';
                if (ITEMS_DB.ultrapremium.includes(winner)) rarity = 'ultrapremium';

                this.runRoulette(pool, winner, rarity, type);
            },

            getFreeCase: function() {
                const now = Date.now();

                if (now < nextFreeCase) {
                    const reste = Math.ceil((nextFreeCase - now) / 60000);
                    return this.notify(`‚è≥ Reviens dans ${reste} min pour ton coffre gratuit !`, "error");
                }

                nextFreeCase = now + (10 * 60 * 1000);
                localStorage.setItem('dc_freecase_time', nextFreeCase);

                this.openCase("common");
                this.notify("üéÅ Caisse gratuite obtenue !", "success");
            },

            runRoulette: function(pool, winner, winnerRarity, caseType = 'common') {
                this.isSpinning = true;
                const wrapper = document.getElementById('roulette-wrapper');
                const strip = document.getElementById('roulette-strip');
                const msg = document.getElementById('win-message');
                
                wrapper.style.display = 'block';
                
                if (caseType === 'ultrapremium') {
                    msg.innerHTML = '<span style="color: #00ffff; text-shadow: 0 0 20px rgba(0,255,255,1); font-size: 1.2rem; font-weight: bold;">‚ö° TIRAGE ULTRA PREMIUM ‚ö°</span>';
                    wrapper.style.background = 'linear-gradient(to bottom, #000033, #001a1a)';
                    wrapper.style.boxShadow = '0 0 50px rgba(0,255,255,0.8), 0 0 100px rgba(255,0,255,0.6)';
                } else {
                    msg.innerHTML = '<span style="color: var(--gold)">üé≤ Tirage en cours...</span>';
                }
                
                strip.style.transition = 'none';
                strip.style.transform = 'translateX(0)';
                strip.innerHTML = '';

                const itemsToShow = [];
                for(let i=0; i<50; i++) {
                    if (i === 40) {
                        itemsToShow.push({item: winner, rarity: winnerRarity});
                    } else {
                        const randomItem = pool[Math.floor(Math.random() * pool.length)];
                        let r = 'common';
                        if(ITEMS_DB.rare.includes(randomItem)) r = 'rare'; 
                        if(ITEMS_DB.epic.includes(randomItem)) r = 'epic';
                        if(ITEMS_DB.legendary.includes(randomItem)) r = 'legendary';
                        if(ITEMS_DB.mythic.includes(randomItem)) r = 'mythic';
                        if(ITEMS_DB.ultrapremium.includes(randomItem)) r = 'ultrapremium';
                        itemsToShow.push({item: randomItem, rarity: r});
                    }
                }

                itemsToShow.forEach(obj => {
                    const div = document.createElement('div');
                    div.className = 'roulette-item';
                    let glowStyle = '';
                    if (obj.rarity === 'ultrapremium') {
                        glowStyle = 'text-shadow: 0 0 20px rgba(0,255,255,1), 0 0 10px rgba(255,0,255,0.8);';
                    }
                    div.innerHTML = `
                        <span style="color:var(--${obj.rarity}); font-size: 2rem; ${glowStyle}">‚òÖ</span>
                        <small style="color: #cbd5e1; margin-top: 5px;">${obj.item.name}</small>
                    `;
                    div.style.borderBottom = `4px solid var(--${obj.rarity})`;
                    strip.appendChild(div);
                });

                setTimeout(() => {
                    const itemWidth = 130;
                    const offset = (40 * itemWidth) - (wrapper.clientWidth / 2) + (itemWidth / 2);
                    
                    strip.style.transition = 'transform 4s cubic-bezier(0.1, 0.9, 0.3, 1)';
                    strip.style.transform = `translateX(-${offset}px)`;
                }, 50);

                setTimeout(() => {
                    this.isSpinning = false;
                    let displayRarity = winnerRarity;
                    if (winnerRarity === 'ultrapremium') {
                        displayRarity = '#00ffff';
                    }
                    msg.innerHTML = `üéâ Gagn√© : <span style="color:${displayRarity === '#00ffff' ? displayRarity : 'var(--' + winnerRarity + ')'}; font-weight: bold; text-shadow: ${winnerRarity === 'ultrapremium' ? '0 0 15px rgba(0,255,255,1)' : 'none'};">${winner.name}</span> ! (+${winner.val}üíé)`;
                    this.user.inventory.push({ ...winner, rarity: winnerRarity, uid: Date.now() });
                    this.saveUser();
                    this.notify(`‚ú® ${winner.name} ajout√© √† ton inventaire !`, 'success');
                }, 4100);
            },

            renderInventory: function() {
                const container = document.getElementById('inventory-list');
                container.innerHTML = '';
                
                if (this.user.inventory.length === 0) {
                    container.innerHTML = '<p style="color:grey; width:100%; text-align:center; padding: 40px;">Inventaire vide. Ouvre des caisses pour gagner des objets !</p>';
                    return;
                }

                this.user.inventory.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = `item-card ${item.rarity}`;
                    div.innerHTML = `
                        <div style="font-size: 2rem; margin-bottom: 10px;">‚òÖ</div>
                        <strong style="display: block; margin-bottom: 5px;">${item.name}</strong>
                        <small style="color: #94a3b8;">Valeur: ${item.val} üíé</small>
                        <button class="btn-action btn-sell" onclick="app.sellSystem(${index})">Vendre ${item.val}üíé</button>
                        <button class="btn-action btn-market" onclick="app.showMarketForm(${index})">Vendre sur March√©</button>
                        <div id="market-form-${index}" class="market-price-form">
                            <input type="number" id="price-${index}" placeholder="Prix en üíé" min="${item.val}">
                            <button class="btn-confirm" onclick="app.confirmMarketSale(${index})">‚úì</button>
                            <button class="btn-cancel" onclick="app.cancelMarketForm(${index})">‚úó</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            },

            showMarketForm: function(index) {
                document.getElementById(`market-form-${index}`).classList.add('active');
            },

            cancelMarketForm: function(index) {
                document.getElementById(`market-form-${index}`).classList.remove('active');
            },

            confirmMarketSale: function(index) {
                const priceInput = document.getElementById(`price-${index}`);
                const price = parseInt(priceInput.value);
                const item = this.user.inventory[index];

                if (!price || price < item.val) {
                    this.notify('Prix invalide ! Minimum: ' + item.val + 'üíé', 'error');
                    return;
                }

                this.marketData.push({
                    id: Date.now(),
                    seller: this.user.name,
                    item: item,
                    price: price,
                    rarity: item.rarity
                });

                this.user.inventory.splice(index, 1);
                this.saveUser();
                this.notify("‚úÖ Objet mis en vente sur le march√© !", 'success');
            },

            sellSystem: function(index) {
                const item = this.user.inventory[index];
                this.user.diamonds += item.val;
                this.user.inventory.splice(index, 1);
                this.saveUser();
                this.notify(`üí∞ Vendu pour ${item.val}üíé`, 'success');
            },

            renderMarket: function() {
                const container = document.getElementById('market-list');
                container.innerHTML = '';

                if (this.marketData.length === 0) {
                    container.innerHTML = '<p style="color:grey; width:100%; text-align:center; padding: 40px;">Aucune offre sur le march√© pour le moment.</p>';
                    return;
                }

                this.marketData.forEach((offer, index) => {
                    const isMe = offer.seller === this.user.name;
                    const div = document.createElement('div');
                    div.className = `item-card ${offer.rarity}`;
                    div.innerHTML = `
                        <div style="font-size: 2rem; margin-bottom: 10px;">‚òÖ</div>
                        <strong style="display: block; margin-bottom: 5px;">${offer.item.name}</strong>
                        <small style="color: #94a3b8; display: block; margin-bottom: 5px;">Vendeur: ${offer.seller}</small>
                        <strong style="color:var(--gold); font-size: 1.1rem;">${offer.price} üíé</strong>
                        ${isMe 
                            ? `<button class="btn-action" disabled style="background:#333; cursor: not-allowed;">Ton offre</button>` 
                            : `<button class="btn-action btn-buy" onclick="app.buyMarket(${index})">Acheter</button>`
                        }
                    `;
                    container.appendChild(div);
                });
            },

            buyMarket: function(index) {
                const offer = this.marketData[index];
                if (this.user.diamonds < offer.price) {
                    return this.notify("üíé Pas assez de diamants !", "error");
                }

                this.user.diamonds -= offer.price;
                this.user.inventory.push({ ...offer.item, rarity: offer.rarity, uid: Date.now() });
                
                this.marketData.splice(index, 1);
                
                this.saveUser();
                this.renderMarket();
                this.notify(`‚úÖ Achat r√©ussi : ${offer.item.name}`, 'success');
            },

            selectPackage: function(amount, price) {
                this.currentPackage = { amount, price };
                document.getElementById('payment-amount').innerText = `üíé ${amount.toLocaleString()}`;
                document.getElementById('payment-price').innerText = `${price.toFixed(2)}‚Ç¨`;
                document.getElementById('card-price').innerText = `${price.toFixed(2)}‚Ç¨`;
                document.getElementById('payment-overlay').classList.add('active');
            },

            closePayment: function() {
                document.getElementById('payment-overlay').classList.remove('active');
                document.querySelectorAll('.payment-form').forEach(f => f.classList.remove('active'));
            },

            showPaymentForm: function(type) {
                document.querySelectorAll('.payment-form').forEach(f => f.classList.remove('active'));
                document.getElementById(type + '-form').classList.add('active');
            },

            processPayment: function(e, method) {
                e.preventDefault();
                
                this.closePayment();
                
                // Simulation de traitement
                setTimeout(() => {
                    this.user.diamonds += this.currentPackage.amount;
                    this.saveUser();
                    
                    document.getElementById('success-diamonds-amount').innerText = `üíé +${this.currentPackage.amount.toLocaleString()}`;
                    document.getElementById('success-animation').classList.add('active');
                    
                    this.notify(`üíé ${this.currentPackage.amount.toLocaleString()} diamants ajout√©s !`, 'success');
                }, 500);
            },

            closeSuccess: function() {
                document.getElementById('success-animation').classList.remove('active');
            },

            generateCardCode: function(cardType) {
                const getRandomHex = (length) => {
                    let result = '';
                    for (let i = 0; i < length; i++) {
                        result += Math.floor(Math.random() * 16).toString(16).toUpperCase();
                    }
                    return result;
                };
                
                const getRandomNum = (length) => {
                    let result = '';
                    for (let i = 0; i < length; i++) {
                        result += Math.floor(Math.random() * 10);
                    }
                    return result;
                };
                
                const codes = {
                    'Amazon': `AMZN-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}`,
                    'PSN': `${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Steam': `STEAM-${getRandomHex(8)}-${getRandomHex(8)}`,
                    'Spotify': `SPT${getRandomNum(5)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Netflix': `NF-${getRandomNum(3)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Google Play': `GPT-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Fortnite': `VB-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}`,
                    'FIFA': `FUT${getRandomNum(4)}${getRandomNum(4)}${getRandomNum(4)}${getRandomNum(4)}`,
                    'Clash Royale': `CR-${getRandomNum(5)}-${getRandomNum(5)}-${getRandomNum(5)}`,
                    'Play Store': `PS-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Xbox': `${getRandomNum(3)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'Apple': `APP-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}-${getRandomNum(4)}`,
                    'YouTube': `YT${getRandomNum(3)}-${getRandomNum(5)}-${getRandomNum(5)}-${getRandomNum(5)}`
                };
                
                for (let key in codes) {
                    if (cardType.includes(key)) {
                        return codes[key];
                    }
                }
                
                return `GC-${getRandomHex(4)}-${getRandomHex(4)}-${getRandomHex(4)}`;
            },

            redeemCode: function(name, cost) {
                if (this.user.diamonds < cost) {
                    return this.notify(`Il te faut ${cost.toLocaleString()} diamants !`, "error");
                }

                this.user.diamonds -= cost;
                this.saveUser();
                
                const code = this.generateCardCode(name);
                
                // Afficher dans un message styl√©
                const codeDisplay = document.createElement('div');
                codeDisplay.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--bg-panel);
                    padding: 40px;
                    border-radius: 16px;
                    border: 2px solid var(--gold);
                    z-index: 500;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.9);
                    animation: slideUp 0.4s ease;
                `;
                codeDisplay.innerHTML = `
                    <h2 style="color: var(--gold); margin-bottom: 20px;">üéâ F√âLICITATIONS !</h2>
                    <p style="margin-bottom: 15px; color: #cbd5e1;">Voici ta carte cadeau <strong>${name}</strong></p>
                    <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <p style="font-size: 1.3rem; font-family: monospace; color: var(--primary); letter-spacing: 3px; font-weight: bold;">${code}</p>
                    </div>
                    <p style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 20px;">üìã Note bien ce code, il ne sera plus affich√© !</p>
                    <button class="btn-main" onclick="this.parentElement.remove()" style="max-width: 200px;">Fermer</button>
                `;
                document.body.appendChild(codeDisplay);
                
                this.notify("üéÅ Carte cadeau r√©cup√©r√©e !", "success");
            },

            notify: function(msg, type='info') {
                const box = document.createElement('div');
                box.className = 'toast';
                box.innerText = msg;
                if(type === 'error') box.style.borderLeftColor = 'var(--danger)';
                if(type === 'success') box.style.borderLeftColor = 'var(--success)';
                
                document.getElementById('alert-container').appendChild(box);
                setTimeout(() => box.remove(), 3500);
            },

            // -----------------------
            // Syst√®me de retrait
            // -----------------------
            toggleWithdrawFields: function() {
                const method = document.getElementById('withdraw-method').value;
                const container = document.getElementById('withdraw-fields');
                container.innerHTML = '';

                if (method === 'paypal') {
                    container.innerHTML = `
                        <div class="form-group">
                            <label>Email PayPal</label>
                            <input type="email" id="withdraw-paypal-email" placeholder="ton@email.com" required>
                        </div>
                        <div class="form-group">
                            <label>Nom complet (pour PayPal)</label>
                            <input type="text" id="withdraw-paypal-name" placeholder="Jean Dupont" required>
                        </div>
                    `;
                } else if (method === 'crypto') {
                    container.innerHTML = `
                        <div class="form-group">
                            <label>Cryptomonnaie</label>
                            <select id="withdraw-crypto-currency" style="width:100%; padding:12px; background:rgba(15,23,42,0.8); border:2px solid #334155; color:white; border-radius:8px;">
                                <option value="btc">Bitcoin (BTC)</option>
                                <option value="eth">Ethereum (ETH)</option>
                                <option value="usdt">Tether (USDT)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Adresse de r√©ception</label>
                            <input type="text" id="withdraw-crypto-address" placeholder="Adresse crypto" required>
                        </div>
                    `;
                } else if (method === 'bank') {
                    container.innerHTML = `
                        <div class="form-group">
                            <label>Nom complet</label>
                            <input type="text" id="withdraw-bank-name" placeholder="Jean Dupont" required>
                        </div>
                        <div class="form-group">
                            <label>IBAN / RIB</label>
                            <input type="text" id="withdraw-bank-iban" placeholder="FR76 3000 6000 0112 3456 7890 189" required>
                        </div>
                        <div class="form-group">
                            <label>Note (optionnel)</label>
                            <input type="text" id="withdraw-bank-note" placeholder="Informations suppl√©mentaires (ex: BIC)">
                        </div>
                    `;
                }
            },

            fillMaxWithdraw: function() {
                if (!this.user) return;
                const maxEur = (this.user.diamonds / DIAMONDS_PER_EURO);
                document.getElementById('withdraw-eur').value = maxEur.toFixed(2);
                document.getElementById('withdraw-diamonds').value = this.user.diamonds;
            },

            requestWithdrawal: function(e) {
                e.preventDefault();
                if (!this.user) {
                    return this.notify('Connecte-toi pour demander un retrait.', 'error');
                }

                const eurInput = parseFloat(document.getElementById('withdraw-eur').value || 0);
                const diamondsInput = parseInt(document.getElementById('withdraw-diamonds').value || 0);

                let euros = 0;
                if (eurInput > 0) euros = parseFloat(eurInput.toFixed(2));
                else if (diamondsInput > 0) euros = parseFloat((diamondsInput / DIAMONDS_PER_EURO).toFixed(2));
                else return this.notify('Indique un montant en ‚Ç¨ ou en diamants.', 'error');

                if (euros < 1) return this.notify('Montant minimum : 1‚Ç¨', 'error');

                const requiredDiamonds = Math.ceil(euros * DIAMONDS_PER_EURO);

                if (this.user.diamonds < requiredDiamonds) {
                    return this.notify(`Pas assez de diamants. Il faut ${requiredDiamonds.toLocaleString()} üíé`, 'error');
                }

                const method = document.getElementById('withdraw-method').value;
                const details = {};

                if (method === 'paypal') {
                    const email = document.getElementById('withdraw-paypal-email')?.value?.trim();
                    const name = document.getElementById('withdraw-paypal-name')?.value?.trim();
                    if (!email || !name) return this.notify('Remplis les informations PayPal.', 'error');
                    details.paypalEmail = email;
                    details.name = name;
                } else if (method === 'crypto') {
                    const curr = document.getElementById('withdraw-crypto-currency')?.value;
                    const addr = document.getElementById('withdraw-crypto-address')?.value?.trim();
                    if (!curr || !addr) return this.notify('Remplis les informations Crypto.', 'error');
                    details.currency = curr;
                    details.address = addr;
                } else if (method === 'bank') {
                    const name = document.getElementById('withdraw-bank-name')?.value?.trim();
                    const iban = document.getElementById('withdraw-bank-iban')?.value?.trim();
                    const note = document.getElementById('withdraw-bank-note')?.value?.trim();
                    if (!name || !iban) return this.notify('Remplis le nom et l\'IBAN.', 'error');
                    details.name = name;
                    details.iban = iban;
                    details.note = note;
                }

                // D√©duire imm√©diatement les diamants
                this.user.diamonds -= requiredDiamonds;

                // Cr√©er la demande
                const requestedAt = Date.now();
                const processDate = requestedAt + (7 * 24 * 60 * 60 * 1000); // +7 jours
                const req = {
                    id: 'W' + Date.now(),
                    user: this.user.name,
                    euros: euros,
                    diamondsDeducted: requiredDiamonds,
                    method: method,
                    details: details,
                    requestedAt: requestedAt,
                    processDate: processDate,
                    status: 'pending' // pending / processed
                };

                this.withdrawals.push(req);
                this.saveUser();

                // Afficher r√©sum√© modal simple
                const summary = document.getElementById('withdraw-summary');
                const date = new Date(processDate);
                summary.style.display = 'block';
                summary.innerHTML = `‚úÖ Demande enregistr√©e : <strong>${euros.toFixed(2)}‚Ç¨</strong> (d√©duit ${requiredDiamonds.toLocaleString()} üíé). Traitement estim√© le <strong>${date.toLocaleDateString()}</strong>. ID: ${req.id}`;
                
                this.notify(`Demande de retrait de ${euros.toFixed(2)}‚Ç¨ cr√©√©e. ID: ${req.id}`, 'success');
                document.getElementById('withdraw-form').reset();
                this.toggleWithdrawFields(); // r√©initialise les champs dynamiques
                this.updateWithdrawBalanceUI();
            },

            showMyWithdrawals: function() {
                const userRequests = this.withdrawals.filter(w => w.user === (this.user?.name || ''));
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; inset: 0; display:flex; align-items:center; justify-content:center;
                    background: rgba(0,0,0,0.8); z-index:800; padding: 20px;
                `;
                const box = document.createElement('div');
                box.style.cssText = 'background:var(--bg-panel); padding:20px; border-radius:12px; width:100%; max-width:700px; max-height:80vh; overflow:auto; border:2px solid var(--primary);';
                box.innerHTML = `<h3 style="color:var(--primary)">Mes demandes de retrait</h3>`;
                if (userRequests.length === 0) {
                    box.innerHTML += `<p style="color:#cbd5e1">Aucune demande pour le moment.</p>`;
                } else {
                    userRequests.slice().reverse().forEach(r => {
                        const d = new Date(r.requestedAt);
                        const pd = new Date(r.processDate);
                        box.innerHTML += `
                            <div style="background:rgba(0,0,0,0.25); padding:10px; margin:8px 0; border-radius:8px;">
                                <div style="display:flex; justify-content:space-between;">
                                    <div><strong>${r.euros.toFixed(2)}‚Ç¨</strong> ‚Äî ${r.method.toUpperCase()}</div>
                                    <div style="color:#94a3b8">${r.status.toUpperCase()}</div>
                                </div>
                                <div style="color:#cbd5e1; font-size:0.9rem;">
                                    ID: ${r.id} ‚Ä¢ demand√©: ${d.toLocaleString()} ‚Ä¢ estim√©: ${pd.toLocaleDateString()}
                                </div>
                            </div>
                        `;
                    });
                }
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn-main';
                closeBtn.style.marginTop = '10px';
                closeBtn.innerText = 'Fermer';
                closeBtn.onclick = () => modal.remove();
                box.appendChild(closeBtn);
                modal.appendChild(box);
                document.body.appendChild(modal);
            },

            // -----------------------
            // Mines / autres fonctions (inchang√©es)
            // -----------------------
            minesState: {
                grid: [],
                mines: [],
                revealed: [],
                gameActive: false,
                bet: 0,
                minesCount: 3,
                revealedCount: 0,
                multiplier: 1
            },

            startMinesGame: function() {
                const betInput = document.getElementById('mines-bet-input');
                const bet = parseInt(betInput.value);
                
                if (!bet || bet < 1) {
                    this.notify('Veuillez entrer un montant valide !', 'error');
                    return;
                }
                
                if (this.user.diamonds < bet) {
                    this.notify('Pas assez de diamants pour cette mise !', 'error');
                    return;
                }
                
                this.minesState.minesCount = parseInt(document.getElementById('mines-slider').value);
                
                if (this.minesState.gameActive) {
                    this.notify('Partie en cours ! Encaissez ou perdez d\'abord.', 'error');
                    return;
                }
                
                this.user.diamonds -= bet;
                this.minesState.bet = bet;
                this.minesState.gameActive = true;
                this.minesState.revealedCount = 0;
                this.minesState.multiplier = 1;
                
                this.initMinesGame();
                this.updateMinesUI();
                
                document.getElementById('btn-start-game').disabled = true;
                document.getElementById('mines-bet-input').disabled = true;
                document.getElementById('mines-slider').disabled = true;
            },

            initMinesGame: function() {
                this.minesState.grid = Array(25).fill(false);
                this.minesState.revealed = Array(25).fill(false);
                
                const minesPositions = [];
                while (minesPositions.length < this.minesState.minesCount) {
                    const pos = Math.floor(Math.random() * 25);
                    if (!minesPositions.includes(pos)) {
                        minesPositions.push(pos);
                    }
                }
                
                this.minesState.mines = minesPositions;
                
                const container = document.getElementById('mines-grid');
                container.innerHTML = '';
                
                for (let i = 0; i < 25; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'mine-cell';
                    cell.id = `mine-cell-${i}`;
                    cell.innerText = '?';
                    cell.onclick = () => this.revealCell(i);
                    container.appendChild(cell);
                }
                
                const msgDiv = document.getElementById('mines-message');
                msgDiv.style.display = 'none';
                
                const multiplierDiv = document.getElementById('multiplier-container');
                multiplierDiv.style.display = 'block';
                
                const cashoutBtn = document.getElementById('btn-cashout');
                cashoutBtn.disabled = false;
                cashoutBtn.style.display = 'block';
            },

            revealCell: function(index) {
                if (!this.minesState.gameActive) return;
                if (this.minesState.revealed[index]) return;
                
                this.minesState.revealed[index] = true;
                const cell = document.getElementById(`mine-cell-${index}`);
                
                const isMine = this.minesState.mines.includes(index);
                
                if (isMine) {
                    cell.classList.add('revealed', 'bomb');
                    cell.innerText = 'üí£';
                    this.minesGameOver(false);
                } else {
                    cell.classList.add('revealed', 'safe');
                    this.minesState.revealedCount++;
                    
                    this.minesState.multiplier = this.calculateMultiplier();
                    
                    const safe = 25 - this.minesState.minesCount;
                    if (this.minesState.revealedCount === safe) {
                        this.minesGameOver(true);
                    } else {
                        cell.innerText = '‚úì';
                        this.updateMinesUI();
                    }
                }
            },

            calculateMultiplier: function() {
                const minesCount = this.minesState.minesCount;
                const safeCount = 25 - minesCount;
                const revealedSafe = this.minesState.revealedCount;
                
                const baseMultiplier = 1 + (revealedSafe * (minesCount / 10));
                
                return Math.max(1, baseMultiplier.toFixed(2));
            },

            updateMinesUI: function() {
                document.getElementById('mines-balance').innerText = this.user.diamonds.toLocaleString();
                document.getElementById('mines-bet').innerText = this.minesState.bet;
                document.getElementById('mines-count').innerText = this.minesState.minesCount;
                document.getElementById('mines-revealed').innerText = `${this.minesState.revealedCount}/${25 - this.minesState.minesCount}`;
                
                const potential = Math.floor(this.minesState.bet * this.minesState.multiplier);
                document.getElementById('mines-potential').innerText = potential.toLocaleString();
                
                document.getElementById('current-multiplier').innerText = `${parseFloat(this.minesState.multiplier).toFixed(2)}x`;
            },

            minesCashout: function() {
                if (!this.minesState.gameActive) return;
                
                const winnings = Math.floor(this.minesState.bet * this.minesState.multiplier);
                
                this.user.diamonds += winnings;
                
                const msgDiv = document.getElementById('mines-message');
                msgDiv.className = 'game-message success';
                msgDiv.innerHTML = `üéâ <strong>GAGN√â!</strong> ${winnings}üíé | Multiplicateur: ${parseFloat(this.minesState.multiplier).toFixed(2)}x`;
                msgDiv.style.display = 'flex';
                
                this.minesGameReset();
                this.notify(`‚ú® Vous avez encaiss√© ${winnings}üíé !`, 'success');
                this.saveUser();
            },

            minesGameOver: function(win) {
                if (win) {
                    this.minesCashout();
                } else {
                    const msgDiv = document.getElementById('mines-message');
                    msgDiv.className = 'game-message danger';
                    msgDiv.innerHTML = `üí• <strong>PERDU!</strong> Vous avez march√© sur une bombe...`;
                    msgDiv.style.display = 'flex';
                    
                    this.minesGameReset();
                    this.notify(`üí• Vous avez perdu votre mise de ${this.minesState.bet}üíé`, 'error');
                    this.saveUser();
                }
            },

            minesGameReset: function() {
                this.minesState.gameActive = false;
                this.minesState.bet = 0;
                this.minesState.revealedCount = 0;
                this.minesState.multiplier = 1;
                
                document.getElementById('btn-start-game').disabled = false;
                document.getElementById('mines-bet-input').disabled = false;
                document.getElementById('mines-slider').disabled = false;
                document.getElementById('btn-cashout').disabled = true;
                document.getElementById('btn-cashout').style.display = 'none';
                
                document.getElementById('multiplier-container').style.display = 'none';
                
                document.querySelectorAll('.mine-cell').forEach(cell => {
                    cell.disabled = true;
                });
            },

            blackjackState: {
                deck: [],
                playerHand: [],
                dealerHand: [],
                bet: 0,
                gameActive: false,
                canDouble: false
            },

            initBlackjack: function() {
                this.blackjackState = {
                    deck: [],
                    playerHand: [],
                    dealerHand: [],
                    bet: 0,
                    gameActive: false,
                    canDouble: false
                };
            },

            createDeck: function() {
                const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
                const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                const deck = [];
                for (let i = 0; i < 6; i++) {
                    for (let suit of suits) {
                        for (let value of values) {
                            deck.push({ suit, value });
                        }
                    }
                }
                return deck.sort(() => Math.random() - 0.5);
            },

            dealCard: function(hand) {
                if (this.blackjackState.deck.length === 0) {
                    this.blackjackState.deck = this.createDeck();
                }
                hand.push(this.blackjackState.deck.pop());
            },

            calcHandValue: function(hand) {
                let value = 0;
                let aces = 0;
                for (let card of hand) {
                    if (card.value === 'A') {
                        aces++;
                        value += 11;
                    } else if (['J', 'Q', 'K'].includes(card.value)) {
                        value += 10;
                    } else {
                        value += parseInt(card.value);
                    }
                }
                while (value > 21 && aces > 0) {
                    value -= 10;
                    aces--;
                }
                return value;
            },

            renderBlackjackCards: function() {
                const playerCardsDiv = document.getElementById('player-cards');
                const dealerCardsDiv = document.getElementById('dealer-cards');
                
                playerCardsDiv.innerHTML = this.blackjackState.playerHand.map(card => 
                    `<div class="card">${card.value}${card.suit}</div>`
                ).join('');
                
                dealerCardsDiv.innerHTML = this.blackjackState.dealerHand.map(card => 
                    `<div class="card">${card.value}${card.suit}</div>`
                ).join('');
                
                document.getElementById('player-value').innerText = this.calcHandValue(this.blackjackState.playerHand);
                document.getElementById('dealer-value').innerText = this.calcHandValue(this.blackjackState.dealerHand);
            },

            setBJBet: function(amount) {
                document.getElementById('blackjack-bet').value = amount;
                this.updateBJUI();
            },

            updateBJUI: function() {
                document.getElementById('bj-balance').innerText = this.user.diamonds;
                const bet = parseInt(document.getElementById('blackjack-bet').value) || 0;
                document.getElementById('bj-current-bet').innerText = bet;
                document.getElementById('bj-potential-win').innerText = Math.floor(bet * 1.5);
            },

            blackjackDeal: function() {
                const betInput = document.getElementById('blackjack-bet');
                const bet = parseInt(betInput.value);
                
                if (!bet || bet <= 0) {
                    this.notify('Entrez une mise valide !', 'error');
                    return;
                }
                
                if (this.user.diamonds < bet) {
                    this.notify('Pas assez de diamants !', 'error');
                    return;
                }
                
                this.user.diamonds -= bet;
                this.blackjackState.bet = bet;
                this.blackjackState.gameActive = true;
                
                this.initBlackjack();
                this.blackjackState.deck = this.createDeck();
                this.blackjackState.bet = bet;
                
                this.dealCard(this.blackjackState.playerHand);
                this.dealCard(this.blackjackState.dealerHand);
                this.dealCard(this.blackjackState.playerHand);
                this.dealCard(this.blackjackState.dealerHand);
                
                this.renderBlackjackCards();
                
                document.getElementById('bj-deal').disabled = true;
                document.getElementById('bj-hit').disabled = false;
                document.getElementById('bj-stand').disabled = false;
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                if (playerValue === 21) {
                    this.blackjackStand();
                } else {
                    document.getElementById('bj-double').disabled = false;
                    this.blackjackState.canDouble = true;
                }
                
                document.getElementById('game-status').innerText = 'üéÆ √Ä votre tour de jouer...';
                document.getElementById('game-result').innerText = '';
                this.saveUser();
                this.updateBJUI();
            },

            blackjackHit: function() {
                this.dealCard(this.blackjackState.playerHand);
                this.renderBlackjackCards();
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                if (playerValue > 21) {
                    this.blackjackEnd(false);
                }
            },

            blackjackStand: function() {
                document.getElementById('bj-hit').disabled = true;
                document.getElementById('bj-stand').disabled = true;
                document.getElementById('bj-double').disabled = true;
                
                while (this.calcHandValue(this.blackjackState.dealerHand) < 17) {
                    this.dealCard(this.blackjackState.dealerHand);
                }
                
                this.renderBlackjackCards();
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                const dealerValue = this.calcHandValue(this.blackjackState.dealerHand);
                
                if (dealerValue > 21) {
                    this.blackjackEnd(true, 'VICTOIRE ! Le croupier a d√©pass√© 21 !');
                } else if (playerValue > dealerValue) {
                    this.blackjackEnd(true, 'VICTOIRE ! Vous battez le croupier !');
                } else if (playerValue === dealerValue) {
                    this.blackjackEnd(null, '√âGALIT√â ! Pari rembours√©.');
                } else {
                    this.blackjackEnd(false, 'D√âFAITE ! Le croupier gagne.');
                }
            },

            blackjackDouble: function() {
                const currentBet = this.blackjackState.bet;
                if (this.user.diamonds < currentBet) {
                    this.notify('Pas assez de diamants pour doubler !', 'error');
                    return;
                }
                
                this.user.diamonds -= currentBet;
                this.blackjackState.bet *= 2;
                this.blackjackState.canDouble = false;
                document.getElementById('bj-double').disabled = true;
                
                this.dealCard(this.blackjackState.playerHand);
                this.renderBlackjackCards();
                
                const playerValue = this.calcHandValue(this.blackjackState.playerHand);
                if (playerValue > 21) {
                    this.blackjackEnd(false);
                } else {
                    this.blackjackStand();
                }
                this.saveUser();
                this.updateBJUI();
            },

            blackjackEnd: function(win, message = '') {
                this.blackjackState.gameActive = false;
                document.getElementById('bj-hit').disabled = true;
                document.getElementById('bj-stand').disabled = true;
                document.getElementById('bj-double').disabled = true;
                document.getElementById('bj-deal').disabled = false;
                
                const betInput = document.getElementById('blackjack-bet');
                betInput.disabled = false;
                
                if (win === true) {
                    const winnings = Math.floor(this.blackjackState.bet * 1.5);
                    this.user.diamonds += winnings + this.blackjackState.bet;
                    document.getElementById('game-result').innerText = `‚ú® ${message} +${winnings} üíé`;
                    this.notify(`Gagn√© ${winnings} üíé !`, 'success');
                } else if (win === false) {
                    document.getElementById('game-result').innerText = `üí• ${message || 'Vous avez perdu votre mise.'}`;
                    this.notify(`Perdu ${this.blackjackState.bet} üíé...`, 'error');
                } else {
                    this.user.diamonds += this.blackjackState.bet;
                    document.getElementById('game-result').innerText = `ü§ù ${message}`;
                    this.notify(`Pari rembours√©.`, 'success');
                }
                
                this.saveUser();
                this.updateBJUI();
            },

            slotsMachineState: {
                isSpinning: false,
                lastWin: 0,
                totalBets: 0
            },

            setSlotsBet: function(amount) {
                document.getElementById('slots-bet').value = amount;
                this.updateSlotsUI();
            },

            updateSlotsUI: function() {
                document.getElementById('slots-balance').innerText = this.user.diamonds;
                const bet = parseInt(document.getElementById('slots-bet').value) || 0;
                document.getElementById('slots-total-bet').innerText = bet * 3;
                document.getElementById('slots-last-win').innerText = this.slotsMachineState.lastWin;
            },

            slotsSpin: function() {
                if (this.slotsMachineState.isSpinning) return;
                
                const betInput = document.getElementById('slots-bet');
                const bet = parseInt(betInput.value);
                
                if (!bet || bet <= 0) {
                    this.notify('Entrez une mise valide !', 'error');
                    return;
                }
                
                const totalBet = bet * 3;
                if (this.user.diamonds < totalBet) {
                    this.notify('Pas assez de diamants !', 'error');
                    return;
                }
                
                this.user.diamonds -= totalBet;
                this.slotsMachineState.totalBets = totalBet;
                this.slotsMachineState.isSpinning = true;
                
                document.getElementById('slots-spin').disabled = true;
                document.getElementById('slots-message').innerHTML = '';
                
                const reels = [0, 1, 2];
                const symbols = ['üçé', 'üçä', 'üçã', 'üçí', 'üíé', 'üëë', 'üé∞'];
                const results = reels.map(() => symbols[Math.floor(Math.random() * symbols.length)]);
                
                let completed = 0;
                reels.forEach((reel, index) => {
                    const duration = 2000 + (index * 200);
                    setTimeout(() => {
                        this.spinReel(reel, results[index], duration);
                    }, index * 150);
                });
                
                setTimeout(() => {
                    this.checkSlotsWin(results, bet);
                    document.getElementById('slots-spin').disabled = false;
                    this.slotsMachineState.isSpinning = false;
                }, 3000);
            },

            spinReel: function(reelIndex, targetSymbol, duration) {
                const reel = document.getElementById(`reel-${reelIndex}`);
                const symbols = ['üçé', 'üçä', 'üçã', 'üçí', 'üíé', 'üëë', 'üé∞'];
                const targetIndex = symbols.indexOf(targetSymbol);
                
                let currentIndex = 0;
                let spins = 0;
                const spinsPerSecond = 10;
                const totalSpins = Math.floor((duration / 1000) * spinsPerSecond);
                
                const spinInterval = setInterval(() => {
                    spins++;
                    currentIndex = (currentIndex + 1) % symbols.length;
                    reel.style.transform = `translateY(-${currentIndex * 50}px)`;
                    
                    if (spins >= totalSpins) {
                        clearInterval(spinInterval);
                        reel.style.transform = `translateY(-${targetIndex * 50}px)`;
                    }
                }, 1000 / spinsPerSecond);
            },

            checkSlotsWin: function(results, bet) {
                const [r1, r2, r3] = results;
                let winAmount = 0;
                const symbols = ['üçé', 'üçä', 'üçã', 'üçí', 'üíé', 'üëë', 'üé∞'];
                const multipliers = {
                    'üçé': 2, 'üçä': 2, 'üçã': 3, 'üçí': 3,
                    'üíé': 5, 'üëë': 10, 'üé∞': 50
                };
                
                const totalBet = bet * 3;
                
                if (r1 === r2 && r2 === r3) {
                    winAmount = totalBet * multipliers[r1];
                    document.getElementById('slots-message').innerHTML = `üéâ <strong>JACKPOT!</strong> ${r1}${r1}${r1} +${winAmount} üíé`;
                    this.notify(`JACKPOT! +${winAmount} üíé !`, 'success');
                } else if (r1 === r2 || r2 === r3 || r1 === r3) {
                    const pair = (r1 === r2) ? r1 : (r2 === r3) ? r2 : r1;
                    winAmount = totalBet * Math.floor(multipliers[pair] / 2);
                    document.getElementById('slots-message').innerHTML = `üéä Vous avez une paire! +${winAmount} üíé`;
                    this.notify(`Paire gagnante! +${winAmount} üíé`, 'success');
                } else {
                    document.getElementById('slots-message').innerHTML = `üò¢ Pas gagnant cette fois... R√©essayez!`;
                    this.notify('Pas gagnant...', 'error');
                }
                
                this.user.diamonds += winAmount;
                this.slotsMachineState.lastWin = winAmount;
                this.saveUser();
                this.updateSlotsUI();
            }
        };

        app.init();
        
        document.getElementById('mines-slider').addEventListener('input', function() {
            document.getElementById('mines-slider-value').innerText = this.value;
        });

        // Init dynamic fields for withdraw on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('withdraw-method')) {
                app.toggleWithdrawFields();
            }
        });
    </script>
</body>
</html>
